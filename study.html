<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Guide - Electron Towers</title>
    <style>
        :root {
            --primary: #1e293b;
            --secondary: #334155;
            --accent: #06b6d4;
            --warning: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --light: #f1f5f9;
            --border: #475569;
            --bg: #0f172a;
            --card: #1e293b;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --gradient-success: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            --gradient-danger: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ======= Custom Logo-Based Emojis ======= */
        .custom-emoji {
            display: inline-block;
            width: 1.2em;
            height: 1.2em;
            vertical-align: middle;
            position: relative;
        }

        .emoji-scientist {
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
            border-radius: 50%;
            border: 2px solid #8b5cf6;
        }

        .emoji-scientist::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 6px;
            background: #8b5cf6;
            border-radius: 4px 4px 2px 2px;
        }

        .emoji-scientist::after {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 4px;
            background: #fbbf24;
            border-radius: 3px;
        }

        .emoji-atom {
            background: white;
            border: 2px solid #8b5cf6;
            border-radius: 50%;
        }

        .emoji-atom::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 3px;
            height: 3px;
            background: #8b5cf6;
            border-radius: 50%;
        }

        .emoji-beaker {
            background: #8b5cf6;
            border: 1px solid white;
            border-radius: 2px 2px 0 0;
            width: 8px;
            height: 10px;
        }

        .emoji-beaker::after {
            content: '';
            position: absolute;
            top: -1px;
            right: 1px;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
        }

        .emoji-syringe {
            background: white;
            border: 1px solid #8b5cf6;
            border-radius: 1px;
            width: 4px;
            height: 12px;
        }

        .emoji-syringe::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 1px;
            width: 2px;
            height: 2px;
            background: #8b5cf6;
            border-radius: 50%;
        }

        .emoji-star {
            background: white;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            width: 10px;
            height: 10px;
        }

        .emoji-electron {
            background: #06b6d4;
            border-radius: 50%;
            width: 8px;
            height: 8px;
            box-shadow: 0 0 4px #06b6d4;
        }

        .emoji-nucleus {
            background: #ef4444;
            border-radius: 50%;
            width: 10px;
            height: 10px;
            box-shadow: 0 0 4px #ef4444;
        }

        .emoji-energy {
            background: #f59e0b;
            border-radius: 50%;
            width: 8px;
            height: 8px;
            box-shadow: 0 0 4px #f59e0b;
        }

        .emoji-study {
            background: #10b981;
            border-radius: 50%;
            width: 10px;
            height: 10px;
            box-shadow: 0 0 4px #10b981;
        }

        .emoji-game {
            background: #8b5cf6;
            border-radius: 50%;
            width: 10px;
            height: 10px;
            box-shadow: 0 0 4px #8b5cf6;
        }

        /* ======= Header Styles (Consistent with main app) ======= */
        .app-header {
            background: var(--card);
            border-bottom: 2px solid var(--border);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            position: relative;
            width: 60px;
            height: 60px;
            flex-shrink: 0;
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
            border-radius: 15px;
            padding: 6px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .logo-image {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .logo-placeholder {
            width: 100%;
            height: 100%;
            position: relative;
            background: linear-gradient(135deg, #87CEEB 0%, #B0E0E6 100%);
            border-radius: 10px;
        }

        /* Scientist elements */
        .logo-scientist {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .logo-hair-purple {
            position: absolute;
            top: 8px;
            left: 20px;
            width: 20px;
            height: 12px;
            background: #8b5cf6;
            border-radius: 10px 10px 8px 8px;
        }

        .logo-face-skin {
            position: absolute;
            top: 18px;
            left: 22px;
            width: 16px;
            height: 12px;
            background: #fbbf24;
            border-radius: 8px;
        }

        .logo-eyes-blue {
            position: absolute;
            top: 20px;
            left: 24px;
            width: 12px;
            height: 8px;
            display: flex;
            gap: 4px;
        }

        .logo-eyes-blue::before,
        .logo-eyes-blue::after {
            content: '';
            width: 4px;
            height: 4px;
            background: #1e40af;
            border-radius: 50%;
        }

        .logo-glasses-round {
            position: absolute;
            top: 19px;
            left: 21px;
            width: 18px;
            height: 6px;
            border: 2px solid #1e293b;
            border-radius: 6px;
        }

        .logo-smile-friendly {
            position: absolute;
            top: 26px;
            left: 25px;
            width: 8px;
            height: 4px;
            border: 1px solid #dc2626;
            border-top: none;
            border-radius: 0 0 8px 8px;
        }

        .logo-labcoat-white {
            position: absolute;
            top: 30px;
            left: 18px;
            width: 24px;
            height: 14px;
            background: white;
            border-radius: 4px 4px 0 0;
        }

        .logo-tie-purple {
            position: absolute;
            top: 32px;
            left: 26px;
            width: 4px;
            height: 10px;
            background: #8b5cf6;
            border-radius: 2px;
        }

        /* Science elements */
        .logo-science-elements {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .logo-atom-white {
            position: absolute;
            width: 8px;
            height: 8px;
            border: 1px solid white;
            border-radius: 50%;
        }

        .logo-atom-white:nth-child(1) {
            top: 5px;
            left: 5px;
        }

        .logo-atom-white:nth-child(2) {
            top: 5px;
            right: 5px;
        }

        .logo-beaker-purple {
            position: absolute;
            width: 6px;
            height: 8px;
            background: #8b5cf6;
            border-radius: 3px 3px 0 0;
        }

        .logo-beaker-purple:nth-child(3) {
            bottom: 5px;
            left: 5px;
        }

        .logo-beaker-purple:nth-child(4) {
            bottom: 5px;
            right: 5px;
        }

        .logo-syringe-white {
            position: absolute;
            width: 3px;
            height: 10px;
            background: white;
            border: 1px solid #8b5cf6;
            border-radius: 1px;
        }

        .logo-syringe-white:nth-child(5) {
            bottom: 8px;
            left: 15px;
        }

        .logo-syringe-white:nth-child(6) {
            bottom: 8px;
            right: 15px;
        }

        .logo-star-white {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }

        .logo-star-white:nth-child(7) {
            top: 12px;
            left: 12px;
        }

        .logo-star-white:nth-child(8) {
            top: 18px;
            right: 10px;
        }

        .logo-star-white:nth-child(9) {
            bottom: 15px;
            left: 10px;
        }

        .logo-star-white:nth-child(10) {
            bottom: 22px;
            right: 8px;
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-text h1 {
            color: var(--light);
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .brand-text .subtitle {
            color: var(--accent);
            font-size: 14px;
            margin: 5px 0 0 0;
            opacity: 0.8;
        }

        .right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn.ghost {
            background: transparent;
            color: var(--light);
            border: 2px solid var(--border);
        }

        .btn.ghost:hover {
            background: var(--border);
            border-color: var(--accent);
        }

        .btn.primary {
            background: var(--accent);
            color: white;
        }

        .btn.primary:hover {
            background: #0891b2;
            transform: translateY(-2px);
        }

        /* ======= Main Content ======= */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            text-align: center;
            margin-bottom: 50px;
        }

        .page-title h1 {
            font-size: 48px;
            color: var(--accent);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .page-title p {
            font-size: 20px;
            color: var(--light);
            opacity: 0.8;
        }

        /* ======= Big Tile Design ======= */
        .study-tiles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .study-tile {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .study-tile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--gradient-primary);
        }

        .study-tile.overview::before {
            background: var(--gradient-primary);
        }

        .study-tile.rules::before {
            background: var(--gradient-accent);
        }

        .study-tile.exceptions::before {
            background: var(--gradient-warning);
        }

        .study-tile.ions::before {
            background: var(--gradient-secondary);
        }

        .study-tile.practice::before {
            background: var(--gradient-success);
        }

        .study-tile.assessment::before {
            background: var(--gradient-danger);
        }

        .study-tile:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(6, 182, 212, 0.3);
        }

        .tile-header {
            margin-bottom: 25px;
        }

        .tile-header h2 {
            color: var(--light);
            font-size: 28px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tile-header p {
            color: var(--light);
            opacity: 0.8;
            font-size: 16px;
            line-height: 1.6;
        }

        .tile-content {
            flex-grow: 1;
        }

        .tile-features {
            list-style: none;
            margin: 20px 0;
        }

        .tile-features li {
            color: var(--light);
            margin-bottom: 12px;
            padding-left: 30px;
            position: relative;
            font-size: 15px;
        }

        .tile-features li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: bold;
            font-size: 18px;
        }

        .tile-actions {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .tile-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 140px;
            flex-shrink: 0;
            justify-content: center;
        }

        .tile-btn:hover {
            background: #0891b2;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(6, 182, 212, 0.4);
        }

        .tile-btn.secondary {
            background: transparent;
            color: var(--accent);
            border: 2px solid var(--accent);
        }

        .tile-btn.secondary:hover {
            background: var(--accent);
            color: white;
        }

        /* ======= Interactive Elements ======= */
        .interactive-demo {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        /* ======= Core Rules Interactive Styles ======= */
        .rule-definitions {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .rule-definition {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid var(--accent);
        }

        .rule-definition h4 {
            margin: 0 0 8px 0;
            font-size: 18px;
        }

        .rule-definition p {
            margin: 0;
            line-height: 1.5;
        }

        .aufbau-demo, .hund-demo, .pauli-demo {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 20px 0;
        }

        /* ===== Main App Style Building Structure ===== */
        .building {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .floor {
            margin-bottom: 8px;
        }

        .floor-label {
            font-weight: 900;
            color: var(--warning);
            margin-bottom: 4px;
            font-size: 13px;
        }

        .wings {
            display: grid;
            grid-template-columns: 1fr;
            grid-auto-rows: minmax(50px, auto);
            gap: 6px;
            align-items: stretch;
        }

        .wing {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .wing-title {
            color: #fff;
            font-size: 12px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .degenerate-label {
            background: var(--warning);
            color: var(--dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            margin-left: 8px;
        }

        .units {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .unit {
            width: 120px;
            min-height: 70px;
            background: rgba(30, 41, 59, 0.9);
            border: 2px solid var(--secondary);
            border-radius: 12px;
            padding: 6px;
            position: relative;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .unit:hover {
            border-color: var(--accent);
            transform: scale(1.02);
        }

        .unit-label {
            position: absolute;
            top: 4px;
            right: 6px;
            font-size: 10px;
            color: var(--warning);
        }

        .slots {
            display: flex;
            gap: 6px;
            margin-top: 18px;
            flex-wrap: wrap;
        }

        .slot {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: rgba(15, 23, 42, 0.9);
            border: 2px solid var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-weight: 900;
            font-size: 16px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            min-width: 44px;
            min-height: 44px;
            transition: all 0.3s ease;
        }

        .slot:hover {
            border-color: var(--accent);
            transform: scale(1.1);
        }

        .slot.filled {
            background: var(--success);
            border-color: var(--success);
        }

        .slot.half-filled {
            background: var(--warning);
            border-color: var(--warning);
        }

        .slot.paired {
            background: var(--danger);
            border-color: var(--danger);
        }

        /* Energy ordering: f (highest) → d → p → s (lowest) */
        .floor[data-n="2"] .wing-p { grid-row: 1; }
        .floor[data-n="2"] .wing-s { grid-row: 2; }
        .floor[data-n="3"] .wing-f, .floor[data-n="4"] .wing-f, .floor[data-n="5"] .wing-f, .floor[data-n="6"] .wing-f, .floor[data-n="7"] .wing-f { grid-row: 1; }
        .floor[data-n="3"] .wing-d, .floor[data-n="4"] .wing-d, .floor[data-n="5"] .wing-d, .floor[data-n="6"] .wing-d, .floor[data-n="7"] .wing-d { grid-row: 2; }
        .floor[data-n="3"] .wing-p, .floor[data-n="4"] .wing-p, .floor[data-n="5"] .wing-p, .floor[data-n="6"] .wing-p, .floor[data-n="7"] .wing-p { grid-row: 3; }
        .floor[data-n="3"] .wing-s, .floor[data-n="4"] .wing-s, .floor[data-n="5"] .wing-s, .floor[data-n="6"] .wing-s, .floor[data-n="7"] .wing-s { grid-row: 4; }

        .demo-controls {
            display: flex;
            gap: 12px;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        /* ===== Ion Formation Specific Styles ===== */
        .ion-formation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        /* ======= Assessment Specific Styles ===== */
        .mark-scheme {
            background: rgba(34, 197, 94, 0.1);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .mark-scheme strong {
            color: var(--success);
            font-weight: 600;
        }

        .mark-scheme p {
            margin: 8px 0;
            color: var(--light);
        }

        .assessment-paper-card {
            background: rgba(15, 23, 42, 0.4);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .assessment-paper-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .paper-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .paper-title {
            color: var(--accent);
            font-size: 24px;
            font-weight: 600;
        }

        .paper-meta {
            color: var(--light);
            font-size: 14px;
        }

        .question-number {
            background: var(--accent);
            color: var(--dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        /* ======= Drawing Tools Styles ======= */
        .drawing-tools-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid var(--accent);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .drawing-tools-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .drawing-tools-header h3 {
            color: var(--accent);
            font-size: 24px;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .drawing-canvas-container {
            position: relative;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        #drawingCanvas {
            display: block;
            cursor: crosshair;
            touch-action: none;
            background: white;
        }

        .drawing-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }

        .drawing-tool {
            padding: 8px 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .drawing-tool:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .drawing-tool.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .drawing-tool input[type="range"] {
            width: 80px;
            margin: 0 5px;
        }

        .drawing-tool input[type="color"] {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .drawing-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .drawing-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .drawing-btn.primary {
            background: var(--accent);
            color: white;
        }

        .drawing-btn.primary:hover {
            background: var(--accent-dark);
            transform: translateY(-2px);
        }

        .drawing-btn.secondary {
            background: #6c757d;
            color: white;
        }

        .drawing-btn.secondary:hover {
            background: #5a6268;
        }

        .drawing-btn.danger {
            background: #dc3545;
            color: white;
        }

        .drawing-btn.danger:hover {
            background: #c82333;
        }

        .drawing-status {
            text-align: center;
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .drawing-templates {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .drawing-template {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .drawing-template:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .drawing-template h4 {
            margin: 0 0 10px 0;
            color: var(--accent);
            font-size: 16px;
        }

        .drawing-template p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }

        /* MathJax styling for electron configuration */
        .electron-config-input {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100%;
            margin: 10px 0;
        }

        .electron-config-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            font-size: 20px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Math Input Toolbar Styles */
        .math-toolbar {
            display: none; /* Hidden by default */
            flex-wrap: wrap;
            gap: 8px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 10px 0;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .math-toolbar.visible {
            display: flex;
        }

        .question-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .math-toolbar-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 0;
        }

        .math-toolbar-toggle:hover {
            background: var(--accent-dark);
            transform: translateY(-1px);
        }

        .math-toolbar-toggle.active {
            background: #6c757d;
        }

        .math-toolbar-toggle .toggle-icon {
            transition: transform 0.3s ease;
        }

        .math-toolbar-toggle.active .toggle-icon {
            transform: rotate(180deg);
        }

        .math-toolbar-group {
            display: flex;
            gap: 8px;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-right: 15px;
            flex-wrap: nowrap;
        }

        .math-toolbar-group h5 {
            margin: 0 10px 0 0;
            font-size: 12px;
            color: #666;
            font-weight: 600;
            min-width: 50px;
            white-space: nowrap;
        }

        .math-btn {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 30px;
            text-align: center;
        }

        .math-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .math-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .math-btn.superscript {
            font-size: 12px;
            vertical-align: super;
        }

        .math-btn.subscript {
            font-size: 12px;
            vertical-align: sub;
        }

        .math-input-container {
            position: relative;
            width: 100%;
        }

        .math-input-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            padding: 10px;
            border: 2px solid transparent;
            border-radius: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
            z-index: 1;
        }

        .math-input-hidden {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: transparent;
            z-index: 2;
        }

        .math-symbols-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
            gap: 5px;
            max-width: 300px;
        }

        .math-functions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 5px;
            max-width: 400px;
        }

        .subscript-superscript-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .subscript-superscript-controls input {
            width: 40px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
        }

        .math-help {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
        }

        .math-help h6 {
            margin: 0 0 8px 0;
            color: #1976d2;
            font-weight: 600;
        }

        .math-help ul {
            margin: 0;
            padding-left: 20px;
        }

        .math-help li {
            margin: 4px 0;
        }

        /* Responsive design for math toolbar */
        @media (max-width: 768px) {
            .math-toolbar {
                flex-direction: column;
                gap: 10px;
            }
            
            .math-toolbar-group {
                justify-content: center;
            }
            
            .math-symbols-grid,
            .math-functions-grid {
                max-width: 100%;
            }
        }

        /* Responsive design for drawing tools */
        @media (max-width: 768px) {
            .drawing-toolbar {
                flex-direction: column;
                gap: 8px;
            }
            
            .drawing-tool {
                width: 100%;
                justify-content: center;
            }
            
            #drawingCanvas {
                width: 100%;
                height: 300px;
            }
            
            .drawing-templates {
                grid-template-columns: 1fr;
            }
        }

        /* ======= Paper Assessment Styles ===== */
        .paper-timer {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 15px 20px;
            margin: 20px 0;
            text-align: center;
        }

        .timer-label {
            color: var(--light);
            font-weight: 600;
            margin-right: 10px;
        }

        .timer-display {
            color: var(--danger);
            font-size: 24px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }

        .instructions-box {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .instructions-box ul {
            margin: 0;
            padding-left: 20px;
        }

        .instructions-box li {
            margin: 8px 0;
            color: var(--light);
        }

        .question-container {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }

        .question-part {
            margin: 20px 0;
            padding: 20px;
            background: rgba(15, 23, 42, 0.2);
            border-radius: 12px;
            border-left: 4px solid var(--accent);
        }

        .question-part h4 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .answer-space {
            margin: 15px 0;
        }

        .answer-space textarea,
        .answer-space input {
            width: 100%;
            background: rgba(15, 23, 42, 0.5);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            color: var(--light);
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }

        .answer-space textarea:focus,
        .answer-space input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .config-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 8px;
            overflow: hidden;
        }

        .config-table th,
        .config-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .config-table th {
            background: var(--accent);
            color: var(--dark);
            font-weight: 600;
        }

        .config-table td {
            color: var(--light);
        }

        .config-table input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--light);
            font-size: 14px;
        }

        .config-table input:focus {
            outline: none;
            background: rgba(59, 130, 246, 0.1);
        }

        .paper-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 40px 0;
            padding: 20px;
            background: rgba(15, 23, 42, 0.2);
            border-radius: 12px;
        }

        .paper-controls .btn {
            min-width: 150px;
        }

        .formation-card {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .formation-card:hover {
            border-color: var(--accent);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.2);
        }

        .formation-card h4 {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .example-box {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid var(--primary);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .example-box strong {
            color: var(--primary);
            display: block;
            margin-bottom: 8px;
        }

        .example-box p {
            margin: 5px 0;
            font-family: 'Courier New', monospace;
            color: var(--light);
        }

        .ion-demo {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
            transition: all 0.3s ease;
        }

        .ion-demo:hover {
            border-color: var(--accent);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.2);
        }

        .ion-demo h4 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .ion-demo .building {
            max-width: 800px;
            margin: 0 auto;
        }

        .p-orbitals {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 20px;
        }

        .p-orbital-set {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .set-label {
            font-weight: bold;
            color: var(--success);
            min-width: 80px;
            font-size: 16px;
        }

        .orbital-test {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .test-orbital {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .orbital-label {
            font-weight: bold;
            color: var(--danger);
            margin-bottom: 12px;
            font-size: 16px;
        }

        .electron-count {
            margin-top: 12px;
            color: var(--light);
            font-size: 14px;
        }

        .pauli-feedback {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: bold;
        }

        .pauli-feedback.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .pauli-feedback.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .understanding-quiz {
            margin: 20px 0;
        }

        .quiz-question {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .quiz-question h4 {
            margin-bottom: 20px;
            color: var(--accent);
            font-size: 18px;
            line-height: 1.4;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
            width: 100%;
        }

        .quiz-option {
            padding: 15px 20px;
            background: var(--dark);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 15px;
            width: 100%;
            box-sizing: border-box;
            min-height: 50px;
            display: flex;
            align-items: center;
        }

        .quiz-option:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        .quiz-option.correct {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .quiz-option.incorrect {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }

        .quiz-results {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-top: 20px;
        }

        .quiz-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .quiz-controls .tile-btn {
            min-width: 140px;
            flex: 0 0 auto;
        }

        /* ======= Exceptions Content Styles ======= */
        .exceptions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .exception-item {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .exception-item:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .exception-item h4 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .config-comparison {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 20px 0;
        }

        .config-standard {
            background: rgba(239, 68, 68, 0.15);
            border: 2px solid var(--danger);
            border-radius: 12px;
            padding: 15px;
            color: var(--danger);
            font-weight: 500;
        }

        .config-actual {
            background: rgba(16, 185, 129, 0.15);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 15px;
            color: var(--success);
            font-weight: 500;
        }

        .exception-demo {
            margin: 25px 0;
            background: rgba(15, 23, 42, 0.2);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
        }

        .exception-demo .building {
            margin: 20px 0;
            max-width: 800px;
        }

        .exception-demo .units {
            display: flex;
            flex-direction: row;
            gap: 8px;
            flex-wrap: nowrap;
        }

        .exception-demo .unit {
            min-width: 60px;
        }

        .exception-demo .demo-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .exception-demo .building {
            flex: 1;
        }

        .config-display {
            flex: 0 0 150px;
            padding: 10px;
            margin-top: 20px;
            background: none;
            border: none;
        }

        .config-display h5 {
            color: var(--accent);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .config-text {
            color: var(--light);
            font-size: 0.9rem;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .config-standard {
            color: var(--danger) !important;
            background: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            display: inline !important;
        }

        .config-actual {
            color: var(--success) !important;
            background: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            border-radius: 0 !important;
            display: inline !important;
        }

        .exception-demo h4 {
            color: var(--accent);
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .exception-demo p {
            color: var(--light);
            margin-bottom: 20px;
            font-style: italic;
        }

        /* ======= Objectives Section Styles ======= */
        .objectives-section {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .objectives-section h3 {
            color: var(--accent);
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .objectives-section p {
            color: var(--light);
            margin-bottom: 20px;
            font-style: italic;
        }

        .objectives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .objective-card {
            background: rgba(15, 23, 42, 0.5);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .objective-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .objective-card h4 {
            color: var(--accent);
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .objective-card p {
            color: var(--light);
            font-size: 0.95rem;
            line-height: 1.5;
            margin: 0;
        }

        .objective-card ul {
            color: var(--light);
            margin: 0;
            padding-left: 20px;
        }

        .objective-card li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        /* ======= Vocabulary Section Styles ======= */
        .vocabulary-section {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .vocabulary-section h3 {
            color: var(--accent);
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .vocabulary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .vocab-card {
            background: rgba(15, 23, 42, 0.5);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .vocab-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .vocab-card h4 {
            color: var(--accent);
            font-size: 1.1rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .vocab-item {
            margin-bottom: 12px;
            color: var(--light);
            line-height: 1.5;
        }

        .vocab-item strong {
            color: var(--accent);
            font-weight: 600;
        }

        /* ======= Vocabulary Quiz Section Styles ======= */
        .vocab-quiz-section {
            background: rgba(15, 23, 42, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .vocab-quiz-section h3 {
            color: var(--accent);
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .orbital.filled, .orbital.half-filled, .orbital.paired {
            animation: pulse 0.5s ease-in-out;
        }

        .interactive-demo h4 {
            color: var(--warning);
            margin-bottom: 15px;
            font-size: 18px;
        }

        .orbital-diagram {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .orbital {
            width: 60px;
            height: 60px;
            border: 2px solid var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            background: var(--card);
            color: var(--light);
            font-weight: bold;
        }

        .orbital:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(6, 182, 212, 0.4);
        }

        .orbital.filled {
            background: var(--accent);
            color: white;
        }

        .orbital.half-filled {
            background: linear-gradient(90deg, var(--accent) 50%, transparent 50%);
            color: var(--accent);
        }

        /* ======= Footer (Consistent with main app) ======= */
        .app-footer {
            background: var(--card);
            border-top: 2px solid var(--border);
            padding: 30px 20px;
            text-align: center;
            color: var(--light);
            opacity: 0.7;
        }

        /* ======= Responsive Design ======= */
        @media (max-width: 768px) {
            .study-tiles {
                grid-template-columns: 1fr;
            }
            
            .page-title h1 {
                font-size: 36px;
                flex-direction: column;
                gap: 10px;
            }
            
            .study-tile {
                padding: 30px;
                min-height: 250px;
            }
            
            .tile-header h2 {
                font-size: 24px;
            }
            
            .tile-actions {
                flex-direction: column;
            }
            
            .tile-btn {
                width: 100%;
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .main {
                padding: 20px 15px;
            }
            
            .study-tile {
                padding: 25px;
            }
            
            .page-title h1 {
                font-size: 28px;
            }
        }

        /* ======= Detailed Content Styles ======= */
        .content-section {
            margin-bottom: 50px;
        }

        .content-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 20px;
            border: 1px solid var(--border);
        }

        .content-card {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }

        .content-card:hover {
            border-color: var(--accent);
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(6, 182, 212, 0.2);
        }

        /* Core Concepts Overview */
        .concepts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .concept-item {
            background: rgba(30, 41, 59, 0.4);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .concept-item:hover {
            border-color: var(--accent);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(6, 182, 212, 0.15);
        }

        .concept-icon {
            background: var(--accent);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 18px;
            flex-shrink: 0;
        }

        .concept-content h4 {
            color: var(--warning);
            margin-bottom: 8px;
            font-size: 16px;
        }

        .concept-content p {
            color: var(--light);
            margin: 0 0 8px 0;
            font-size: 14px;
            line-height: 1.4;
        }

        .concept-preview {
            background: var(--bg);
            color: var(--accent);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid var(--accent);
        }


        /* Button spacing improvements */
        .button-container {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            justify-content: center;
            flex-wrap: wrap;
            align-items: center;
        }

        .button-container .tile-btn {
            margin: 0;
        }

        /* Single button centering */
        .single-button {
            text-align: center;
            margin-top: 25px;
        }

        .single-button .tile-btn {
            margin: 0 auto;
        }

        /* Content card button spacing */
        .content-card .button-container {
            margin-top: 30px;
        }

        /* Achievement section button spacing */
        .achievement-unlock + .button-container {
            margin-top: 20px;
        }

        /* Responsive button adjustments */
        @media (max-width: 768px) {
            .tile-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .tile-btn {
                min-width: 100%;
                margin: 5px 0;
            }
            
            .button-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .button-container .tile-btn {
                min-width: 100%;
                margin: 5px 0;
            }
            
            .journey-intro {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
        }

        @media (max-width: 480px) {
            .tile-btn {
                padding: 10px 20px;
                font-size: 13px;
            }
            
            .concepts-grid,
            .specs-grid,
            .vocabulary-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Specifications Grid */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .spec-category {
            background: rgba(30, 41, 59, 0.3);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .spec-category:hover {
            border-color: var(--accent);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(6, 182, 212, 0.15);
        }

        .spec-category h4 {
            margin-bottom: 20px;
            font-weight: 600;
        }

        .spec-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .spec-list li {
            color: var(--light);
            margin-bottom: 12px;
            padding-left: 20px;
            position: relative;
            line-height: 1.5;
        }

        .spec-list li::before {
            content: '•';
            color: var(--accent);
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        /* Vocabulary Grid */
        .vocabulary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .vocab-item {
            background: rgba(30, 41, 59, 0.4);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .vocab-item:hover {
            border-color: var(--accent);
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(6, 182, 212, 0.2);
        }

        .vocab-term {
            color: var(--warning);
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }

        .vocab-preview {
            color: var(--light);
            font-size: 14px;
            line-height: 1.4;
        }

        /* Learning Journey Path */
        .journey-intro {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 25px 0;
        }

        .journey-visual {
            display: flex;
            justify-content: center;
            align-items: center;
        }


        .journey-description {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .journey-description h4 {
            margin-bottom: 15px;
            font-weight: 600;
        }

        .journey-description p {
            margin-bottom: 25px;
        }






        /* ======= Overview Progress Tracking Styles ======= */
        .progress-tracker {
            margin-bottom: 20px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .progress-item:last-child {
            border-bottom: none;
        }

        .progress-item.completed {
            color: var(--success);
        }

        .progress-checkbox {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .progress-text {
            color: var(--light);
            font-size: 16px;
        }

        .overall-progress {
            margin-top: 20px;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--success));
            transition: width 0.5s ease;
        }

        .progress-text {
            color: var(--light);
            font-weight: 600;
        }

        /* ======= Overview Assessment Styles ======= */
        .assessment-questions {
            margin-bottom: 30px;
        }

        .question-card {
            background: var(--secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .question-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .option-label:hover {
            background: var(--accent);
            transform: translateX(5px);
        }

        .option-label.selected {
            border-color: var(--success);
            background: var(--success);
            color: var(--primary);
        }

        .option-label input[type="radio"] {
            margin: 0;
            accent-color: var(--success);
        }

        .option-text {
            color: var(--light);
            font-size: 16px;
        }

        .assessment-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .assessment-results {
            background: var(--secondary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid var(--success);
        }

        .results-card h4 {
            margin-bottom: 15px;
        }

        .score-display {
            margin-bottom: 15px;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--success);
        }

        .completion-message {
            color: var(--light);
            font-size: 16px;
        }

        /* ======= Overview Tile Progress Styles ======= */
        .tile-progress {
            background: var(--success);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 10px;
            text-align: center;
        }

        .tile-progress.incomplete {
            background: var(--warning);
        }

        .tile-progress.not-started {
            background: var(--neutral);
        }

    </style>
    
    <!-- MathJax for electron configuration superscripts -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            options: {
                skipHtmlTags: ['script', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <!-- ======= Header (Consistent with main app) ======= -->
    <header class="app-header">
        <div class="brand">
            <div class="header-logo">
                <div class="logo-image">
                    <div class="logo-placeholder">
                        <div class="logo-scientist">
                            <div class="logo-hair-purple"></div>
                            <div class="logo-face-skin"></div>
                            <div class="logo-eyes-blue"></div>
                            <div class="logo-glasses-round"></div>
                            <div class="logo-smile-friendly"></div>
                            <div class="logo-labcoat-white"></div>
                            <div class="logo-tie-purple"></div>
                        </div>
                        <div class="logo-science-elements">
                            <div class="logo-atom-white"></div>
                            <div class="logo-atom-white"></div>
                            <div class="logo-beaker-purple"></div>
                            <div class="logo-beaker-purple"></div>
                            <div class="logo-syringe-white"></div>
                            <div class="logo-syringe-white"></div>
                            <div class="logo-star-white"></div>
                            <div class="logo-star-white"></div>
                            <div class="logo-star-white"></div>
                            <div class="logo-star-white"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="brand-text">
                <h1>Electron Towers</h1>
                <p class="subtitle">v0.16r8 — Study Guide & Learning Resources</p>
            </div>
        </div>
        <div class="right">
            <a href="index.html" class="btn ghost"><span class="custom-emoji emoji-atom"></span> Back to App</a>
            <a href="progress.html" class="btn ghost"><span class="custom-emoji emoji-star"></span> Progress</a>
            <button class="btn primary"><span class="custom-emoji emoji-study"></span> Start Learning</button>
        </div>
    </header>

    <!-- ======= Main Content ======= -->
    <main class="main">
        <div class="page-title">
            <h1>
                <span class="custom-emoji emoji-study"></span>
                Master Electron Configuration
                <span class="custom-emoji emoji-atom"></span>
            </h1>
            <p>Comprehensive study guide for understanding atomic structure and electron behavior</p>
            <div style="text-align: center; margin-top: 20px;">
                <a href="progress.html" class="tile-btn" style="display: inline-block; text-decoration: none;">
                    📊 View Progress Dashboard
                </a>
            </div>
        </div>

        <!-- ======= Big Study Tiles ======= -->
        <div class="study-tiles">
            <!-- Overview Tile -->
            <div class="study-tile overview">
                <div class="tile-header">
                    <h2>
                        <span class="custom-emoji emoji-study"></span>
                        Overview
                    </h2>
                    <p>Master the fundamental principles of electron arrangement in atoms</p>
                </div>
                <div class="tile-content">
                    <ul class="tile-features">
                        <li><strong>Aufbau principle:</strong> Electrons occupy the lowest-energy available subshells first.</li>
                        <li><strong>Hund's rule:</strong> In a set of degenerate orbitals (p, d, f), place one electron in each with the <b>same spin</b> before pairing.</li>
                        <li><strong>Pauli exclusion principle:</strong> Each orbital holds at most two electrons and they must have <b>opposite spins</b> (↑↓).</li>
                        <li><strong>Exceptions:</strong> Special cases like Chromium (Cr) and Copper (Cu)</li>
                        <li><strong>Ion Formation:</strong> How atoms gain or lose electrons to form ions</li>
                        <li><strong>Octet Rule:</strong> Why atoms seek 8 valence electrons for stability</li>
                    </ul>
                </div>
                <div class="tile-actions">
                    <button class="tile-btn" onclick="showOverviewContent()">Learn More</button>
                </div>
            </div>

            <!-- Core Rules Tile -->
            <div class="study-tile rules">
                <div class="tile-header">
                    <h2>
                        <span class="custom-emoji emoji-atom"></span>
                        Core Rules
                    </h2>
                    <p>The three fundamental principles that govern electron behavior</p>
                </div>
                <div class="tile-content">
                    <ul class="tile-features">
                        <li><strong>Aufbau principle:</strong> Electrons occupy the lowest-energy available subshells first.</li>
                        <li><strong>Hund's rule:</strong> In a set of degenerate orbitals (p, d, f), place one electron in each with the <b>same spin</b> before pairing.</li>
                        <li><strong>Pauli exclusion principle:</strong> Each orbital holds at most two electrons and they must have <b>opposite spins</b> (↑↓).</li>
                        <li><strong>Energy Order:</strong> 1s → 2s → 2p → 3s → 3p → 4s → 3d → 4p...</li>
                        <li><strong>Diagonal Pattern:</strong> Follow the energy level progression</li>
                    </ul>
                </div>
                <div class="tile-actions">
                    <button class="tile-btn" onclick="showCoreRulesContent()">Learn More</button>
                </div>
            </div>

            <!-- Exceptions Tile -->
            <div class="study-tile exceptions">
                <div class="tile-header">
                    <h2>
                        <span class="custom-emoji emoji-star"></span>
                        Exceptions
                    </h2>
                    <p>Special cases where elements break the standard rules for stability</p>
                </div>
                <div class="tile-content">
                    <ul class="tile-features">
                        <li><strong>Chromium (Cr):</strong> [Ar] 4s¹ 3d⁵ instead of [Ar] 4s² 3d⁴</li>
                        <li><strong>Copper (Cu):</strong> [Ar] 4s¹ 3d¹⁰ instead of [Ar] 4s² 3d⁹</li>
                        <li><strong>Molybdenum (Mo):</strong> [Kr] 5s¹ 4d⁵ (half-filled d-subshell)</li>
                        <li><strong>Silver (Ag):</strong> [Kr] 5s¹ 4d¹⁰ (filled d-subshell)</li>
                        <li><strong>Why Exceptions:</strong> Half-filled and filled subshells provide extra stability</li>
                    </ul>
                </div>
                <div class="tile-actions">
                    <button class="tile-btn" onclick="showExceptionsContent()">Learn More</button>
                </div>
            </div>

            <!-- Ion Formation Tile -->
            <div class="study-tile ions">
                <div class="tile-header">
                    <h2>
                        <span class="custom-emoji emoji-beaker"></span>
                        Ion Formation
                    </h2>
                    <p>Understanding how atoms gain and lose electrons to form ions</p>
                </div>
                <div class="tile-content">
                    <ul class="tile-features">
                        <li><strong>Cations:</strong> Positively charged ions formed by losing electrons</li>
                        <li><strong>Anions:</strong> Negatively charged ions formed by gaining electrons</li>
                        <li><strong>Main Group Metals:</strong> Lose electrons from outermost shell</li>
                        <li><strong>Transition Metals:</strong> Lose s electrons first, then d electrons</li>
                        <li><strong>Non-metals:</strong> Gain electrons to achieve noble gas configuration</li>
                    </ul>
                </div>
                <div class="tile-actions">
                    <button class="tile-btn" onclick="showIonFormationContent()">Learn More</button>
                </div>
            </div>



            <!-- Assessment Tile -->
            <div class="study-tile assessment">
                <div class="tile-header">
                    <h2>
                        <span class="custom-emoji emoji-nucleus"></span>
                        Assessment
                    </h2>
                    <p>Electron configuration focused examinations</p>
                </div>
                <div class="tile-content">
                    <ul class="tile-features">
                        <li><strong>Paper 1:</strong> Core Principles & Rules (50 marks)</li>
                        <li><strong>Paper 2:</strong> Exceptions & Complex Cases (50 marks)</li>
                        <li><strong>Paper 3:</strong> Ion Formation & Applications (60 marks)</li>
                        <li><strong>Mark Schemes:</strong> Detailed Edexcel-style marking criteria</li>
                        <li><strong>Timed Exams:</strong> Focused electron configuration assessments</li>
                    </ul>
                </div>
                <div class="tile-actions">
                    <button class="tile-btn" onclick="showAssessmentContent()">Learn More</button>
                </div>
            </div>
        </div>

        <!-- ======= Detailed Content Sections ======= -->
        <div id="detailedContent" style="display: none;">
            <!-- Overview Section -->
            <div id="overviewContent" class="content-section">
                <div class="content-header">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <button class="btn ghost" onclick="hideDetailedContent()" style="display: flex; align-items: center; gap: 8px;">
                            <span class="custom-emoji emoji-atom"></span>
                            ← Back to Tiles
                        </button>
                        <div style="flex: 1; text-align: center;">
                            <h2 style="color: var(--accent); font-size: 36px; margin: 0; display: flex; align-items: center; gap: 15px; justify-content: center;">
                                <span class="custom-emoji emoji-study"></span>
                                Overview - Master Electron Configuration
                            </h2>
                        </div>
                        <div style="width: 120px;"></div> <!-- Spacer for centering -->
                    </div>
                    <p style="color: var(--light); font-size: 18px; margin-bottom: 30px; opacity: 0.8;">
                        Welcome to your comprehensive journey into the world of electron configurations. This overview will introduce you to the fundamental concepts that govern how electrons arrange themselves in atoms.
                    </p>
                </div>

                <!-- Core Concepts Overview -->
                <div class="content-card">
                    <h3 style="color: var(--warning); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="custom-emoji emoji-atom"></span>
                        Core Concepts Overview
                    </h3>
                    <p style="color: var(--light); margin-bottom: 20px; font-style: italic;">
                        Essential principles that govern how electrons arrange themselves in atoms. These are the exact same definitions used in the main app's study and game modes.
                    </p>
                    
                    <div class="concepts-grid">
                        <div class="concept-item" onclick="showConceptDetails('aufbau')">
                            <div class="concept-icon">1</div>
                            <div class="concept-content">
                                <h4>Aufbau principle</h4>
                                <p>Electrons occupy the lowest-energy available subshells first.</p>
                                <div class="concept-preview">1s → 2s → 2p → 3s → 3p → 4s → 3d</div>
                            </div>
                        </div>
                        <div class="concept-item" onclick="showConceptDetails('hund')">
                            <div class="concept-icon">2</div>
                            <div class="concept-content">
                                <h4>Hund's rule</h4>
                                <p>In a set of degenerate orbitals (p, d, f), place one electron in each with the <b>same spin</b> before pairing.</p>
                                <div class="concept-preview">↑ ↑ ↑ (not ↑↓)</div>
                            </div>
                        </div>
                        <div class="concept-item" onclick="showConceptDetails('pauli')">
                            <div class="concept-icon">3</div>
                            <div class="concept-content">
                                <h4>Pauli exclusion principle</h4>
                                <p>Each orbital holds at most two electrons and they must have <b>opposite spins</b> (↑↓).</p>
                                <div class="concept-preview">↑↓ (2 electrons max per orbital)</div>
                            </div>
                        </div>
                        <div class="concept-item" onclick="showConceptDetails('exceptions')">
                            <div class="concept-icon">4</div>
                            <div class="concept-content">
                                <h4>Exceptions</h4>
                                <p>Special cases like Chromium and Copper</p>
                                <div class="concept-preview">Cr: [Ar] 4s¹ 3d⁵</div>
                            </div>
                        </div>
                        <div class="concept-item" onclick="showConceptDetails('ions')">
                            <div class="concept-icon">5</div>
                            <div class="concept-content">
                                <h4>Ion Formation</h4>
                                <p>How atoms gain or lose electrons</p>
                                <div class="concept-preview">Na → Na⁺ + e⁻</div>
                            </div>
                        </div>
                        <div class="concept-item" onclick="showConceptDetails('octet')">
                            <div class="concept-icon">6</div>
                            <div class="concept-content">
                                <h4>Octet Rule</h4>
                                <p>Atoms seek 8 valence electrons for stability</p>
                                <div class="concept-preview">Ne: 1s² 2s² 2p⁶</div>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- Electron Configuration Specifications -->
                <div class="content-card">
                    <h3 style="color: var(--accent); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="custom-emoji emoji-electron"></span>
                        Electron Configuration Specifications
                    </h3>
                    <p style="color: var(--light); margin-bottom: 20px;">
                        Key learning objectives for mastering electron configuration principles
                    </p>
                    
                    <div class="specs-grid">
                        <div class="spec-category">
                            <h4 style="color: var(--warning); margin-bottom: 15px;">📚 Core Principles</h4>
                            <ul class="spec-list">
                                <li>Write electron configurations for elements up to Z=36</li>
                                <li>Understand the Aufbau principle and energy level order</li>
                                <li>Apply Hund's rule to degenerate orbitals</li>
                                <li>Explain the Pauli exclusion principle and opposite spins</li>
                            </ul>
                        </div>
                        
                        <div class="spec-category">
                            <h4 style="color: var(--success); margin-bottom: 15px;">🎯 Advanced Concepts</h4>
                            <ul class="spec-list">
                                <li>Explain exceptions like Cr and Cu configurations</li>
                                <li>Understand ion formation and oxidation states</li>
                                <li>Apply the octet rule to predict stability</li>
                                <li>Relate configuration to periodic trends</li>
                            </ul>
                        </div>
                        
                        <div class="spec-category">
                            <h4 style="color: var(--accent); margin-bottom: 15px;">🔬 Practical Skills</h4>
                            <ul class="spec-list">
                                <li>Use noble gas notation for configurations</li>
                                <li>Predict chemical properties from configurations</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Key Vocabulary -->
                <div class="content-card">
                    <h3 style="color: var(--warning); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="custom-emoji emoji-beaker"></span>
                        Key Vocabulary
                    </h3>
                    <p style="color: var(--light); margin-bottom: 20px;">
                        Essential terms and definitions for electron configuration
                    </p>
                    
                    <div class="vocabulary-grid">
                        <div class="vocab-item" onclick="showVocabDefinition('aufbau')">
                            <div class="vocab-term">Aufbau Principle</div>
                            <div class="vocab-preview">Electrons fill orbitals in order of increasing energy</div>
                        </div>
                        <div class="vocab-item" onclick="showVocabDefinition('hund')">
                            <div class="vocab-term">Hund's Rule</div>
                            <div class="vocab-preview">Electrons prefer parallel spins in degenerate orbitals</div>
                        </div>
                        <div class="vocab-item" onclick="showVocabDefinition('pauli')">
                            <div class="vocab-term">Pauli Exclusion</div>
                            <div class="vocab-preview">No two electrons can have identical quantum numbers; opposite spins required</div>
                        </div>
                        <div class="vocab-item" onclick="showVocabDefinition('degenerate')">
                            <div class="vocab-term">Degenerate Orbitals</div>
                            <div class="vocab-preview">Orbitals with the same energy level</div>
                        </div>
                        <div class="vocab-item" onclick="showVocabDefinition('valence')">
                            <div class="vocab-term">Valence Electrons</div>
                            <div class="vocab-preview">Electrons in the outermost shell</div>
                        </div>
                        <div class="vocab-item" onclick="showVocabDefinition('octet')">
                            <div class="vocab-term">Octet Rule</div>
                            <div class="vocab-preview">Atoms seek 8 valence electrons for stability</div>
                        </div>
                    </div>
                </div>

                <!-- Why It Matters -->
                <div class="content-card">
                    <h3 style="color: var(--success); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="custom-emoji emoji-beaker"></span>
                        Why Electron Configurations Matter
                    </h3>
                    <p style="color: var(--light); margin-bottom: 20px;">
                        Electron configurations determine an element's chemical properties, reactivity, and bonding behavior. Understanding these principles is essential for:
                    </p>
                    <div class="importance-grid">
                        <div class="importance-item">
                            <div class="importance-icon">🧪</div>
                            <h4>Chemical Reactions</h4>
                            <p>Predict how elements will react with each other</p>
                        </div>
                        <div class="importance-item">
                            <div class="importance-icon">📊</div>
                            <h4>Periodic Trends</h4>
                            <p>Understand patterns across the periodic table</p>
                        </div>
                        <div class="importance-item">
                            <div class="importance-icon">🔗</div>
                            <h4>Bonding Patterns</h4>
                            <p>Explain how atoms form molecules</p>
                        </div>
                        <div class="importance-item">
                            <div class="importance-icon">🏗️</div>
                            <h4>Material Design</h4>
                            <p>Create new materials with desired properties</p>
                        </div>
                    </div>
                </div>

                <!-- Overview Progress Tracker -->
                <div class="content-card" id="overviewProgressCard">
                    <h3 style="color: var(--success); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="custom-emoji emoji-energy"></span>
                        Overview Progress
                    </h3>
                    <div class="progress-tracker" id="overviewProgressTracker">
                        <div class="progress-item" data-completed="false" id="progress-core-concepts">
                            <span class="progress-checkbox">☐</span>
                            <span class="progress-text">Read Core Concepts Overview</span>
                        </div>
                        <div class="progress-item" data-completed="false" id="progress-learning-objectives">
                            <span class="progress-checkbox">☐</span>
                            <span class="progress-text">Review Learning Objectives</span>
                        </div>
                        <div class="progress-item" data-completed="false" id="progress-importance">
                            <span class="progress-checkbox">☐</span>
                            <span class="progress-text">Understand Importance Section</span>
                        </div>
                        <div class="progress-item" data-completed="false" id="progress-assessment">
                            <span class="progress-checkbox">☐</span>
                            <span class="progress-text">Complete Overview Assessment</span>
                        </div>
                    </div>
                    <div class="overall-progress" id="overviewOverallProgress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="overviewProgressFill" style="width: 0%"></div>
                        </div>
                        <span class="progress-text" id="overviewProgressText">0% Complete</span>
                    </div>
                    <div class="progress-actions" style="margin-top: 20px; text-align: center;">
                        <button class="btn primary" onclick="showOverviewAssessment()" id="showAssessmentBtn">
                            <span class="custom-emoji emoji-study"></span>
                            Take Overview Assessment
                        </button>
                    </div>
                </div>

                <!-- Overview Assessment Section -->
                <div class="content-card" id="overviewAssessmentCard" style="display: none;">
                    <h3 style="color: var(--accent); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <span class="custom-emoji emoji-study"></span>
                        Overview Assessment
                    </h3>
                    <p style="color: var(--light); margin-bottom: 20px;">
                        Test your understanding of the overview content. Answer all questions to complete the overview section.
                    </p>
                    
                    <div class="assessment-questions">
                        <!-- Question 1 -->
                        <div class="question-card" id="overviewQ1">
                            <h4 style="color: var(--warning); margin-bottom: 15px;">Question 1: Core Principles</h4>
                            <p style="color: var(--light); margin-bottom: 15px;">
                                According to the Aufbau principle, electrons occupy orbitals in what order?
                            </p>
                            <div class="question-options">
                                <label class="option-label">
                                    <input type="radio" name="overviewQ1" value="a">
                                    <span class="option-text">Highest energy first</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ1" value="b">
                                    <span class="option-text">Lowest energy first</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ1" value="c">
                                    <span class="option-text">Random order</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ1" value="d">
                                    <span class="option-text">Alphabetical order</span>
                                </label>
                            </div>
                        </div>

                        <!-- Question 2 -->
                        <div class="question-card" id="overviewQ2">
                            <h4 style="color: var(--warning); margin-bottom: 15px;">Question 2: Hund's Rule</h4>
                            <p style="color: var(--light); margin-bottom: 15px;">
                                In a set of degenerate orbitals, how should electrons be placed according to Hund's rule?
                            </p>
                            <div class="question-options">
                                <label class="option-label">
                                    <input type="radio" name="overviewQ2" value="a">
                                    <span class="option-text">Pair electrons first, then fill singly</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ2" value="b">
                                    <span class="option-text">Place one electron in each orbital with same spin, then pair</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ2" value="c">
                                    <span class="option-text">Fill orbitals randomly</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ2" value="d">
                                    <span class="option-text">Fill orbitals in numerical order</span>
                                </label>
                            </div>
                        </div>

                        <!-- Question 3 -->
                        <div class="question-card" id="overviewQ3">
                            <h4 style="color: var(--warning); margin-bottom: 15px;">Question 3: Pauli Exclusion Principle</h4>
                            <p style="color: var(--light); margin-bottom: 15px;">
                                What is the maximum number of electrons that can occupy a single orbital?
                            </p>
                            <div class="question-options">
                                <label class="option-label">
                                    <input type="radio" name="overviewQ3" value="a">
                                    <span class="option-text">1 electron</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ3" value="b">
                                    <span class="option-text">2 electrons</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ3" value="c">
                                    <span class="option-text">4 electrons</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ3" value="d">
                                    <span class="option-text">8 electrons</span>
                                </label>
                            </div>
                        </div>

                        <!-- Question 4 -->
                        <div class="question-card" id="overviewQ4">
                            <h4 style="color: var(--warning); margin-bottom: 15px;">Question 4: Exceptions</h4>
                            <p style="color: var(--light); margin-bottom: 15px;">
                                Which elements are known for having exceptions to the normal electron configuration order?
                            </p>
                            <div class="question-options">
                                <label class="option-label">
                                    <input type="radio" name="overviewQ4" value="a">
                                    <span class="option-text">Sodium and Potassium</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ4" value="b">
                                    <span class="option-text">Chromium and Copper</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ4" value="c">
                                    <span class="option-text">Helium and Neon</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ4" value="d">
                                    <span class="option-text">All elements have exceptions</span>
                                </label>
                            </div>
                        </div>

                        <!-- Question 5 -->
                        <div class="question-card" id="overviewQ5">
                            <h4 style="color: var(--warning); margin-bottom: 15px;">Question 5: Ion Formation</h4>
                            <p style="color: var(--light); margin-bottom: 15px;">
                                When a sodium atom (Na) forms an ion, what happens to its electron configuration?
                            </p>
                            <div class="question-options">
                                <label class="option-label">
                                    <input type="radio" name="overviewQ5" value="a">
                                    <span class="option-text">Gains an electron</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ5" value="b">
                                    <span class="option-text">Loses an electron</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ5" value="c">
                                    <span class="option-text">Gains two electrons</span>
                                </label>
                                <label class="option-label">
                                    <input type="radio" name="overviewQ5" value="d">
                                    <span class="option-text">No change occurs</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="assessment-actions">
                        <button class="btn primary" onclick="submitOverviewAssessment()" id="submitOverviewBtn">
                            <span class="custom-emoji emoji-check"></span>
                            Submit Assessment
                        </button>
                        <button class="btn secondary" onclick="resetOverviewAssessment()" id="resetOverviewBtn">
                            <span class="custom-emoji emoji-refresh"></span>
                            Reset Answers
                        </button>
                    </div>

                    <div class="assessment-results" id="overviewAssessmentResults" style="display: none;">
                        <div class="results-card">
                            <h4 style="color: var(--success); margin-bottom: 15px;">Assessment Complete!</h4>
                            <div class="score-display">
                                <span class="score-text">Score: </span>
                                <span class="score-value" id="overviewScore">0/5</span>
                            </div>
                            <div class="completion-message" id="overviewCompletionMessage">
                                Great job! You've completed the overview assessment.
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- ======= Ion Formation Detailed Content ======= -->
        <div id="ionFormationContent" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hideDetailedContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span class="custom-emoji emoji-arrow-left"></span>
                    Back to Study Guide
                </button>
                <h1 class="content-title">
                    <span class="custom-emoji emoji-beaker"></span>
                    Ion Formation
                </h1>
                <p class="content-subtitle">Understanding how atoms gain and lose electrons to form ions</p>
            </div>

            <!-- Learning Objectives -->
            <div class="objectives-section">
                <h3>Learning Objectives</h3>
                <p>By the end of this section, you will be able to:</p>
                <div class="objectives-grid">
                    <div class="objective-card">
                        <h4>🎯 Cation Formation</h4>
                        <p>Explain how metals lose electrons to form positive ions</p>
                        <ul>
                            <li>Understand electron loss from s and d orbitals</li>
                            <li>Predict ion charges for main group metals</li>
                            <li>Explain transition metal ion formation</li>
                        </ul>
                    </div>
                    <div class="objective-card">
                        <h4>⚡ Anion Formation</h4>
                        <p>Describe how non-metals gain electrons to form negative ions</p>
                        <ul>
                            <li>Understand electron gain to achieve noble gas configuration</li>
                            <li>Predict ion charges for non-metals</li>
                            <li>Explain ionic radius changes</li>
                        </ul>
                    </div>
                    <div class="objective-card">
                        <h4>🔬 Transition Metals</h4>
                        <p>Analyze the complex ion formation of transition metals</p>
                        <ul>
                            <li>Understand s-orbital electron loss first</li>
                            <li>Explain variable oxidation states</li>
                            <li>Predict common ion charges</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Essential Vocabulary -->
            <div class="vocabulary-section">
                <h3>Essential Vocabulary</h3>
                <div class="vocabulary-grid">
                    <div class="vocab-item">
                        <strong>Ion</strong>
                        <p>An atom or molecule with a net electric charge due to the loss or gain of electrons</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Cation</strong>
                        <p>A positively charged ion formed when an atom loses electrons</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Anion</strong>
                        <p>A negatively charged ion formed when an atom gains electrons</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Ionic Radius</strong>
                        <p>The size of an ion, which changes when electrons are gained or lost</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Oxidation State</strong>
                        <p>The charge an atom would have if all bonds were ionic</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Noble Gas Configuration</strong>
                        <p>The stable electron configuration of noble gases (full outer shell)</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Isoelectronic</strong>
                        <p>Ions or atoms with the same number of electrons</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Variable Oxidation States</strong>
                        <p>Transition metals that can form ions with different charges</p>
                    </div>
                </div>
            </div>

            <!-- Cation Formation Overview -->
            <div class="concept-section">
                <h3>🔬 Cation Formation</h3>
                <p>Cations are formed when atoms <strong>lose electrons</strong>. This typically occurs with metals, which have relatively low ionization energies.</p>
                
                <div class="ion-formation-grid">
                    <div class="formation-card">
                        <h4>Main Group Metals</h4>
                        <p>Lose electrons from their outermost shell to achieve noble gas configuration</p>
                        <div class="example-box">
                            <strong>Example: Sodium (Na)</strong>
                            <p>Na: 1s² 2s² 2p⁶ 3s¹ → Na⁺: 1s² 2s² 2p⁶</p>
                            <p>Loses 1 electron from 3s orbital</p>
                        </div>
                    </div>
                    <div class="formation-card">
                        <h4>Transition Metals</h4>
                        <p>Lose electrons from s orbitals first, then d orbitals</p>
                        <div class="example-box">
                            <strong>Example: Iron (Fe)</strong>
                            <p>Fe: [Ar] 4s² 3d⁶ → Fe²⁺: [Ar] 3d⁶</p>
                            <p>Loses 2 electrons from 4s orbital</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Anion Formation Overview -->
            <div class="concept-section">
                <h3>⚡ Anion Formation</h3>
                <p>Anions are formed when atoms <strong>gain electrons</strong>. This typically occurs with non-metals, which have high electron affinities.</p>
                
                <div class="ion-formation-grid">
                    <div class="formation-card">
                        <h4>Halogens</h4>
                        <p>Gain 1 electron to achieve noble gas configuration</p>
                        <div class="example-box">
                            <strong>Example: Chlorine (Cl)</strong>
                            <p>Cl: [Ne] 3s² 3p⁵ → Cl⁻: [Ne] 3s² 3p⁶</p>
                            <p>Gains 1 electron in 3p orbital</p>
                        </div>
                    </div>
                    <div class="formation-card">
                        <h4>Chalcogens</h4>
                        <p>Gain 2 electrons to achieve noble gas configuration</p>
                        <div class="example-box">
                            <strong>Example: Oxygen (O)</strong>
                            <p>O: [He] 2s² 2p⁴ → O²⁻: [He] 2s² 2p⁶</p>
                            <p>Gains 2 electrons in 2p orbital</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Demonstrations -->
            <div class="interactive-section">
                <h3>🎮 Interactive Ion Formation Demonstrations</h3>
                <p>Explore how different elements form ions by gaining or losing electrons.</p>
                
                <!-- Cation Formation Demo -->
                <div class="ion-demo">
                    <h4>🔬 Cation Formation: Sodium (Na → Na⁺)</h4>
                    <div class="demo-layout">
                        <div class="building" id="sodiumBuilding">
                            <!-- Shell n=3 (Highest Energy - Top) -->
                            <div class="floor" data-n="3">
                                <div class="floor-label">Shell n=3 (Highest Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="3s">
                                        <div class="wing-title">3s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="3s" data-index="0">
                                                <div class="unit-label">3s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3s-2"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Shell n=2 -->
                            <div class="floor" data-n="2">
                                <div class="floor-label">Shell n=2</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="2s">
                                        <div class="wing-title">2s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2s" data-index="0">
                                                <div class="unit-label">2s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="wing wing-p" data-sub="2p">
                                        <div class="wing-title">2p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2p" data-index="0">
                                                <div class="unit-label">2px</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-2">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="1">
                                                <div class="unit-label">2py</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-3">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-4">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="2">
                                                <div class="unit-label">2pz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-5">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-6">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Shell n=1 (Lowest Energy - Bottom) -->
                            <div class="floor" data-n="1">
                                <div class="floor-label">Shell n=1 (Lowest Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="1s">
                                        <div class="wing-title">1s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="1s" data-index="0">
                                                <div class="unit-label">1s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="1s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="1s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="config-display">
                            <h5>Electron Configuration</h5>
                            <div class="config-text">
                                <div class="config-standard" id="sodiumStandard">Na: 1s² 2s² 2p⁶ 3s¹</div>
                                <div class="config-actual" id="sodiumActual">Na⁺: 1s² 2s² 2p⁶</div>
                            </div>
                        </div>
                    </div>
                    <div class="demo-controls">
                        <button class="btn primary" onclick="showSodiumCation()">Show Cation Formation</button>
                        <button class="btn secondary" onclick="resetSodiumDemo()">Reset</button>
                    </div>
                </div>

                <!-- Anion Formation Demo -->
                <div class="ion-demo">
                    <h4>⚡ Anion Formation: Chlorine (Cl → Cl⁻)</h4>
                    <div class="demo-layout">
                        <div class="building" id="chlorineBuilding">
                            <!-- Shell n=3 (Highest Energy - Top) -->
                            <div class="floor" data-n="3">
                                <div class="floor-label">Shell n=3 (Highest Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="3s">
                                        <div class="wing-title">3s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="3s" data-index="0">
                                                <div class="unit-label">3s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="wing wing-p" data-sub="3p">
                                        <div class="wing-title">3p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="3p" data-index="0">
                                                <div class="unit-label">3px</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3p-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3p-2">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="3p" data-index="1">
                                                <div class="unit-label">3py</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3p-3">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3p-4">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="3p" data-index="2">
                                                <div class="unit-label">3pz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3p-5">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3p-6"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Shell n=2 -->
                            <div class="floor" data-n="2">
                                <div class="floor-label">Shell n=2</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="2s">
                                        <div class="wing-title">2s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2s" data-index="0">
                                                <div class="unit-label">2s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="wing wing-p" data-sub="2p">
                                        <div class="wing-title">2p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2p" data-index="0">
                                                <div class="unit-label">2px</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-2">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="1">
                                                <div class="unit-label">2py</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-3">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-4">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="2">
                                                <div class="unit-label">2pz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-5">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-6">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Shell n=1 (Lowest Energy - Bottom) -->
                            <div class="floor" data-n="1">
                                <div class="floor-label">Shell n=1 (Lowest Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="1s">
                                        <div class="wing-title">1s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="1s" data-index="0">
                                                <div class="unit-label">1s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="1s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="1s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="config-display">
                            <h5>Electron Configuration</h5>
                            <div class="config-text">
                                <div class="config-standard" id="chlorineStandard">Cl: [Ne] 3s² 3p⁵</div>
                                <div class="config-actual" id="chlorineActual">Cl⁻: [Ne] 3s² 3p⁶</div>
                            </div>
                        </div>
                    </div>
                    <div class="demo-controls">
                        <button class="btn primary" onclick="showChlorineAnion()">Show Anion Formation</button>
                        <button class="btn secondary" onclick="resetChlorineDemo()">Reset</button>
                    </div>
                </div>

                <!-- Transition Metal Demo -->
                <div class="ion-demo">
                    <h4>🔬 Transition Metal: Iron (Fe → Fe²⁺)</h4>
                    <div class="demo-layout">
                        <div class="building" id="ironBuilding">
                            <!-- Shell n=4 (Highest Energy - Top) -->
                            <div class="floor" data-n="4">
                                <div class="floor-label">Shell n=4 (Highest Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="4s">
                                        <div class="wing-title">4s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="4s" data-index="0">
                                                <div class="unit-label">4s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="4s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="4s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Shell n=3 -->
                            <div class="floor" data-n="3">
                                <div class="floor-label">Shell n=3</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="3s">
                                        <div class="wing-title">3s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="3s" data-index="0">
                                                <div class="unit-label">3s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="wing wing-p" data-sub="3p">
                                        <div class="wing-title">3p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="3p" data-index="0">
                                                <div class="unit-label">3px</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3p-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3p-2">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="3p" data-index="1">
                                                <div class="unit-label">3py</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3p-3">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3p-4">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="3p" data-index="2">
                                                <div class="unit-label">3pz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3p-5">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3p-6">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="wing wing-d" data-sub="3d">
                                        <div class="wing-title">3d wing — <span class="mini">ℓ=2 (d)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="3d" data-index="0">
                                                <div class="unit-label">3dxy</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3d-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3d-2">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="3d" data-index="1">
                                                <div class="unit-label">3dxz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3d-3">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3d-4">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="3d" data-index="2">
                                                <div class="unit-label">3dyz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="3d-5">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="3d-6">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Shell n=2 -->
                            <div class="floor" data-n="2">
                                <div class="floor-label">Shell n=2</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="2s">
                                        <div class="wing-title">2s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2s" data-index="0">
                                                <div class="unit-label">2s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="wing wing-p" data-sub="2p">
                                        <div class="wing-title">2p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2p" data-index="0">
                                                <div class="unit-label">2px</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-2">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="1">
                                                <div class="unit-label">2py</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-3">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-4">↓</div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="2">
                                                <div class="unit-label">2pz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-5">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-6">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Shell n=1 (Lowest Energy - Bottom) -->
                            <div class="floor" data-n="1">
                                <div class="floor-label">Shell n=1 (Lowest Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="1s">
                                        <div class="wing-title">1s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="1s" data-index="0">
                                                <div class="unit-label">1s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="1s-1">↑</div>
                                                    <div class="slot" data-slot="1" data-orbital="1s-2">↓</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="config-display">
                            <h5>Electron Configuration</h5>
                            <div class="config-text">
                                <div class="config-standard" id="ironStandard">Fe: [Ar] 4s² 3d⁶</div>
                                <div class="config-actual" id="ironActual">Fe²⁺: [Ar] 3d⁶</div>
                            </div>
                        </div>
                    </div>
                    <div class="demo-controls">
                        <button class="btn primary" onclick="showIronCation()">Show Fe²⁺ Formation</button>
                        <button class="btn secondary" onclick="resetIronDemo()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Vocabulary Quiz -->
            <div class="quiz-section">
                <h3>📝 Vocabulary Quiz</h3>
                <p>Test your understanding of ion formation terminology.</p>
                <div class="quiz-container" id="ionVocabQuiz">
                    <div class="quiz-question">
                        <h4>Question 1: What is a cation?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="q1" value="a"> A negatively charged ion</label>
                            <label><input type="radio" name="q1" value="b"> A positively charged ion</label>
                            <label><input type="radio" name="q1" value="c"> A neutral atom</label>
                            <label><input type="radio" name="q1" value="d"> A noble gas</label>
                        </div>
                    </div>
                    <div class="quiz-question">
                        <h4>Question 2: How do transition metals typically lose electrons?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="q2" value="a"> From d orbitals first</label>
                            <label><input type="radio" name="q2" value="b"> From s orbitals first, then d orbitals</label>
                            <label><input type="radio" name="q2" value="c"> From p orbitals first</label>
                            <label><input type="radio" name="q2" value="d"> Randomly from any orbital</label>
                        </div>
                    </div>
                    <div class="quiz-question">
                        <h4>Question 3: What happens to ionic radius when an atom becomes a cation?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="q3" value="a"> It increases</label>
                            <label><input type="radio" name="q3" value="b"> It decreases</label>
                            <label><input type="radio" name="q3" value="c"> It stays the same</label>
                            <label><input type="radio" name="q3" value="d"> It becomes zero</label>
                        </div>
                    </div>
                    <div class="quiz-question">
                        <h4>Question 4: Which element forms a -2 anion?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="q4" value="a"> Fluorine</label>
                            <label><input type="radio" name="q4" value="b"> Oxygen</label>
                            <label><input type="radio" name="q4" value="c"> Nitrogen</label>
                            <label><input type="radio" name="q4" value="d"> Carbon</label>
                        </div>
                    </div>
                    <div class="quiz-question">
                        <h4>Question 5: What is the electron configuration of Na⁺?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="q5" value="a"> 1s² 2s² 2p⁶ 3s¹</label>
                            <label><input type="radio" name="q5" value="b"> 1s² 2s² 2p⁶</label>
                            <label><input type="radio" name="q5" value="c"> 1s² 2s² 2p⁶ 3s²</label>
                            <label><input type="radio" name="q5" value="d"> 1s² 2s² 2p⁵</label>
                        </div>
                    </div>
                    <div class="quiz-actions">
                        <button class="btn primary" onclick="checkIonVocabQuiz()">Submit Quiz</button>
                        <button class="btn secondary" onclick="resetIonVocabQuiz()">Reset</button>
                    </div>
                    <div class="quiz-results" id="ionVocabResults" style="display: none;"></div>
                </div>
            </div>

            <!-- Quick Understanding Check -->
            <div class="understanding-section">
                <h3>🧠 Quick Understanding Check</h3>
                <p>Apply your knowledge of ion formation to solve these problems.</p>
                <div class="understanding-container" id="ionUnderstandingCheck">
                    <div class="understanding-question">
                        <h4>Question 1: Predict the ion formed by magnesium (Mg)</h4>
                        <p><strong>Given:</strong> Mg has electron configuration [Ne] 3s²</p>
                        <div class="understanding-options">
                            <label><input type="radio" name="uq1" value="a"> Mg⁺ (loses 1 electron)</label>
                            <label><input type="radio" name="uq1" value="b"> Mg²⁺ (loses 2 electrons)</label>
                            <label><input type="radio" name="uq1" value="c"> Mg⁻ (gains 1 electron)</label>
                            <label><input type="radio" name="uq1" value="d"> Mg²⁻ (gains 2 electrons)</label>
                        </div>
                    </div>
                    <div class="understanding-question">
                        <h4>Question 2: Which ion has the same electron configuration as Argon?</h4>
                        <div class="understanding-options">
                            <label><input type="radio" name="uq2" value="a"> Cl⁻</label>
                            <label><input type="radio" name="uq2" value="b"> K⁺</label>
                            <label><input type="radio" name="uq2" value="c"> Both Cl⁻ and K⁺</label>
                            <label><input type="radio" name="uq2" value="d"> Neither</label>
                        </div>
                    </div>
                    <div class="understanding-question">
                        <h4>Question 3: What is the electron configuration of Fe³⁺?</h4>
                        <p><strong>Given:</strong> Fe has electron configuration [Ar] 4s² 3d⁶</p>
                        <div class="understanding-options">
                            <label><input type="radio" name="uq3" value="a"> [Ar] 4s² 3d³</label>
                            <label><input type="radio" name="uq3" value="b"> [Ar] 3d⁵</label>
                            <label><input type="radio" name="uq3" value="c"> [Ar] 4s¹ 3d⁶</label>
                            <label><input type="radio" name="uq3" value="d"> [Ar] 4s² 3d⁶</label>
                        </div>
                    </div>
                    <div class="understanding-actions">
                        <button class="btn primary" onclick="checkIonUnderstanding()">Submit Answers</button>
                        <button class="btn secondary" onclick="resetIonUnderstanding()">Reset</button>
                    </div>
                    <div class="understanding-results" id="ionUnderstandingResults" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- ======= Exceptions Detailed Content ======= -->
        <div id="exceptionsContent" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hideDetailedContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span>←</span> Back to Study Tiles
                </button>
                <h2>⚠️ Electron Configuration Exceptions</h2>
                <p>Understanding special cases where elements break standard rules for enhanced stability</p>
            </div>

            <!-- Learning Objectives -->
            <div class="objectives-section">
                <h3>🎯 Learning Objectives</h3>
                <div class="objectives-grid">
                    <div class="objective-card">
                        <h4>Exception Recognition</h4>
                        <p>Identify which elements have electron configuration exceptions</p>
                    </div>
                    <div class="objective-card">
                        <h4>Stability Principles</h4>
                        <p>Understand why half-filled and filled subshells provide extra stability</p>
                    </div>
                    <div class="objective-card">
                        <h4>Pattern Recognition</h4>
                        <p>Recognize the patterns in d-block exceptions (Cr, Cu, Mo, Ag, etc.)</p>
                    </div>
                    <div class="objective-card">
                        <h4>Configuration Writing</h4>
                        <p>Write correct electron configurations for exception elements</p>
                    </div>
                </div>
            </div>

            <!-- Essential Vocabulary -->
            <div class="vocabulary-section">
                <h3>📚 Essential Vocabulary</h3>
                <div class="vocabulary-grid">
                    <div class="vocab-card">
                        <h4>Exception Terms</h4>
                        <div class="vocab-item">
                            <strong>Exception:</strong> Element that doesn't follow standard Aufbau principle
                        </div>
                        <div class="vocab-item">
                            <strong>Half-filled subshell:</strong> Subshell with exactly half its maximum electrons
                        </div>
                        <div class="vocab-item">
                            <strong>Filled subshell:</strong> Subshell with its maximum number of electrons
                        </div>
                    </div>
                    <div class="vocab-card">
                        <h4>Stability Terms</h4>
                        <div class="vocab-item">
                            <strong>Extra stability:</strong> Additional energy stabilization from special configurations
                        </div>
                        <div class="vocab-item">
                            <strong>d-block elements:</strong> Transition metals with partially filled d orbitals
                        </div>
                        <div class="vocab-item">
                            <strong>Stability detour:</strong> Deviation from standard filling for greater stability
                        </div>
                    </div>
                    <div class="vocab-card">
                        <h4>Configuration Terms</h4>
                        <div class="vocab-item">
                            <strong>Standard configuration:</strong> What Aufbau principle predicts
                        </div>
                        <div class="vocab-item">
                            <strong>Actual configuration:</strong> What the element actually has
                        </div>
                        <div class="vocab-item">
                            <strong>Noble gas core:</strong> [Noble gas] notation for inner electrons
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exception Elements Overview -->
            <div class="content-card">
                <h3>🔍 Exception Elements Overview</h3>
                <p>These elements break the standard Aufbau principle to achieve greater stability through half-filled or filled subshells:</p>
                
                <div class="exceptions-grid">
                    <div class="exception-item">
                        <h4>Chromium (Cr) - Z=24</h4>
                        <div class="config-comparison">
                            <div class="config-standard">
                                <strong>Standard:</strong> [Ar] 4s² 3d⁴
                            </div>
                            <div class="config-actual">
                                <strong>Actual:</strong> [Ar] 4s¹ 3d⁵
                            </div>
                        </div>
                        <p><strong>Why:</strong> Half-filled 3d subshell (5 electrons) provides extra stability</p>
                    </div>

                    <div class="exception-item">
                        <h4>Copper (Cu) - Z=29</h4>
                        <div class="config-comparison">
                            <div class="config-standard">
                                <strong>Standard:</strong> [Ar] 4s² 3d⁹
                            </div>
                            <div class="config-actual">
                                <strong>Actual:</strong> [Ar] 4s¹ 3d¹⁰
                            </div>
                        </div>
                        <p><strong>Why:</strong> Filled 3d subshell (10 electrons) provides maximum stability</p>
                    </div>

                    <div class="exception-item">
                        <h4>Molybdenum (Mo) - Z=42</h4>
                        <div class="config-comparison">
                            <div class="config-standard">
                                <strong>Standard:</strong> [Kr] 5s² 4d⁴
                            </div>
                            <div class="config-actual">
                                <strong>Actual:</strong> [Kr] 5s¹ 4d⁵
                            </div>
                        </div>
                        <p><strong>Why:</strong> Half-filled 4d subshell provides extra stability</p>
                    </div>

                    <div class="exception-item">
                        <h4>Silver (Ag) - Z=47</h4>
                        <div class="config-comparison">
                            <div class="config-standard">
                                <strong>Standard:</strong> [Kr] 5s² 4d⁹
                            </div>
                            <div class="config-actual">
                                <strong>Actual:</strong> [Kr] 5s¹ 4d¹⁰
                            </div>
                        </div>
                        <p><strong>Why:</strong> Filled 4d subshell provides maximum stability</p>
                    </div>
                </div>
            </div>

            <!-- Interactive Exception Demonstrations -->
            <div class="content-card">
                <h3>🎮 Interactive Exception Demonstrations</h3>
                
                <!-- Chromium Exception Demo -->
                <div class="interactive-section">
                    <h4>Chromium (Cr) Exception</h4>
                    <p>Watch how Chromium achieves stability by moving one electron from 4s to 3d:</p>
                    
                    <div class="exception-demo">
                        <div class="demo-layout">
                            <div class="building" id="chromiumBuilding">
                                <div class="floor">
                                    <div class="floor-label">Shell n=3</div>
                                    <div class="wings">
                                        <div class="wing">
                                            <div class="wing-title">3d orbitals <span class="degenerate-label">DEGENERATE</span></div>
                                            <div class="units">
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d1"></div>
                                                        <div class="slot" data-orbital="3d2"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d3"></div>
                                                        <div class="slot" data-orbital="3d4"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d5"></div>
                                                        <div class="slot" data-orbital="3d6"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d7"></div>
                                                        <div class="slot" data-orbital="3d8"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d9"></div>
                                                        <div class="slot" data-orbital="3d10"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="floor">
                                    <div class="floor-label">Shell n=4</div>
                                    <div class="wings">
                                        <div class="wing">
                                            <div class="wing-title">4s orbital</div>
                                            <div class="units">
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="4s1"></div>
                                                        <div class="slot" data-orbital="4s2"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="config-display">
                                <h5>Configuration</h5>
                                <div class="config-text">
                                    Standard: <span class="config-standard" id="chromiumStandard">4s² 3d⁴</span>
                                </div>
                                <div class="config-text">
                                    Actual: <span class="config-actual" id="chromiumActual">4s¹ 3d⁵</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="demo-controls">
                            <button class="tile-btn" onclick="showChromiumException()">Show Cr Exception</button>
                            <button class="tile-btn secondary" onclick="resetChromiumDemo()">Reset</button>
                        </div>
                    </div>
                </div>

                <!-- Copper Exception Demo -->
                <div class="interactive-section">
                    <h4>Copper (Cu) Exception</h4>
                    <p>Watch how Copper achieves stability by moving one electron from 4s to 3d:</p>
                    
                    <div class="exception-demo">
                        <div class="demo-layout">
                            <div class="building" id="copperBuilding">
                                <div class="floor">
                                    <div class="floor-label">Shell n=3</div>
                                    <div class="wings">
                                        <div class="wing">
                                            <div class="wing-title">3d orbitals <span class="degenerate-label">DEGENERATE</span></div>
                                            <div class="units">
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d1"></div>
                                                        <div class="slot" data-orbital="3d2"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d3"></div>
                                                        <div class="slot" data-orbital="3d4"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d5"></div>
                                                        <div class="slot" data-orbital="3d6"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d7"></div>
                                                        <div class="slot" data-orbital="3d8"></div>
                                                    </div>
                                                </div>
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="3d9"></div>
                                                        <div class="slot" data-orbital="3d10"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="floor">
                                    <div class="floor-label">Shell n=4</div>
                                    <div class="wings">
                                        <div class="wing">
                                            <div class="wing-title">4s orbital</div>
                                            <div class="units">
                                                <div class="unit">
                                                    <div class="slots">
                                                        <div class="slot" data-orbital="4s1"></div>
                                                        <div class="slot" data-orbital="4s2"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="config-display">
                                <h5>Configuration</h5>
                                <div class="config-text">
                                    Standard: <span class="config-standard" id="copperStandard">4s² 3d⁹</span>
                                </div>
                                <div class="config-text">
                                    Actual: <span class="config-actual" id="copperActual">4s¹ 3d¹⁰</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="demo-controls">
                            <button class="tile-btn" onclick="showCopperException()">Show Cu Exception</button>
                            <button class="tile-btn secondary" onclick="resetCopperDemo()">Reset</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vocabulary Quiz -->
            <div class="vocab-quiz-section">
                <h3>🧠 Vocabulary Quiz</h3>
                <div class="quiz-container">
                    <div class="quiz-question">
                        <h4>Question 1: What is an electron configuration exception?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="exceptions1" value="a"> A) An element that follows Aufbau principle perfectly</label>
                            <label><input type="radio" name="exceptions1" value="b"> B) An element that breaks standard rules for greater stability</label>
                            <label><input type="radio" name="exceptions1" value="c"> C) An element with no d electrons</label>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 2: Why does Chromium have the configuration [Ar] 4s¹ 3d⁵?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="exceptions2" value="a"> A) It follows the standard Aufbau principle</label>
                            <label><input type="radio" name="exceptions2" value="b"> B) Half-filled 3d subshell provides extra stability</label>
                            <label><input type="radio" name="exceptions2" value="c"> C) It has too many electrons</label>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 3: What configuration does Copper (Cu) actually have?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="exceptions3" value="a"> A) [Ar] 4s² 3d⁹</label>
                            <label><input type="radio" name="exceptions3" value="b"> B) [Ar] 4s¹ 3d¹⁰</label>
                            <label><input type="radio" name="exceptions3" value="c"> C) [Ar] 4s² 3d⁸</label>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 4: What provides extra stability in exception elements?</h4>
                        <div class="quiz-options">
                            <label><input type="radio" name="exceptions4" value="a"> A) Empty subshells</label>
                            <label><input type="radio" name="exceptions4" value="b"> B) Half-filled and filled subshells</label>
                            <label><input type="radio" name="exceptions4" value="c"> C) Random electron arrangements</label>
                        </div>
                    </div>

                    <div class="quiz-controls">
                        <button class="tile-btn" onclick="checkExceptionsQuiz()">Check Answers</button>
                        <button class="tile-btn secondary" onclick="resetExceptionsQuiz()">Reset Quiz</button>
                    </div>

                    <div class="pauli-feedback" id="exceptionsResults" style="display: none;"></div>
                </div>
            </div>

            <!-- Quick Understanding Check -->
            <div class="content-card">
                <h3>⚡ Quick Understanding Check</h3>
                <div class="understanding-quiz">
                    <div class="quiz-question">
                        <h4>Question 1: Which element has the exception configuration [Ar] 4s¹ 3d⁵?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkExceptionAnswer(1, 'a')">A) Manganese (Mn)</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(1, 'b')">B) Chromium (Cr)</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(1, 'c')">C) Iron (Fe)</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 2: Why do exception elements break the Aufbau principle?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkExceptionAnswer(2, 'a')">A) They have too many electrons</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(2, 'b')">B) Half-filled and filled subshells provide extra stability</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(2, 'c')">C) They follow different rules</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 3: What is the actual configuration of Silver (Ag)?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkExceptionAnswer(3, 'a')">A) [Kr] 5s² 4d⁹</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(3, 'b')">B) [Kr] 5s¹ 4d¹⁰</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(3, 'c')">C) [Kr] 5s² 4d⁸</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 4: How many electrons are in a half-filled d subshell?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkExceptionAnswer(4, 'a')">A) 3 electrons</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(4, 'b')">B) 5 electrons</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(4, 'c')">C) 7 electrons</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 5: Which of these is NOT an exception element?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkExceptionAnswer(5, 'a')">A) Chromium (Cr)</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(5, 'b')">B) Copper (Cu)</button>
                            <button class="quiz-option" onclick="checkExceptionAnswer(5, 'c')">C) Calcium (Ca)</button>
                        </div>
                    </div>
                </div>

                <div class="quiz-results" id="exceptionQuizResults" style="display: none;">
                    <h4 style="color: var(--success);">Quiz Results</h4>
                    <p>Score: <span id="exceptionQuizScore">0</span>/5</p>
                    <p id="exceptionQuizFeedback"></p>
                </div>

                <div class="quiz-controls">
                    <button class="tile-btn" onclick="showExceptionQuizResults()">Show Results</button>
                    <button class="tile-btn secondary" onclick="resetExceptionQuiz()">Reset Quiz</button>
                </div>
            </div>
        </div>

        <!-- ======= Assessment Detailed Content ======= -->
        <div id="assessmentContent" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hideDetailedContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span class="custom-emoji emoji-arrow-left"></span>
                    Back to Study Guide
                </button>
                <h1 class="content-title">
                    <span class="custom-emoji emoji-nucleus"></span>
                    A-Level Edexcel Pearson Assessment
                </h1>
                <p class="content-subtitle">Comprehensive examination-style assessments with detailed mark schemes</p>
            </div>

            <!-- Assessment Overview -->
            <div class="objectives-section">
                <h3>📋 Electron Configuration Assessment Structure</h3>
                <p>Comprehensive assessments focused specifically on electron configuration topics:</p>
                <div class="objectives-grid">
                    <div class="objective-card">
                        <h4>📄 Paper 1: Core Principles & Rules</h4>
                        <p><strong>Duration:</strong> 45 minutes | <strong>Marks:</strong> 50</p>
                        <ul>
                            <li>Aufbau Principle & Orbital Filling</li>
                            <li>Hund's Rule & Electron Spin</li>
                            <li>Pauli Exclusion Principle</li>
                            <li>Orbital Diagrams & Notation</li>
                            <li>Energy Level Ordering</li>
                        </ul>
                    </div>
                    <div class="objective-card">
                        <h4>🧪 Paper 2: Exceptions & Complex Cases</h4>
                        <p><strong>Duration:</strong> 45 minutes | <strong>Marks:</strong> 50</p>
                        <ul>
                            <li>Transition Metal Exceptions (Cr, Cu, Mo, Ag)</li>
                            <li>Half-filled & Filled Subshell Stability</li>
                            <li>d-block Configuration Patterns</li>
                            <li>Exception Recognition & Explanation</li>
                            <li>Stability Factors</li>
                        </ul>
                    </div>
                    <div class="objective-card">
                        <h4>🔬 Paper 3: Ion Formation & Applications</h4>
                        <p><strong>Duration:</strong> 60 minutes | <strong>Marks:</strong> 60</p>
                        <ul>
                            <li>Cation Formation (Main Group & Transition Metals)</li>
                            <li>Anion Formation & Noble Gas Configuration</li>
                            <li>Isoelectronic Species</li>
                            <li>Ionic Radius Changes</li>
                            <li>Magnetic Properties Prediction</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Question Types Overview -->
            <div class="vocabulary-section">
                <h3>📝 Electron Configuration Question Types</h3>
                <div class="vocabulary-grid">
                    <div class="vocab-item">
                        <strong>Configuration Writing Questions</strong>
                        <p>2-4 marks each - Write electron configurations for given elements, including exceptions.</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Orbital Diagram Questions</strong>
                        <p>3-6 marks each - Draw orbital diagrams showing electron arrangement and spin.</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Exception Explanation Questions</strong>
                        <p>4-8 marks each - Explain why certain elements have unusual configurations.</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Ion Formation Questions</strong>
                        <p>3-6 marks each - Predict and write configurations for ions formed from neutral atoms.</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Comparison & Analysis Questions</strong>
                        <p>5-10 marks each - Compare configurations, identify patterns, and analyze trends.</p>
                    </div>
                    <div class="vocab-item">
                        <strong>Application Questions</strong>
                        <p>4-8 marks each - Apply configuration knowledge to predict properties and behavior.</p>
                    </div>
                </div>
            </div>

            <!-- Paper Selection -->
            <div class="interactive-section">
                <h3>🎯 Select Your Assessment</h3>
                <p>Choose a paper to begin your Edexcel-style examination practice:</p>
                
                <div class="ion-formation-grid">
                    <div class="formation-card">
                        <h4>📄 Paper 1: Core Principles & Rules</h4>
                        <p>Master the fundamental principles of electron configuration</p>
                        <div class="example-box">
                            <strong>Key Topics:</strong>
                            <p>• Aufbau principle application<br>
                            • Hund's rule & electron spin<br>
                            • Pauli exclusion principle<br>
                            • Orbital diagrams & notation</p>
                        </div>
                        <div class="demo-controls">
                            <button class="btn primary" onclick="startPaper1()">Start Paper 1</button>
                            <button class="btn secondary" onclick="viewPaper1MarkScheme()">View Mark Scheme</button>
                        </div>
                    </div>
                    <div class="formation-card">
                        <h4>🧪 Paper 2: Exceptions & Complex Cases</h4>
                        <p>Understand and explain electron configuration exceptions</p>
                        <div class="example-box">
                            <strong>Key Topics:</strong>
                            <p>• Transition metal exceptions (Cr, Cu)<br>
                            • Half-filled & filled subshell stability<br>
                            • d-block configuration patterns<br>
                            • Exception recognition & explanation</p>
                        </div>
                        <div class="demo-controls">
                            <button class="btn primary" onclick="startPaper2()">Start Paper 2</button>
                            <button class="btn secondary" onclick="viewPaper2MarkScheme()">View Mark Scheme</button>
                        </div>
                    </div>
                    <div class="formation-card">
                        <h4>🔬 Paper 3: Ion Formation & Applications</h4>
                        <p>Apply electron configuration knowledge to ion formation</p>
                        <div class="example-box">
                            <strong>Key Topics:</strong>
                            <p>• Cation & anion formation<br>
                            • Noble gas configuration<br>
                            • Isoelectronic species<br>
                            • Magnetic properties prediction</p>
                        </div>
                        <div class="demo-controls">
                            <button class="btn primary" onclick="startPaper3()">Start Paper 3</button>
                            <button class="btn secondary" onclick="viewPaper3MarkScheme()">View Mark Scheme</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sample Questions Preview -->
            <div class="quiz-section">
                <h3>📚 Sample Questions Preview</h3>
                <p>Here are examples of the question types you'll encounter in each paper:</p>
                
                <!-- Paper 1 Sample -->
                <div class="quiz-container">
                    <h4>📄 Paper 1 Sample Question</h4>
                    <div class="quiz-question">
                        <h4>Question 1 (a) [2 marks]</h4>
                        <p>Write the electron configuration of chromium (Cr) and explain why it differs from the expected configuration based on the Aufbau principle.</p>
                        <div class="mark-scheme">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> [Ar] 4s¹ 3d⁵ (1 mark)</p>
                            <p><strong>M2:</strong> Half-filled 3d subshell provides extra stability (1 mark)</p>
                        </div>
                    </div>
                </div>

                <!-- Paper 2 Sample -->
                <div class="quiz-container">
                    <h4>🧪 Paper 2 Sample Question</h4>
                    <div class="quiz-question">
                        <h4>Question 2 (b) [4 marks]</h4>
                        <p>Explain why copper (Cu) has the electron configuration [Ar] 4s¹ 3d¹⁰ instead of the expected [Ar] 4s² 3d⁹ configuration.</p>
                        <div class="mark-scheme">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Filled 3d subshell provides extra stability (1 mark)</p>
                            <p><strong>M2:</strong> Energy difference between 4s and 3d orbitals is small (1 mark)</p>
                            <p><strong>M3:</strong> Filled subshells have lower energy than partially filled ones (1 mark)</p>
                            <p><strong>M4:</strong> This is an exception to the Aufbau principle (1 mark)</p>
                        </div>
                    </div>
                </div>

                <!-- Paper 3 Sample -->
                <div class="quiz-container">
                    <h4>🔬 Paper 3 Sample Question</h4>
                    <div class="quiz-question">
                        <h4>Question 3 (c) [5 marks]</h4>
                        <p>Iron (Fe) has the electron configuration [Ar] 4s² 3d⁶. Write the electron configuration for Fe²⁺ and Fe³⁺ ions, explaining the order of electron loss.</p>
                        <div class="mark-scheme">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Fe²⁺: [Ar] 3d⁶ (1 mark)</p>
                            <p><strong>M2:</strong> Fe³⁺: [Ar] 3d⁵ (1 mark)</p>
                            <p><strong>M3:</strong> 4s electrons are lost first (1 mark)</p>
                            <p><strong>M4:</strong> 4s orbitals are higher in energy than 3d orbitals (1 mark)</p>
                            <p><strong>M5:</strong> Then 3d electrons are lost to form Fe³⁺ (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assessment Instructions -->
            <div class="understanding-section">
                <h3>📋 Assessment Instructions</h3>
                <div class="understanding-container">
                    <div class="understanding-question">
                        <h4>Before You Begin:</h4>
                        <ul>
                            <li><strong>Time Management:</strong> Allocate time based on mark allocation (1 mark ≈ 1.5 minutes)</li>
                            <li><strong>Answer Format:</strong> Follow Edexcel conventions for showing working and explanations</li>
                            <li><strong>Marking:</strong> Use the provided mark schemes to self-assess your responses</li>
                            <li><strong>Practice:</strong> Complete papers under timed conditions for realistic exam experience</li>
                        </ul>
                    </div>
                    <div class="understanding-question">
                        <h4>Marking Guidelines:</h4>
                        <ul>
                            <li><strong>Accuracy:</strong> Correct answers earn full marks</li>
                            <li><strong>Working:</strong> Show all steps in calculations for partial credit</li>
                            <li><strong>Explanations:</strong> Use precise scientific terminology</li>
                            <li><strong>Units:</strong> Always include appropriate units in numerical answers</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ======= Drawing Tools Section ======= -->
            <div class="drawing-tools-container">
                <div class="drawing-tools-header">
                    <h3>
                        <span class="custom-emoji emoji-pencil"></span>
                        Interactive Drawing & Writing Tools
                    </h3>
                    <p>Draw orbital diagrams, write electron configurations, and sketch molecular structures with touch support for tablets</p>
                </div>

                <!-- Drawing Canvas -->
                <div class="drawing-canvas-container">
                    <div class="drawing-toolbar">
                        <div class="drawing-tool active" data-tool="pencil">
                            <span>✏️</span>
                            <span>Pencil</span>
                        </div>
                        <div class="drawing-tool" data-tool="brush">
                            <span>🖌️</span>
                            <span>Brush</span>
                        </div>
                        <div class="drawing-tool" data-tool="eraser">
                            <span>🧹</span>
                            <span>Eraser</span>
                        </div>
                        <div class="drawing-tool" data-tool="shapes">
                            <span>🔷</span>
                            <span>Shapes</span>
                        </div>
                        <div class="drawing-tool">
                            <span>Size:</span>
                            <input type="range" id="brushSize" min="1" max="20" value="3">
                            <span id="brushSizeValue">3</span>
                        </div>
                        <div class="drawing-tool">
                            <span>Color:</span>
                            <input type="color" id="brushColor" value="#000000">
                        </div>
                    </div>
                    <canvas id="drawingCanvas" width="800" height="400"></canvas>
                </div>

                <!-- Drawing Actions -->
                <div class="drawing-actions">
                    <button class="drawing-btn primary" onclick="saveDrawing()">
                        <span>💾</span>
                        Save Drawing
                    </button>
                    <button class="drawing-btn secondary" onclick="undoDrawing()">
                        <span>↶</span>
                        Undo
                    </button>
                    <button class="drawing-btn secondary" onclick="redoDrawing()">
                        <span>↷</span>
                        Redo
                    </button>
                    <button class="drawing-btn danger" onclick="clearDrawing()">
                        <span>🗑️</span>
                        Clear
                    </button>
                </div>

                <!-- Drawing Status -->
                <div class="drawing-status" id="drawingStatus">
                    Ready to draw! Use your finger or stylus on tablets.
                </div>

                <!-- Drawing Templates -->
                <div class="drawing-templates">
                    <div class="drawing-template" onclick="loadTemplate('orbital')">
                        <h4>🔬 Orbital Diagram</h4>
                        <p>Template for drawing electron orbital diagrams</p>
                    </div>
                    <div class="drawing-template" onclick="loadTemplate('lewis')">
                        <h4>⚛️ Lewis Structure</h4>
                        <p>Template for drawing Lewis dot structures</p>
                    </div>
                    <div class="drawing-template" onclick="loadTemplate('molecular')">
                        <h4>🧪 Molecular Geometry</h4>
                        <p>Template for 3D molecular shapes</p>
                    </div>
                    <div class="drawing-template" onclick="loadTemplate('energy')">
                        <h4>⚡ Energy Level Diagram</h4>
                        <p>Template for energy level diagrams</p>
                    </div>
                </div>
            </div>

            <!-- ======= Electron Configuration Input ======= -->
            <div class="drawing-tools-container">
                <div class="drawing-tools-header">
                    <h3>
                        <span class="custom-emoji emoji-nucleus"></span>
                        Electron Configuration Writer
                    </h3>
                    <p>Write electron configurations with proper superscripts and formatting</p>
                </div>

                <div style="margin: 20px 0;">
                    <label for="elementInput" style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--accent);">
                        Element Symbol or Name:
                    </label>
                    <input type="text" id="elementInput" placeholder="e.g., Fe, Carbon, 26" 
                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                    <button class="drawing-btn primary" onclick="generateElectronConfig()" style="margin-top: 10px;">
                        <span>⚛️</span>
                        Generate Configuration
                    </button>
                </div>

                <div class="electron-config-preview" id="electronConfigPreview">
                    Enter an element to see its electron configuration
                </div>

                <!-- Enhanced Math Input for Custom Configuration -->
                <div style="margin: 20px 0;">
                    <label for="customConfig" style="display: block; margin-bottom: 10px; font-weight: 600; color: var(--accent);">
                        Custom Electron Configuration:
                    </label>
                    
                    <!-- Math Input Toolbar for Custom Config -->
                    <div class="math-toolbar">
                        <div class="math-toolbar-group">
                            <h5>Quick Input:</h5>
                            <button class="math-btn" onclick="insertMathSymbol('1s²')">1s²</button>
                            <button class="math-btn" onclick="insertMathSymbol('2s²')">2s²</button>
                            <button class="math-btn" onclick="insertMathSymbol('2p⁶')">2p⁶</button>
                            <button class="math-btn" onclick="insertMathSymbol('3s²')">3s²</button>
                            <button class="math-btn" onclick="insertMathSymbol('3p⁶')">3p⁶</button>
                            <button class="math-btn" onclick="insertMathSymbol('4s²')">4s²</button>
                            <button class="math-btn" onclick="insertMathSymbol('3d¹⁰')">3d¹⁰</button>
                            <button class="math-btn" onclick="insertMathSymbol('[Ar]')">[Ar]</button>
                            <button class="math-btn" onclick="insertMathSymbol('[Ne]')">[Ne]</button>
                            <button class="math-btn" onclick="insertMathSymbol('[Kr]')">[Kr]</button>
                        </div>
                        
                        <div class="math-toolbar-group">
                            <h5>Superscripts:</h5>
                            <div class="math-symbols-grid">
                                <button class="math-btn superscript" onclick="insertMathSymbol('¹')">¹</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('²')">²</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('³')">³</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('⁴')">⁴</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('⁵')">⁵</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('⁶')">⁶</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('⁷')">⁷</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('⁸')">⁸</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('⁹')">⁹</button>
                                <button class="math-btn superscript" onclick="insertMathSymbol('¹⁰')">¹⁰</button>
                            </div>
                        </div>
                        
                        <div class="math-toolbar-group">
                            <h5>Actions:</h5>
                            <button class="math-btn" onclick="clearCustomConfig()">Clear</button>
                            <button class="math-btn" onclick="insertMathSymbol(' ')">Space</button>
                        </div>
                    </div>
                    
                    <div class="math-input-container">
                        <div class="math-input-overlay" id="customConfigOverlay"></div>
                        <input type="text" id="customConfig" class="math-input-hidden" 
                               placeholder="e.g., 1s²2s²2p⁶3s²3p⁶4s²3d⁶" 
                               oninput="updateMathInput('customConfig', 'customConfigOverlay', 'customConfigPreview')"
                               onkeydown="handleMathInputKeydown(event, 'customConfig', 'customConfigOverlay', 'customConfigPreview')">
                    </div>
                    
                    <div class="electron-config-preview" id="customConfigPreview">
                        Your configuration will appear here with proper formatting
                    </div>
                </div>
            </div>
        </div>

        <!-- ======= Paper 1: Core Principles & Rules ======= -->
        <div id="paper1Content" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hidePaperContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span class="custom-emoji emoji-arrow-left"></span>
                    Back to Assessment
                </button>
                <h1 class="content-title">
                    <span class="custom-emoji emoji-nucleus"></span>
                    Paper 1: Core Principles & Rules
                </h1>
                <p class="content-subtitle">Duration: 45 minutes | Total Marks: 50</p>
                <div class="paper-timer" id="paper1Timer">
                    <span class="timer-label">Time Remaining:</span>
                    <span class="timer-display" id="paper1TimeDisplay">45:00</span>
                </div>
            </div>

            <!-- Paper Instructions -->
            <div class="objectives-section">
                <h3>📋 Instructions</h3>
                <div class="instructions-box">
                    <ul>
                        <li>Answer <strong>ALL</strong> questions in this paper</li>
                        <li>Write your answers in the spaces provided</li>
                        <li>Show all working for calculation questions</li>
                        <li>Use appropriate scientific terminology</li>
                        <li>Total marks for this paper: <strong>50</strong></li>
                    </ul>
                </div>
            </div>

            <!-- Question 1 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 1</h3>
                    <div class="question-part">
                        <h4>(a) [2 marks]</h4>
                        <p>Write the electron configuration for the following elements:</p>
                        <p><strong>(i)</strong> Sodium (Na) - atomic number 11</p>
                        <p><strong>(ii)</strong> Chlorine (Cl) - atomic number 17</p>
                        
                        <div class="answer-space">
                            <textarea id="q1a" placeholder="Write your answers here..." rows="3"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_q1a" onclick="toggleMathToolbar('q1a')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('q1a')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_q1a">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'q1a')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'q1a')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'q1a')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'q1a')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'q1a')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'q1a')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'q1a')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'q1a')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'q1a')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'q1a')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_q1a" onclick="setMathMode('normal', 'q1a')">Normal</button>
                                <button class="math-btn" id="superscriptMode_q1a" onclick="setMathMode('superscript', 'q1a')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_q1a" onclick="setMathMode('subscript', 'q1a')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'q1a')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'q1a')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'q1a')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'q1a')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'q1a')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'q1a')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'q1a')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'q1a')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'q1a')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'q1a')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('q1a')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'q1a')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'q1a')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="q1a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Na: 1s² 2s² 2p⁶ 3s¹ (1 mark)</p>
                            <p><strong>M2:</strong> Cl: 1s² 2s² 2p⁶ 3s² 3p⁵ (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [3 marks]</h4>
                        <p>Draw the orbital diagram for nitrogen (N) showing the arrangement of electrons in the 2p subshell. Use arrows to represent electrons and indicate their spin.</p>
                        
                        <!-- Drawing Tools for Orbital Diagram -->
                        <div class="drawing-tools-container" style="margin: 15px 0;">
                            <div class="drawing-tools-header">
                                <h4 style="color: var(--accent); margin: 0 0 10px 0;">🎨 Drawing Tools</h4>
                                <p style="margin: 0; font-size: 14px; color: #666;">Use the drawing canvas below to create your orbital diagram</p>
                            </div>
                            
                            <div class="drawing-canvas-container">
                                <div class="drawing-toolbar">
                                    <div class="drawing-tool active" data-tool="pencil">
                                        <span>✏️</span>
                                        <span>Pencil</span>
                                    </div>
                                    <div class="drawing-tool" data-tool="brush">
                                        <span>🖌️</span>
                                        <span>Brush</span>
                                    </div>
                                    <div class="drawing-tool" data-tool="eraser">
                                        <span>🧹</span>
                                        <span>Eraser</span>
                                    </div>
                                    <div class="drawing-tool">
                                        <span>Size:</span>
                                        <input type="range" class="brushSize" min="1" max="20" value="3">
                                        <span class="brushSizeValue">3</span>
                                    </div>
                                    <div class="drawing-tool">
                                        <span>Color:</span>
                                        <input type="color" class="brushColor" value="#000000">
                                    </div>
                                </div>
                                <canvas class="question-drawing-canvas" width="600" height="200" data-question="q1b"></canvas>
                            </div>
                            
                            <div class="drawing-actions">
                                <button class="drawing-btn primary" onclick="saveQuestionDrawing('q1b')">
                                    <span>💾</span>
                                    Save Drawing
                                </button>
                                <button class="drawing-btn secondary" onclick="undoQuestionDrawing('q1b')">
                                    <span>↶</span>
                                    Undo
                                </button>
                                <button class="drawing-btn secondary" onclick="clearQuestionDrawing('q1b')">
                                    <span>🗑️</span>
                                    Clear
                                </button>
                                <button class="drawing-btn secondary" onclick="loadOrbitalTemplate('q1b')">
                                    <span>🔬</span>
                                    Load Template
                                </button>
                            </div>
                        </div>
                        
                        <div class="answer-space">
                            <textarea id="q1b" placeholder="Additional written explanation (optional)..." rows="3"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_q1b" onclick="toggleMathToolbar('q1b')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('q1b')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_q1b">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'q1b')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'q1b')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'q1b')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'q1b')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'q1b')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'q1b')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'q1b')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'q1b')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'q1b')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'q1b')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_q1b" onclick="setMathMode('normal', 'q1b')">Normal</button>
                                <button class="math-btn" id="superscriptMode_q1b" onclick="setMathMode('superscript', 'q1b')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_q1b" onclick="setMathMode('subscript', 'q1b')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'q1b')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'q1b')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'q1b')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'q1b')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'q1b')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'q1b')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'q1b')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'q1b')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'q1b')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'q1b')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('q1b')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'q1b')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'q1b')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="q1b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Three separate 2p orbitals shown (1 mark)</p>
                            <p><strong>M2:</strong> One electron in each orbital (1 mark)</p>
                            <p><strong>M3:</strong> All electrons with same spin (parallel spins) (1 mark)</p>
                            <p><em>Accept: ↑ ↑ ↑ or ↓ ↓ ↓ in separate boxes</em></p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(c) [4 marks]</h4>
                        <p>Explain the three fundamental principles that govern electron configuration:</p>
                        <p><strong>(i)</strong> Aufbau principle</p>
                        <p><strong>(ii)</strong> Hund's rule</p>
                        <p><strong>(iii)</strong> Pauli exclusion principle</p>
                        <div class="answer-space">
                            <textarea id="q1c" placeholder="Explain each principle..." rows="6"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_q1c" onclick="toggleMathToolbar('q1c')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('q1c')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_q1c">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'q1c')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'q1c')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'q1c')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'q1c')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'q1c')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'q1c')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'q1c')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'q1c')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'q1c')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'q1c')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_q1c" onclick="setMathMode('normal', 'q1c')">Normal</button>
                                <button class="math-btn" id="superscriptMode_q1c" onclick="setMathMode('superscript', 'q1c')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_q1c" onclick="setMathMode('subscript', 'q1c')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'q1c')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'q1c')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'q1c')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'q1c')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'q1c')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'q1c')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'q1c')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'q1c')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'q1c')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'q1c')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('q1c')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'q1c')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'q1c')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="q1c-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Aufbau: Electrons occupy lowest energy orbitals first (1 mark)</p>
                            <p><strong>M2:</strong> Hund's: In degenerate orbitals, electrons occupy separate orbitals with same spin before pairing (1 mark)</p>
                            <p><strong>M3:</strong> Pauli: Maximum 2 electrons per orbital with opposite spins (1 mark)</p>
                            <p><strong>M4:</strong> All three principles correctly explained (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 2</h3>
                    <div class="question-part">
                        <h4>(a) [3 marks]</h4>
                        <p>Write the electron configuration for the following transition metals:</p>
                        <p><strong>(i)</strong> Scandium (Sc) - atomic number 21</p>
                        <p><strong>(ii)</strong> Titanium (Ti) - atomic number 22</p>
                        <p><strong>(iii)</strong> Vanadium (V) - atomic number 23</p>
                        <div class="answer-space">
                            <textarea id="p2q2a" placeholder="Write configurations here..." rows="4"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q2a" onclick="toggleMathToolbar('p2q2a')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q2a')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q2a">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q2a')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q2a')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q2a')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q2a')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q2a')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q2a')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q2a')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q2a')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q2a')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q2a')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q2a" onclick="setMathMode('normal', 'p2q2a')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q2a" onclick="setMathMode('superscript', 'p2q2a')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q2a" onclick="setMathMode('subscript', 'p2q2a')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q2a')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q2a')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q2a')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q2a')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q2a')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q2a')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q2a')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q2a')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q2a')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q2a')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q2a')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q2a')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q2a')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q2a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Sc: [Ar] 4s² 3d¹ (1 mark)</p>
                            <p><strong>M2:</strong> Ti: [Ar] 4s² 3d² (1 mark)</p>
                            <p><strong>M3:</strong> V: [Ar] 4s² 3d³ (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Explain why the 4s orbital is filled before the 3d orbital in transition metals, despite 3d having a lower principal quantum number.</p>
                        <div class="answer-space">
                            <textarea id="p2q2b" placeholder="Explain the energy ordering..." rows="5"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q2b" onclick="toggleMathToolbar('p2q2b')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q2b')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q2b">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q2b')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q2b')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q2b')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q2b')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q2b')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q2b')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q2b')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q2b')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q2b')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q2b')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q2b" onclick="setMathMode('normal', 'p2q2b')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q2b" onclick="setMathMode('superscript', 'p2q2b')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q2b" onclick="setMathMode('subscript', 'p2q2b')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q2b')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q2b')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q2b')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q2b')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q2b')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q2b')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q2b')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q2b')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q2b')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q2b')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q2b')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q2b')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q2b')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q2b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> 4s orbital has lower energy than 3d orbital (1 mark)</p>
                            <p><strong>M2:</strong> Due to penetration effect of s orbitals (1 mark)</p>
                            <p><strong>M3:</strong> s orbitals experience less shielding from inner electrons (1 mark)</p>
                            <p><strong>M4:</strong> This follows the Aufbau principle (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 3</h3>
                    <div class="question-part">
                        <h4>(a) [5 marks]</h4>
                        <p>Complete the following table by writing the electron configuration for each element:</p>
                        <div class="table-container">
                            <table class="config-table">
                                <thead>
                                    <tr>
                                        <th>Element</th>
                                        <th>Atomic Number</th>
                                        <th>Electron Configuration</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Magnesium (Mg)</td>
                                        <td>12</td>
                                        <td><input type="text" id="q3a-mg" placeholder="Enter configuration"></td>
                                    </tr>
                                    <tr>
                                        <td>Aluminum (Al)</td>
                                        <td>13</td>
                                        <td><input type="text" id="q3a-al" placeholder="Enter configuration"></td>
                                    </tr>
                                    <tr>
                                        <td>Silicon (Si)</td>
                                        <td>14</td>
                                        <td><input type="text" id="q3a-si" placeholder="Enter configuration"></td>
                                    </tr>
                                    <tr>
                                        <td>Phosphorus (P)</td>
                                        <td>15</td>
                                        <td><input type="text" id="q3a-p" placeholder="Enter configuration"></td>
                                    </tr>
                                    <tr>
                                        <td>Sulfur (S)</td>
                                        <td>16</td>
                                        <td><input type="text" id="q3a-s" placeholder="Enter configuration"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q3a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q3a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Mg: 1s² 2s² 2p⁶ 3s² (1 mark)</p>
                            <p><strong>M2:</strong> Al: 1s² 2s² 2p⁶ 3s² 3p¹ (1 mark)</p>
                            <p><strong>M3:</strong> Si: 1s² 2s² 2p⁶ 3s² 3p² (1 mark)</p>
                            <p><strong>M4:</strong> P: 1s² 2s² 2p⁶ 3s² 3p³ (1 mark)</p>
                            <p><strong>M5:</strong> S: 1s² 2s² 2p⁶ 3s² 3p⁴ (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [3 marks]</h4>
                        <p>Identify which element from the table above has the highest first ionization energy and explain your reasoning.</p>
                        <div class="answer-space">
                            <textarea id="p2q3b" placeholder="Identify element and explain..." rows="4"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q3b" onclick="toggleMathToolbar('p2q3b')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q3b')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q3b">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q3b')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q3b')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q3b')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q3b')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q3b')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q3b')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q3b')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q3b')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q3b')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q3b')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q3b" onclick="setMathMode('normal', 'p2q3b')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q3b" onclick="setMathMode('superscript', 'p2q3b')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q3b" onclick="setMathMode('subscript', 'p2q3b')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q3b')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q3b')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q3b')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q3b')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q3b')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q3b')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q3b')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q3b')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q3b')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q3b')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q3b')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q3b')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q3b')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q3b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Phosphorus (P) (1 mark)</p>
                            <p><strong>M2:</strong> Has half-filled 3p subshell (1 mark)</p>
                            <p><strong>M3:</strong> Half-filled subshell provides extra stability (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 4</h3>
                    <div class="question-part">
                        <h4>(a) [4 marks]</h4>
                        <p>Draw the orbital diagram for oxygen (O) and explain how Hund's rule applies to the 2p subshell.</p>
                        
                        <!-- Drawing Tools for Orbital Diagram -->
                        <div class="drawing-tools-container" style="margin: 15px 0;">
                            <div class="drawing-tools-header">
                                <h4 style="color: var(--accent); margin: 0 0 10px 0;">🎨 Drawing Tools</h4>
                                <p style="margin: 0; font-size: 14px; color: #666;">Use the drawing canvas below to create your orbital diagram</p>
                            </div>
                            
                            <div class="drawing-canvas-container">
                                <div class="drawing-toolbar">
                                    <div class="drawing-tool active" data-tool="pencil">
                                        <span>✏️</span>
                                        <span>Pencil</span>
                                    </div>
                                    <div class="drawing-tool" data-tool="brush">
                                        <span>🖌️</span>
                                        <span>Brush</span>
                                    </div>
                                    <div class="drawing-tool" data-tool="eraser">
                                        <span>🧹</span>
                                        <span>Eraser</span>
                                    </div>
                                    <div class="drawing-tool">
                                        <span>Size:</span>
                                        <input type="range" class="brushSize" min="1" max="20" value="3">
                                        <span class="brushSizeValue">3</span>
                                    </div>
                                    <div class="drawing-tool">
                                        <span>Color:</span>
                                        <input type="color" class="brushColor" value="#000000">
                                    </div>
                                </div>
                                <canvas class="question-drawing-canvas" width="600" height="200" data-question="p2q4a"></canvas>
                            </div>
                            
                            <div class="drawing-actions">
                                <button class="drawing-btn primary" onclick="saveQuestionDrawing('p2q4a')">
                                    <span>💾</span>
                                    Save Drawing
                                </button>
                                <button class="drawing-btn secondary" onclick="undoQuestionDrawing('p2q4a')">
                                    <span>↶</span>
                                    Undo
                                </button>
                                <button class="drawing-btn secondary" onclick="clearQuestionDrawing('p2q4a')">
                                    <span>🗑️</span>
                                    Clear
                                </button>
                                <button class="drawing-btn secondary" onclick="loadOrbitalTemplate('p2q4a')">
                                    <span>🔬</span>
                                    Load Template
                                </button>
                            </div>
                        </div>
                        
                        <div class="answer-space">
                            <textarea id="p2q4a" placeholder="Explain how Hund's rule applies to the 2p subshell..." rows="4"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q4a" onclick="toggleMathToolbar('p2q4a')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q4a')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q4a">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q4a')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q4a')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q4a')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q4a')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q4a')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q4a')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q4a')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q4a')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q4a')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q4a')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q4a" onclick="setMathMode('normal', 'p2q4a')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q4a" onclick="setMathMode('superscript', 'p2q4a')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q4a" onclick="setMathMode('subscript', 'p2q4a')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q4a')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q4a')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q4a')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q4a')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q4a')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q4a')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q4a')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q4a')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q4a')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q4a')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q4a')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q4a')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q4a')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q4a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Three 2p orbitals shown (1 mark)</p>
                            <p><strong>M2:</strong> Two electrons in separate orbitals with same spin (1 mark)</p>
                            <p><strong>M3:</strong> Hund's rule: electrons occupy separate orbitals first (1 mark)</p>
                            <p><strong>M4:</strong> Electrons have same spin before pairing (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [3 marks]</h4>
                        <p>Compare the electron configurations of oxygen (O) and fluorine (F). Explain why fluorine has a higher electronegativity.</p>
                        <div class="answer-space">
                            <textarea id="p2q4b" placeholder="Compare and explain..." rows="4"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q4b" onclick="toggleMathToolbar('p2q4b')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q4b')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q4b">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q4b')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q4b')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q4b')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q4b')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q4b')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q4b')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q4b')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q4b')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q4b')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q4b')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q4b" onclick="setMathMode('normal', 'p2q4b')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q4b" onclick="setMathMode('superscript', 'p2q4b')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q4b" onclick="setMathMode('subscript', 'p2q4b')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q4b')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q4b')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q4b')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q4b')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q4b')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q4b')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q4b')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q4b')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q4b')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q4b')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q4b')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q4b')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q4b')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q4b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> O: [He] 2s² 2p⁴, F: [He] 2s² 2p⁵ (1 mark)</p>
                            <p><strong>M2:</strong> F has higher nuclear charge (1 mark)</p>
                            <p><strong>M3:</strong> F is closer to noble gas configuration (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 5</h3>
                    <div class="question-part">
                        <h4>(a) [6 marks]</h4>
                        <p>Write the electron configuration for the following ions and explain the process of ion formation:</p>
                        <p><strong>(i)</strong> Na⁺ (from sodium)</p>
                        <p><strong>(ii)</strong> Cl⁻ (from chlorine)</p>
                        <p><strong>(iii)</strong> Mg²⁺ (from magnesium)</p>
                        <div class="answer-space">
                            <textarea id="p2q5a" placeholder="Write configurations and explain ion formation..." rows="6"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q5a" onclick="toggleMathToolbar('p2q5a')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q5a')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q5a">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q5a')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q5a')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q5a')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q5a')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q5a')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q5a')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q5a')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q5a')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q5a')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q5a')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q5a" onclick="setMathMode('normal', 'p2q5a')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q5a" onclick="setMathMode('superscript', 'p2q5a')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q5a" onclick="setMathMode('subscript', 'p2q5a')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q5a')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q5a')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q5a')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q5a')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q5a')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q5a')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q5a')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q5a')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q5a')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q5a')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q5a')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q5a')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q5a')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q5a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Na⁺: 1s² 2s² 2p⁶ (1 mark)</p>
                            <p><strong>M2:</strong> Cl⁻: 1s² 2s² 2p⁶ 3s² 3p⁶ (1 mark)</p>
                            <p><strong>M3:</strong> Mg²⁺: 1s² 2s² 2p⁶ (1 mark)</p>
                            <p><strong>M4:</strong> Na loses 1 electron from 3s orbital (1 mark)</p>
                            <p><strong>M5:</strong> Cl gains 1 electron in 3p orbital (1 mark)</p>
                            <p><strong>M6:</strong> Mg loses 2 electrons from 3s orbital (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Explain why the ionic radius of Na⁺ is smaller than the atomic radius of Na, while the ionic radius of Cl⁻ is larger than the atomic radius of Cl.</p>
                        <div class="answer-space">
                            <textarea id="p2q5b" placeholder="Explain ionic radius changes..." rows="4"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q5b" onclick="toggleMathToolbar('p2q5b')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q5b')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q5b">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q5b')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q5b')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q5b')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q5b')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q5b')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q5b')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q5b')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q5b')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q5b')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q5b')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q5b" onclick="setMathMode('normal', 'p2q5b')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q5b" onclick="setMathMode('superscript', 'p2q5b')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q5b" onclick="setMathMode('subscript', 'p2q5b')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q5b')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q5b')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q5b')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q5b')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q5b')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q5b')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q5b')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q5b')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q5b')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q5b')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q5b')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q5b')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q5b')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q5b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Na⁺ smaller: electron lost, less electron-electron repulsion (1 mark)</p>
                            <p><strong>M2:</strong> Na⁺: same nuclear charge, fewer electrons (1 mark)</p>
                            <p><strong>M3:</strong> Cl⁻ larger: electron gained, more electron-electron repulsion (1 mark)</p>
                            <p><strong>M4:</strong> Cl⁻: same nuclear charge, more electrons (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paper 1 Controls -->
            <div class="paper-controls">
                <button class="btn primary" onclick="submitPaper1()">Submit Paper 1</button>
                <button class="btn secondary" onclick="savePaper1()">Save Progress</button>
                <button class="btn ghost" onclick="resetPaper1()">Reset Paper</button>
            </div>
        </div>

        <!-- ======= Paper 2: Exceptions & Complex Cases ======= -->
        <div id="paper2Content" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hidePaperContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span class="custom-emoji emoji-arrow-left"></span>
                    Back to Assessment
                </button>
                <h1 class="content-title">
                    <span class="custom-emoji emoji-nucleus"></span>
                    Paper 2: Exceptions & Complex Cases
                </h1>
                <p class="content-subtitle">Duration: 45 minutes | Total Marks: 50</p>
                <div class="paper-timer" id="paper2Timer">
                    <span class="timer-label">Time Remaining:</span>
                    <span class="timer-display" id="paper2TimeDisplay">45:00</span>
                </div>
            </div>

            <!-- Paper Instructions -->
            <div class="objectives-section">
                <h3>📋 Instructions</h3>
                <div class="instructions-box">
                    <ul>
                        <li>Answer <strong>ALL</strong> questions in this paper</li>
                        <li>Focus on transition metal exceptions and complex cases</li>
                        <li>Explain stability factors and energy considerations</li>
                        <li>Use appropriate scientific terminology</li>
                        <li>Total marks for this paper: <strong>50</strong></li>
                    </ul>
                </div>
            </div>

            <!-- Question 1 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 1</h3>
                    <div class="question-part">
                        <h4>(a) [4 marks]</h4>
                        <p>Write the electron configuration for the following transition metal exceptions:</p>
                        <p><strong>(i)</strong> Chromium (Cr) - atomic number 24</p>
                        <p><strong>(ii)</strong> Copper (Cu) - atomic number 29</p>
                        <p><strong>(iii)</strong> Molybdenum (Mo) - atomic number 42</p>
                        <p><strong>(iv)</strong> Silver (Ag) - atomic number 47</p>
                        <div class="answer-space">
                            <textarea id="p2q1a" placeholder="Write configurations here..." rows="5"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q1a" onclick="toggleMathToolbar('p2q1a')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q1a')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q1a">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q1a')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q1a')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q1a')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q1a')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q1a')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q1a')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q1a')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q1a')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q1a')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q1a')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q1a" onclick="setMathMode('normal', 'p2q1a')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q1a" onclick="setMathMode('superscript', 'p2q1a')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q1a" onclick="setMathMode('subscript', 'p2q1a')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q1a')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q1a')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q1a')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q1a')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q1a')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q1a')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q1a')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q1a')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q1a')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q1a')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q1a')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q1a')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q1a')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q1a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Cr: [Ar] 4s¹ 3d⁵ (1 mark)</p>
                            <p><strong>M2:</strong> Cu: [Ar] 4s¹ 3d¹⁰ (1 mark)</p>
                            <p><strong>M3:</strong> Mo: [Kr] 5s¹ 4d⁵ (1 mark)</p>
                            <p><strong>M4:</strong> Ag: [Kr] 5s¹ 4d¹⁰ (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [6 marks]</h4>
                        <p>Explain why these elements have exceptional electron configurations instead of following the standard Aufbau principle. Include specific reasons for each element.</p>
                        <div class="answer-space">
                            <textarea id="p2q1b" placeholder="Explain the stability factors..." rows="6"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q1b" onclick="toggleMathToolbar('p2q1b')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q1b')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q1b">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q1b')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q1b')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q1b')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q1b')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q1b')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q1b')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q1b')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q1b')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q1b')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q1b')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q1b" onclick="setMathMode('normal', 'p2q1b')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q1b" onclick="setMathMode('superscript', 'p2q1b')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q1b" onclick="setMathMode('subscript', 'p2q1b')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q1b')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q1b')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q1b')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q1b')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q1b')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q1b')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q1b')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q1b')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q1b')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q1b')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q1b')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q1b')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q1b')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q1b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Cr & Mo: Half-filled d subshell provides extra stability (1 mark)</p>
                            <p><strong>M2:</strong> Cu & Ag: Filled d subshell provides extra stability (1 mark)</p>
                            <p><strong>M3:</strong> Energy difference between s and d orbitals is small (1 mark)</p>
                            <p><strong>M4:</strong> Symmetrical electron distribution reduces repulsion (1 mark)</p>
                            <p><strong>M5:</strong> Lower energy configuration than expected Aufbau arrangement (1 mark)</p>
                            <p><strong>M6:</strong> All four elements correctly explained (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 2</h3>
                    <div class="question-part">
                        <h4>(a) [5 marks]</h4>
                        <p>Compare the electron configurations of the following pairs and explain the differences:</p>
                        <p><strong>(i)</strong> Vanadium (V) vs Chromium (Cr)</p>
                        <p><strong>(ii)</strong> Nickel (Ni) vs Copper (Cu)</p>
                        <p><strong>(iii)</strong> Palladium (Pd) vs Silver (Ag)</p>
                        <div class="answer-space">
                            <textarea id="p2q2a_2" placeholder="Compare and explain differences..." rows="6"></textarea>
                        </div>
                        
                        <!-- Question Buttons Container -->
                        <div class="question-buttons">
                            <!-- Math Input Toolbar Toggle -->
                            <button class="math-toolbar-toggle" id="toggle_p2q2a_2" onclick="toggleMathToolbar('p2q2a_2')">
                                <span>⌨️</span>
                                <span>Math Tools</span>
                                <span class="toggle-icon">▼</span>
                            </button>
                            
                            <!-- Mark Scheme Button -->
                            <button class="btn secondary" onclick="showMarkScheme('p2q2a')">Show Mark Scheme</button>
                        </div>
                        
                        <!-- Math Input Toolbar - Collapsible -->
                        <div class="math-toolbar" id="toolbar_p2q2a_2">
                            <div class="math-toolbar-group">
                                <h5>Numbers:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('0', 'p2q2a_2')">0</button>
                                    <button class="math-btn" onclick="insertMathSymbol('1', 'p2q2a_2')">1</button>
                                    <button class="math-btn" onclick="insertMathSymbol('2', 'p2q2a_2')">2</button>
                                    <button class="math-btn" onclick="insertMathSymbol('3', 'p2q2a_2')">3</button>
                                    <button class="math-btn" onclick="insertMathSymbol('4', 'p2q2a_2')">4</button>
                                    <button class="math-btn" onclick="insertMathSymbol('5', 'p2q2a_2')">5</button>
                                    <button class="math-btn" onclick="insertMathSymbol('6', 'p2q2a_2')">6</button>
                                    <button class="math-btn" onclick="insertMathSymbol('7', 'p2q2a_2')">7</button>
                                    <button class="math-btn" onclick="insertMathSymbol('8', 'p2q2a_2')">8</button>
                                    <button class="math-btn" onclick="insertMathSymbol('9', 'p2q2a_2')">9</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Mode:</h5>
                                <button class="math-btn" id="normalMode_p2q2a_2" onclick="setMathMode('normal', 'p2q2a_2')">Normal</button>
                                <button class="math-btn" id="superscriptMode_p2q2a_2" onclick="setMathMode('superscript', 'p2q2a_2')">Superscript</button>
                                <button class="math-btn" id="subscriptMode_p2q2a_2" onclick="setMathMode('subscript', 'p2q2a_2')">Subscript</button>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Symbols:</h5>
                                <div class="math-symbols-grid">
                                    <button class="math-btn" onclick="insertMathSymbol('s', 'p2q2a_2')">s</button>
                                    <button class="math-btn" onclick="insertMathSymbol('p', 'p2q2a_2')">p</button>
                                    <button class="math-btn" onclick="insertMathSymbol('d', 'p2q2a_2')">d</button>
                                    <button class="math-btn" onclick="insertMathSymbol('f', 'p2q2a_2')">f</button>
                                    <button class="math-btn" onclick="insertMathSymbol('+', 'p2q2a_2')">+</button>
                                    <button class="math-btn" onclick="insertMathSymbol('-', 'p2q2a_2')">-</button>
                                    <button class="math-btn" onclick="insertMathSymbol('[', 'p2q2a_2')">[</button>
                                    <button class="math-btn" onclick="insertMathSymbol(']', 'p2q2a_2')">]</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↑', 'p2q2a_2')">↑</button>
                                    <button class="math-btn" onclick="insertMathSymbol('↓', 'p2q2a_2')">↓</button>
                                </div>
                            </div>
                            
                            <div class="math-toolbar-group">
                                <h5>Actions:</h5>
                                <button class="math-btn" onclick="clearMathInput('p2q2a_2')">Clear</button>
                                <button class="math-btn" onclick="insertMathSymbol(' ', 'p2q2a_2')">Space</button>
                                <button class="math-btn" onclick="insertMathSymbol('←', 'p2q2a_2')">←</button>
                            </div>
                        </div>
                        <div class="mark-scheme" id="p2q2a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> V: [Ar] 4s² 3d³, Cr: [Ar] 4s¹ 3d⁵ - Cr has half-filled d subshell (1 mark)</p>
                            <p><strong>M2:</strong> Ni: [Ar] 4s² 3d⁸, Cu: [Ar] 4s¹ 3d¹⁰ - Cu has filled d subshell (1 mark)</p>
                            <p><strong>M3:</strong> Pd: [Kr] 5s² 4d⁸, Ag: [Kr] 5s¹ 4d¹⁰ - Ag has filled d subshell (1 mark)</p>
                            <p><strong>M4:</strong> Exceptions occur when stability gained exceeds energy cost (1 mark)</p>
                            <p><strong>M5:</strong> All three comparisons correctly explained (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Predict the electron configuration of Gold (Au) - atomic number 79 - and explain your reasoning.</p>
                        <div class="answer-space">
                            <textarea id="p2q2b" placeholder="Predict Au configuration and explain..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q2b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q2b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Au: [Xe] 6s¹ 5d¹⁰ (1 mark)</p>
                            <p><strong>M2:</strong> Follows same pattern as Cu and Ag (1 mark)</p>
                            <p><strong>M3:</strong> Filled 5d subshell provides extra stability (1 mark)</p>
                            <p><strong>M4:</strong> Energy difference between 6s and 5d is small (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 3</h3>
                    <div class="question-part">
                        <h4>(a) [6 marks]</h4>
                        <p>Complete the following table for transition metal ions, showing how they form from their neutral atoms:</p>
                        <div class="table-container">
                            <table class="config-table">
                                <thead>
                                    <tr>
                                        <th>Element</th>
                                        <th>Neutral Configuration</th>
                                        <th>Ion Formed</th>
                                        <th>Ion Configuration</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Chromium (Cr)</td>
                                        <td>[Ar] 4s¹ 3d⁵</td>
                                        <td><input type="text" id="p2q3a-cr-ion" placeholder="e.g., Cr³⁺"></td>
                                        <td><input type="text" id="p2q3a-cr-config" placeholder="Enter configuration"></td>
                                    </tr>
                                    <tr>
                                        <td>Copper (Cu)</td>
                                        <td>[Ar] 4s¹ 3d¹⁰</td>
                                        <td><input type="text" id="p2q3a-cu-ion" placeholder="e.g., Cu²⁺"></td>
                                        <td><input type="text" id="p2q3a-cu-config" placeholder="Enter configuration"></td>
                                    </tr>
                                    <tr>
                                        <td>Iron (Fe)</td>
                                        <td>[Ar] 4s² 3d⁶</td>
                                        <td><input type="text" id="p2q3a-fe-ion" placeholder="e.g., Fe²⁺"></td>
                                        <td><input type="text" id="p2q3a-fe-config" placeholder="Enter configuration"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q3a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q3a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Cr³⁺: [Ar] 3d³ (1 mark)</p>
                            <p><strong>M2:</strong> Cu²⁺: [Ar] 3d⁹ (1 mark)</p>
                            <p><strong>M3:</strong> Fe²⁺: [Ar] 3d⁶ (1 mark)</p>
                            <p><strong>M4:</strong> 4s electrons lost first (1 mark)</p>
                            <p><strong>M5:</strong> Then 3d electrons lost (1 mark)</p>
                            <p><strong>M6:</strong> All three configurations correct (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [3 marks]</h4>
                        <p>Explain why transition metals lose 4s electrons before 3d electrons when forming ions.</p>
                        <div class="answer-space">
                            <textarea id="p2q3b" placeholder="Explain electron loss order..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q3b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q3b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> 4s electrons are higher in energy than 3d electrons (1 mark)</p>
                            <p><strong>M2:</strong> 4s electrons are further from nucleus (1 mark)</p>
                            <p><strong>M3:</strong> Less energy required to remove 4s electrons (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 4</h3>
                    <div class="question-part">
                        <h4>(a) [5 marks]</h4>
                        <p>Identify which of the following elements are exceptions to the Aufbau principle and explain why:</p>
                        <p><strong>Elements:</strong> Scandium (Sc), Titanium (Ti), Vanadium (V), Chromium (Cr), Manganese (Mn), Iron (Fe), Cobalt (Co), Nickel (Ni), Copper (Cu), Zinc (Zn)</p>
                        <div class="answer-space">
                            <textarea id="p2q4a" placeholder="Identify exceptions and explain..." rows="5"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q4a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q4a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Exceptions: Cr and Cu (1 mark)</p>
                            <p><strong>M2:</strong> Cr: half-filled 3d subshell provides stability (1 mark)</p>
                            <p><strong>M3:</strong> Cu: filled 3d subshell provides stability (1 mark)</p>
                            <p><strong>M4:</strong> Other elements follow standard Aufbau principle (1 mark)</p>
                            <p><strong>M5:</strong> Stability gained exceeds energy cost of exception (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Explain why elements like Scandium (Sc) and Zinc (Zn) do NOT have exceptional configurations, even though they are transition metals.</p>
                        <div class="answer-space">
                            <textarea id="p2q4b" placeholder="Explain why Sc and Zn are not exceptions..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q4b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q4b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Sc: only one d electron, no stability gain from half-filled subshell (1 mark)</p>
                            <p><strong>M2:</strong> Zn: filled d subshell already achieved with standard configuration (1 mark)</p>
                            <p><strong>M3:</strong> No energy advantage to changing s/d electron arrangement (1 mark)</p>
                            <p><strong>M4:</strong> Standard Aufbau principle gives lowest energy configuration (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 5</h3>
                    <div class="question-part">
                        <h4>(a) [6 marks]</h4>
                        <p>Draw orbital diagrams for the following elements showing their actual electron configurations:</p>
                        <p><strong>(i)</strong> Chromium (Cr) - show 4s and 3d orbitals</p>
                        <p><strong>(ii)</strong> Copper (Cu) - show 4s and 3d orbitals</p>
                        <p><strong>(iii)</strong> Manganese (Mn) - show 4s and 3d orbitals</p>
                        <div class="answer-space">
                            <textarea id="p2q5a" placeholder="Draw orbital diagrams..." rows="6"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q5a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q5a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Cr: 4s¹ (↑) 3d⁵ (↑ ↑ ↑ ↑ ↑) - one electron in 4s, five in separate 3d orbitals (2 marks)</p>
                            <p><strong>M2:</strong> Cu: 4s¹ (↑) 3d¹⁰ (↑↓ ↑↓ ↑↓ ↑↓ ↑↓) - one electron in 4s, ten in 3d orbitals (2 marks)</p>
                            <p><strong>M3:</strong> Mn: 4s² (↑↓) 3d⁵ (↑ ↑ ↑ ↑ ↑) - two electrons in 4s, five in separate 3d orbitals (2 marks)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Explain the magnetic properties of these three elements based on their electron configurations.</p>
                        <div class="answer-space">
                            <textarea id="p2q5b" placeholder="Explain magnetic properties..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q5b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q5b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Cr: paramagnetic - unpaired electrons in 3d orbitals (1 mark)</p>
                            <p><strong>M2:</strong> Cu: diamagnetic - all electrons paired in 3d orbitals (1 mark)</p>
                            <p><strong>M3:</strong> Mn: paramagnetic - unpaired electrons in 3d orbitals (1 mark)</p>
                            <p><strong>M4:</strong> Unpaired electrons create magnetic moment (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paper 2 Controls -->
            <div class="paper-controls">
                <button class="btn primary" onclick="submitPaper2()">Submit Paper 2</button>
                <button class="btn secondary" onclick="savePaper2()">Save Progress</button>
                <button class="btn ghost" onclick="resetPaper2()">Reset Paper</button>
            </div>
        </div>

        <!-- ======= Paper 3: Ion Formation & Applications ======= -->
        <div id="paper3Content" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hidePaperContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span class="custom-emoji emoji-arrow-left"></span>
                    Back to Assessment
                </button>
                <h1 class="content-title">
                    <span class="custom-emoji emoji-nucleus"></span>
                    Paper 3: Ion Formation & Applications
                </h1>
                <p class="content-subtitle">Duration: 60 minutes | Total Marks: 60</p>
                <div class="paper-timer" id="paper3Timer">
                    <span class="timer-label">Time Remaining:</span>
                    <span class="timer-display" id="paper3TimeDisplay">60:00</span>
                </div>
            </div>

            <!-- Paper Instructions -->
            <div class="objectives-section">
                <h3>📋 Instructions</h3>
                <div class="instructions-box">
                    <ul>
                        <li>Answer <strong>ALL</strong> questions in this paper</li>
                        <li>Focus on ion formation mechanisms and practical applications</li>
                        <li>Include detailed explanations and calculations where required</li>
                        <li>Use appropriate scientific terminology and units</li>
                        <li>Total marks for this paper: <strong>60</strong></li>
                    </ul>
                </div>
            </div>

            <!-- Question 1 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 1</h3>
                    <div class="question-part">
                        <h4>(a) [6 marks]</h4>
                        <p>Explain the process of ion formation for the following elements and write their ion configurations:</p>
                        <p><strong>(i)</strong> Sodium (Na) - atomic number 11</p>
                        <p><strong>(ii)</strong> Chlorine (Cl) - atomic number 17</p>
                        <p><strong>(iii)</strong> Calcium (Ca) - atomic number 20</p>
                        <p><strong>(iv)</strong> Oxygen (O) - atomic number 8</p>
                        <div class="answer-space">
                            <textarea id="p2q3a" placeholder="Explain ion formation processes and write configurations..." rows="8"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q3a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q3a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Na: loses 1 electron from 3s orbital → Na⁺: [Ne] (1 mark)</p>
                            <p><strong>M2:</strong> Cl: gains 1 electron in 3p orbital → Cl⁻: [Ar] (1 mark)</p>
                            <p><strong>M3:</strong> Ca: loses 2 electrons from 4s orbital → Ca²⁺: [Ar] (1 mark)</p>
                            <p><strong>M4:</strong> O: gains 2 electrons in 2p orbital → O²⁻: [Ne] (1 mark)</p>
                            <p><strong>M5:</strong> All achieve noble gas configuration (1 mark)</p>
                            <p><strong>M6:</strong> Correct electron loss/gain explanations (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Calculate the ionic radius ratio for the following ion pairs and explain the trend:</p>
                        <p><strong>Ion Pairs:</strong> Na⁺/Cl⁻, Ca²⁺/O²⁻, K⁺/Br⁻</p>
                        <div class="answer-space">
                            <textarea id="p2q3b" placeholder="Calculate ratios and explain trends..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q3b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q3b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Na⁺/Cl⁻ ≈ 0.52, Ca²⁺/O²⁻ ≈ 0.74, K⁺/Br⁻ ≈ 0.68 (2 marks)</p>
                            <p><strong>M2:</strong> Cations smaller than anions due to nuclear charge (1 mark)</p>
                            <p><strong>M3:</strong> Higher charge = smaller ionic radius (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 2 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 2</h3>
                    <div class="question-part">
                        <h4>(a) [8 marks]</h4>
                        <p>Complete the following table for transition metal ion formation:</p>
                        <div class="table-container">
                            <table class="config-table">
                                <thead>
                                    <tr>
                                        <th>Element</th>
                                        <th>Neutral Config</th>
                                        <th>Ion Formed</th>
                                        <th>Ion Config</th>
                                        <th>Magnetic Property</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Iron (Fe)</td>
                                        <td>[Ar] 4s² 3d⁶</td>
                                        <td><input type="text" id="p3q2a-fe-ion" placeholder="e.g., Fe²⁺"></td>
                                        <td><input type="text" id="p3q2a-fe-config" placeholder="Enter config"></td>
                                        <td><input type="text" id="p3q2a-fe-mag" placeholder="Para/Dia"></td>
                                    </tr>
                                    <tr>
                                        <td>Iron (Fe)</td>
                                        <td>[Ar] 4s² 3d⁶</td>
                                        <td><input type="text" id="p3q2a-fe2-ion" placeholder="e.g., Fe³⁺"></td>
                                        <td><input type="text" id="p3q2a-fe2-config" placeholder="Enter config"></td>
                                        <td><input type="text" id="p3q2a-fe2-mag" placeholder="Para/Dia"></td>
                                    </tr>
                                    <tr>
                                        <td>Copper (Cu)</td>
                                        <td>[Ar] 4s¹ 3d¹⁰</td>
                                        <td><input type="text" id="p3q2a-cu-ion" placeholder="e.g., Cu²⁺"></td>
                                        <td><input type="text" id="p3q2a-cu-config" placeholder="Enter config"></td>
                                        <td><input type="text" id="p3q2a-cu-mag" placeholder="Para/Dia"></td>
                                    </tr>
                                    <tr>
                                        <td>Chromium (Cr)</td>
                                        <td>[Ar] 4s¹ 3d⁵</td>
                                        <td><input type="text" id="p3q2a-cr-ion" placeholder="e.g., Cr³⁺"></td>
                                        <td><input type="text" id="p3q2a-cr-config" placeholder="Enter config"></td>
                                        <td><input type="text" id="p3q2a-cr-mag" placeholder="Para/Dia"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q2a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q2a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Fe²⁺: [Ar] 3d⁶, paramagnetic (2 marks)</p>
                            <p><strong>M2:</strong> Fe³⁺: [Ar] 3d⁵, paramagnetic (2 marks)</p>
                            <p><strong>M3:</strong> Cu²⁺: [Ar] 3d⁹, paramagnetic (2 marks)</p>
                            <p><strong>M4:</strong> Cr³⁺: [Ar] 3d³, paramagnetic (2 marks)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Explain why Fe³⁺ is more stable than Fe²⁺ in aqueous solution, considering electron configurations and charge density.</p>
                        <div class="answer-space">
                            <textarea id="p2q2b" placeholder="Explain Fe³⁺ stability over Fe²⁺..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q2b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q2b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Fe³⁺ has half-filled 3d subshell (1 mark)</p>
                            <p><strong>M2:</strong> Half-filled subshell provides extra stability (1 mark)</p>
                            <p><strong>M3:</strong> Higher charge density in Fe³⁺ (1 mark)</p>
                            <p><strong>M4:</strong> Better hydration in aqueous solution (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 3 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 3</h3>
                    <div class="question-part">
                        <h4>(a) [6 marks]</h4>
                        <p>Predict the electron configuration and properties of the following ions:</p>
                        <p><strong>(i)</strong> Mn²⁺ (manganese ion)</p>
                        <p><strong>(ii)</strong> Co³⁺ (cobalt ion)</p>
                        <p><strong>(iii)</strong> Ni²⁺ (nickel ion)</p>
                        <p>For each ion, state: electron configuration, magnetic property, and likely color in solution.</p>
                        <div class="answer-space">
                            <textarea id="p2q3a" placeholder="Predict configurations and properties..." rows="6"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q3a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q3a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Mn²⁺: [Ar] 3d⁵, paramagnetic, pale pink (2 marks)</p>
                            <p><strong>M2:</strong> Co³⁺: [Ar] 3d⁶, paramagnetic, blue (2 marks)</p>
                            <p><strong>M3:</strong> Ni²⁺: [Ar] 3d⁸, paramagnetic, green (2 marks)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Explain why transition metal ions are often colored, while main group metal ions (like Na⁺, Ca²⁺) are colorless.</p>
                        <div class="answer-space">
                            <textarea id="p2q3b" placeholder="Explain color differences..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q3b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q3b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Transition metals have partially filled d orbitals (1 mark)</p>
                            <p><strong>M2:</strong> d-d electronic transitions absorb visible light (1 mark)</p>
                            <p><strong>M3:</strong> Main group ions have filled/empty outer shells (1 mark)</p>
                            <p><strong>M4:</strong> No d-d transitions possible in main group ions (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 4 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 4</h3>
                    <div class="question-part">
                        <h4>(a) [5 marks]</h4>
                        <p>Calculate the effective nuclear charge (Zeff) for the following ions and explain the trend:</p>
                        <p><strong>Ions:</strong> Na⁺, Mg²⁺, Al³⁺, Si⁴⁺</p>
                        <p>Use the formula: Zeff = Z - S (where Z = atomic number, S = shielding constant)</p>
                        <div class="answer-space">
                            <textarea id="p2q4a" placeholder="Calculate Zeff and explain trends..." rows="5"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q4a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q4a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Na⁺: Zeff = 11 - 2 = 9 (1 mark)</p>
                            <p><strong>M2:</strong> Mg²⁺: Zeff = 12 - 2 = 10 (1 mark)</p>
                            <p><strong>M3:</strong> Al³⁺: Zeff = 13 - 2 = 11 (1 mark)</p>
                            <p><strong>M4:</strong> Si⁴⁺: Zeff = 14 - 2 = 12 (1 mark)</p>
                            <p><strong>M5:</strong> Zeff increases with increasing charge (1 mark)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [3 marks]</h4>
                        <p>Explain how effective nuclear charge affects ionic radius and ionization energy.</p>
                        <div class="answer-space">
                            <textarea id="p2q4b" placeholder="Explain Zeff effects on radius and IE..." rows="3"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q4b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q4b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> Higher Zeff = smaller ionic radius (1 mark)</p>
                            <p><strong>M2:</strong> Higher Zeff = higher ionization energy (1 mark)</p>
                            <p><strong>M3:</strong> Electrons held more tightly by nucleus (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 5 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 5</h3>
                    <div class="question-part">
                        <h4>(a) [6 marks]</h4>
                        <p>Explain the formation of complex ions and their electron configurations:</p>
                        <p><strong>(i)</strong> [Fe(CN)₆]³⁻ - hexacyanoferrate(III) ion</p>
                        <p><strong>(ii)</strong> [Cu(NH₃)₄]²⁺ - tetraamminecopper(II) ion</p>
                        <p><strong>(iii)</strong> [Co(H₂O)₆]²⁺ - hexaaquacobalt(II) ion</p>
                        <div class="answer-space">
                            <textarea id="p2q5a" placeholder="Explain complex ion formation..." rows="6"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q5a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q5a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> [Fe(CN)₆]³⁻: Fe³⁺ + 6CN⁻, d²sp³ hybridization (2 marks)</p>
                            <p><strong>M2:</strong> [Cu(NH₃)₄]²⁺: Cu²⁺ + 4NH₃, dsp² hybridization (2 marks)</p>
                            <p><strong>M3:</strong> [Co(H₂O)₆]²⁺: Co²⁺ + 6H₂O, sp³d² hybridization (2 marks)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Predict the magnetic properties and colors of these complex ions, explaining your reasoning.</p>
                        <div class="answer-space">
                            <textarea id="p2q5b" placeholder="Predict magnetic properties and colors..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p2q5b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p2q5b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> [Fe(CN)₆]³⁻: paramagnetic, red (1 mark)</p>
                            <p><strong>M2:</strong> [Cu(NH₃)₄]²⁺: paramagnetic, blue (1 mark)</p>
                            <p><strong>M3:</strong> [Co(H₂O)₆]²⁺: paramagnetic, pink (1 mark)</p>
                            <p><strong>M4:</strong> All have unpaired electrons in d orbitals (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Question 6 -->
            <div class="quiz-section">
                <div class="question-container">
                    <h3>Question 6</h3>
                    <div class="question-part">
                        <h4>(a) [8 marks]</h4>
                        <p>Design an experiment to determine the electron configuration of an unknown transition metal ion in solution. Include:</p>
                        <p><strong>(i)</strong> Experimental method</p>
                        <p><strong>(ii)</strong> Measurements to be taken</p>
                        <p><strong>(iii)</strong> How to interpret results</p>
                        <p><strong>(iv)</strong> Safety considerations</p>
                        <div class="answer-space">
                            <textarea id="p3q6a" placeholder="Design experiment to determine electron configuration..." rows="8"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p3q6a')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p3q6a-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> UV-Vis spectroscopy to measure d-d transitions (2 marks)</p>
                            <p><strong>M2:</strong> Magnetic susceptibility measurements (2 marks)</p>
                            <p><strong>M3:</strong> Compare with known standards (2 marks)</p>
                            <p><strong>M4:</strong> Safety: gloves, goggles, fume hood (2 marks)</p>
                        </div>
                    </div>

                    <div class="question-part">
                        <h4>(b) [4 marks]</h4>
                        <p>Explain how the results of your experiment would help identify the electron configuration of the unknown ion.</p>
                        <div class="answer-space">
                            <textarea id="p3q6b" placeholder="Explain how results identify configuration..." rows="4"></textarea>
                        </div>
                        <button class="btn secondary" onclick="showMarkScheme('p3q6b')">Show Mark Scheme</button>
                        <div class="mark-scheme" id="p3q6b-scheme" style="display: none;">
                            <strong>Mark Scheme:</strong>
                            <p><strong>M1:</strong> UV-Vis peaks indicate d-d transition energies (1 mark)</p>
                            <p><strong>M2:</strong> Magnetic data shows number of unpaired electrons (1 mark)</p>
                            <p><strong>M3:</strong> Color indicates specific d orbital splitting (1 mark)</p>
                            <p><strong>M4:</strong> Combined data gives complete electron configuration (1 mark)</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Paper 3 Controls -->
            <div class="paper-controls">
                <button class="btn primary" onclick="submitPaper3()">Submit Paper 3</button>
                <button class="btn secondary" onclick="savePaper3()">Save Progress</button>
                <button class="btn ghost" onclick="resetPaper3()">Reset Paper</button>
            </div>
        </div>


        <!-- Core Rules Section -->
        <div id="coreRulesContent" class="content-section" style="display: none;">
            <div class="content-header">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn ghost" onclick="hideDetailedContent()" style="display: flex; align-items: center; gap: 8px;">
                        <span class="custom-emoji emoji-atom"></span>
                        ← Back to Tiles
                    </button>
                    <div style="flex: 1; text-align: center;">
                        <h2 style="color: var(--accent); font-size: 36px; margin: 0; display: flex; align-items: center; gap: 15px; justify-content: center;">
                            <span class="custom-emoji emoji-atom"></span>
                            Core Rules - Interactive Learning
                        </h2>
                    </div>
                    <div style="width: 120px;"></div> <!-- Spacer for centering -->
                </div>
                <p style="color: var(--light); font-size: 18px; margin-bottom: 30px; opacity: 0.8;">
                    Master the three fundamental principles through interactive demonstrations. These are the exact same rules used in the main app's study and game modes.
                </p>
            </div>

            <!-- Learning Objectives Section -->
            <div class="objectives-section">
                <h3>
                    <span class="custom-emoji emoji-target"></span>
                    Learning Objectives
                </h3>
                <p>
                    What you will learn and master in this Core Rules section
                </p>
                
                <div class="objectives-grid">
                    
                    <div class="objective-card">
                        <h4>🎯 Aufbau Principle</h4>
                        <ul>
                            <li>Understand that electrons fill lowest energy orbitals first</li>
                            <li>Learn the correct filling order: 1s → 2s → 2p → 3s → 3p → 4s → 3d...</li>
                            <li>Recognize energy levels from n=1 (bottom) to n=7 (top)</li>
                            <li>Apply the principle to predict electron configurations</li>
                        </ul>
                    </div>

                    <div class="objective-card">
                        <h4>🎯 Hund's Rule</h4>
                        <ul>
                            <li>Understand that electrons spread out in degenerate orbitals first</li>
                            <li>Learn that all unpaired electrons have the same spin (↑)</li>
                            <li>Recognize that pairing only occurs after all orbitals have one electron</li>
                            <li>Apply the rule to p, d, and f subshells</li>
                        </ul>
                    </div>

                    <div class="objective-card">
                        <h4>🎯 Pauli Exclusion Principle</h4>
                        <ul>
                            <li>Understand that each orbital can hold maximum 2 electrons</li>
                            <li>Learn that paired electrons must have opposite spins (↑↓)</li>
                            <li>Recognize the difference between filled and paired orbitals</li>
                            <li>Apply the principle to prevent orbital overcrowding</li>
                        </ul>
                    </div>

                    <div class="objective-card">
                        <h4>🎯 Interactive Application</h4>
                        <ul>
                            <li>Use interactive demonstrations to visualize each rule</li>
                            <li>Practice applying all three rules together</li>
                            <li>Test understanding through quizzes and assessments</li>
                            <li>Master the vocabulary and terminology</li>
                        </ul>
                    </div>

                </div>
            </div>

            <!-- Essential Vocabulary Section -->
            <div class="vocabulary-section" style="background: rgba(15, 23, 42, 0.3); border: 2px solid var(--border); border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                <h3 style="color: var(--accent); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span class="custom-emoji emoji-book"></span>
                    Essential Vocabulary
                </h3>
                <p style="color: var(--light); margin-bottom: 20px; font-style: italic;">
                    Key terms used in the Core Rules demonstrations and quizzes
                </p>
                
                <div class="vocabulary-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    
                    <!-- Core Rules Terms -->
                    <div class="vocab-card" style="background: rgba(30, 41, 59, 0.5); border: 2px solid var(--border); border-radius: 12px; padding: 20px;">
                        <h4 style="color: var(--accent); margin-bottom: 15px; font-size: 18px;">🎯 Core Rules</h4>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--success);">Aufbau Principle:</strong> 
                            <span style="color: var(--light);">Electrons fill lowest energy orbitals first</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--warning);">Hund's Rule:</strong> 
                            <span style="color: var(--light);">Electrons spread out in degenerate orbitals before pairing</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--accent);">Pauli Exclusion:</strong> 
                            <span style="color: var(--light);">Maximum 2 electrons per orbital with opposite spins</span>
                        </div>
                        <div class="vocab-item">
                            <strong style="color: var(--danger);">Ground State:</strong> 
                            <span style="color: var(--light);">Lowest energy electron configuration</span>
                        </div>
                    </div>

                    <!-- Orbital Structure -->
                    <div class="vocab-card" style="background: rgba(30, 41, 59, 0.5); border: 2px solid var(--border); border-radius: 12px; padding: 20px;">
                        <h4 style="color: var(--accent); margin-bottom: 15px; font-size: 18px;">🌌 Orbital Structure</h4>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--success);">Energy Level (n):</strong> 
                            <span style="color: var(--light);">Shell number (1, 2, 3, 4, 5, 6, 7)</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--warning);">Subshell:</strong> 
                            <span style="color: var(--light);">s, p, d, f regions within each shell</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--accent);">Orbital:</strong> 
                            <span style="color: var(--light);">Individual electron space (s=1, p=3, d=5, f=7)</span>
                        </div>
                        <div class="vocab-item">
                            <strong style="color: var(--danger);">Degenerate Orbitals:</strong> 
                            <span style="color: var(--light);">Orbitals with same energy (p, d, f sets)</span>
                        </div>
                    </div>

                    <!-- Electron Properties -->
                    <div class="vocab-card" style="background: rgba(30, 41, 59, 0.5); border: 2px solid var(--border); border-radius: 12px; padding: 20px;">
                        <h4 style="color: var(--accent); margin-bottom: 15px; font-size: 18px;">⚡ Electron Properties</h4>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--success);">Electron Spin:</strong> 
                            <span style="color: var(--light);">↑ (up) or ↓ (down) - intrinsic property</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--warning);">Paired Electrons:</strong> 
                            <span style="color: var(--light);">Two electrons with opposite spins in same orbital</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--accent);">Unpaired Electrons:</strong> 
                            <span style="color: var(--light);">Single electrons in orbitals (same spin)</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--danger);">Lone Pair:</strong> 
                            <span style="color: var(--light);">Pair of electrons not involved in bonding</span>
                        </div>
                        <div class="vocab-item">
                            <strong style="color: var(--success);">Filling Order:</strong> 
                            <span style="color: var(--light);">Sequence: 1s→2s→2p→3s→3p→4s→3d→4p→5s...</span>
                        </div>
                    </div>

                    <!-- Interactive Terms -->
                    <div class="vocab-card" style="background: rgba(30, 41, 59, 0.5); border: 2px solid var(--border); border-radius: 12px; padding: 20px;">
                        <h4 style="color: var(--accent); margin-bottom: 15px; font-size: 18px;">🎮 Interactive Terms</h4>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--success);">Filled Orbital:</strong> 
                            <span style="color: var(--light);">Orbital with 2 electrons (↑↓)</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--warning);">Half-Filled:</strong> 
                            <span style="color: var(--light);">Orbital with 1 electron (↑)</span>
                        </div>
                        <div class="vocab-item" style="margin-bottom: 12px;">
                            <strong style="color: var(--accent);">Empty Orbital:</strong> 
                            <span style="color: var(--light);">Orbital with 0 electrons</span>
                        </div>
                        <div class="vocab-item">
                            <strong style="color: var(--danger);">Electron Configuration:</strong> 
                            <span style="color: var(--light);">How electrons are arranged in orbitals</span>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Official Rule Definitions -->
            <div class="content-card">
                <h3 style="color: var(--accent); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span class="custom-emoji emoji-study"></span>
                    Official Rule Definitions
                </h3>
                <p style="color: var(--light); margin-bottom: 20px; font-style: italic;">
                    These are the exact definitions used in the main app's study and game modes:
                </p>
                
                <div class="rule-definitions">
                    <div class="rule-definition">
                        <h4 style="color: var(--warning); margin-bottom: 10px;">1. Aufbau principle</h4>
                        <p style="color: var(--light); margin-bottom: 15px;">Electrons occupy the lowest-energy available subshells first.</p>
                    </div>
                    
                    <div class="rule-definition">
                        <h4 style="color: var(--success); margin-bottom: 10px;">2. Hund's rule</h4>
                        <p style="color: var(--light); margin-bottom: 15px;">In a set of degenerate orbitals (p, d, f), place one electron in each with the <b>same spin</b> before pairing.</p>
                    </div>
                    
                    <div class="rule-definition">
                        <h4 style="color: var(--danger); margin-bottom: 10px;">3. Pauli exclusion principle</h4>
                        <p style="color: var(--light); margin-bottom: 15px;">Each orbital holds at most two electrons and they must have <b>opposite spins</b> (↑↓).</p>
                    </div>
                </div>
            </div>

            <!-- Interactive Aufbau Sequence -->
            <div class="content-card">
                <h3 style="color: var(--warning); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span class="custom-emoji emoji-energy"></span>
                    Interactive Aufbau Sequence
                </h3>
                <p style="color: var(--light); margin-bottom: 20px;">
                    Watch electrons fill orbitals in order of increasing energy. Click the buttons to see the sequence in action!
                </p>
                
                                    <div class="aufbau-demo">
                        <div class="building" id="aufbauBuilding">
                                            <!-- Shell n=7 (Highest Energy - Top) -->
                <div class="floor" data-n="7">
                    <div class="floor-label">Shell n=7 (Highest Energy)</div>
                    <div class="wings">
                        <div class="wing wing-p" data-sub="7p">
                            <div class="wing-title">7p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="7p" data-index="0">
                                    <div class="unit-label">7px</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="7p-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="7p-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="7p" data-index="1">
                                    <div class="unit-label">7py</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="7p-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="7p-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="7p" data-index="2">
                                    <div class="unit-label">7pz</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="7p-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="7p-6"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-s" data-sub="7s">
                            <div class="wing-title">7s wing — <span class="mini">ℓ=0 (s)</span></div>
                            <div class="units">
                                <div class="unit" data-wing="7s" data-index="0">
                                    <div class="unit-label">7s</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="7s-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="7s-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                            
                                            <!-- Shell n=6 -->
                <div class="floor" data-n="6">
                    <div class="floor-label">Shell n=6</div>
                    <div class="wings">
                        <div class="wing wing-d" data-sub="6d">
                            <div class="wing-title">6d wing — <span class="mini">ℓ=2 (d)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="6d" data-index="0">
                                    <div class="unit-label">6d₁</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6d-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="6d-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="6d" data-index="1">
                                    <div class="unit-label">6d₂</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6d-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="6d-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="6d" data-index="2">
                                    <div class="unit-label">6d₃</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6d-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="6d-6"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="6d" data-index="3">
                                    <div class="unit-label">6d₄</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6d-7"></div>
                                        <div class="slot" data-slot="1" data-orbital="6d-8"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="6d" data-index="4">
                                    <div class="unit-label">6d₅</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6d-9"></div>
                                        <div class="slot" data-slot="1" data-orbital="6d-10"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-p" data-sub="6p">
                            <div class="wing-title">6p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="6p" data-index="0">
                                    <div class="unit-label">6px</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6p-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="6p-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="6p" data-index="1">
                                    <div class="unit-label">6py</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6p-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="6p-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="6p" data-index="2">
                                    <div class="unit-label">6pz</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6p-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="6p-6"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-s" data-sub="6s">
                            <div class="wing-title">6s wing — <span class="mini">ℓ=0 (s)</span></div>
                            <div class="units">
                                <div class="unit" data-wing="6s" data-index="0">
                                    <div class="unit-label">6s</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="6s-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="6s-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                            
                                            <!-- Shell n=5 -->
                <div class="floor" data-n="5">
                    <div class="floor-label">Shell n=5</div>
                    <div class="wings">
                        <div class="wing wing-f" data-sub="5f">
                            <div class="wing-title">5f wing — <span class="mini">ℓ=3 (f)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="5f" data-index="0">
                                    <div class="unit-label">5f₁</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5f-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="5f-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5f" data-index="1">
                                    <div class="unit-label">5f₂</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5f-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="5f-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5f" data-index="2">
                                    <div class="unit-label">5f₃</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5f-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="5f-6"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5f" data-index="3">
                                    <div class="unit-label">5f₄</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5f-7"></div>
                                        <div class="slot" data-slot="1" data-orbital="5f-8"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5f" data-index="4">
                                    <div class="unit-label">5f₅</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5f-9"></div>
                                        <div class="slot" data-slot="1" data-orbital="5f-10"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5f" data-index="5">
                                    <div class="unit-label">5f₆</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5f-11"></div>
                                        <div class="slot" data-slot="1" data-orbital="5f-12"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5f" data-index="6">
                                    <div class="unit-label">5f₇</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5f-13"></div>
                                        <div class="slot" data-slot="1" data-orbital="5f-14"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-d" data-sub="5d">
                            <div class="wing-title">5d wing — <span class="mini">ℓ=2 (d)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="5d" data-index="0">
                                    <div class="unit-label">5d₁</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5d-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="5d-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5d" data-index="1">
                                    <div class="unit-label">5d₂</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5d-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="5d-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5d" data-index="2">
                                    <div class="unit-label">5d₃</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5d-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="5d-6"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5d" data-index="3">
                                    <div class="unit-label">5d₄</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5d-7"></div>
                                        <div class="slot" data-slot="1" data-orbital="5d-8"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5d" data-index="4">
                                    <div class="unit-label">5d₅</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5d-9"></div>
                                        <div class="slot" data-slot="1" data-orbital="5d-10"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-p" data-sub="5p">
                            <div class="wing-title">5p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="5p" data-index="0">
                                    <div class="unit-label">5px</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5p-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="5p-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5p" data-index="1">
                                    <div class="unit-label">5py</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5p-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="5p-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="5p" data-index="2">
                                    <div class="unit-label">5pz</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5p-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="5p-6"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-s" data-sub="5s">
                            <div class="wing-title">5s wing — <span class="mini">ℓ=0 (s)</span></div>
                            <div class="units">
                                <div class="unit" data-wing="5s" data-index="0">
                                    <div class="unit-label">5s</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="5s-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="5s-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                            
                                            <!-- Shell n=4 -->
                <div class="floor" data-n="4">
                    <div class="floor-label">Shell n=4</div>
                    <div class="wings">
                        <div class="wing wing-f" data-sub="4f">
                            <div class="wing-title">4f wing — <span class="mini">ℓ=3 (f)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="4f" data-index="0">
                                    <div class="unit-label">4f₁</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4f-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="4f-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4f" data-index="1">
                                    <div class="unit-label">4f₂</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4f-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="4f-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4f" data-index="2">
                                    <div class="unit-label">4f₃</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4f-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="4f-6"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4f" data-index="3">
                                    <div class="unit-label">4f₄</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4f-7"></div>
                                        <div class="slot" data-slot="1" data-orbital="4f-8"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4f" data-index="4">
                                    <div class="unit-label">4f₅</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4f-9"></div>
                                        <div class="slot" data-slot="1" data-orbital="4f-10"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4f" data-index="5">
                                    <div class="unit-label">4f₆</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4f-11"></div>
                                        <div class="slot" data-slot="1" data-orbital="4f-12"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4f" data-index="6">
                                    <div class="unit-label">4f₇</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4f-13"></div>
                                        <div class="slot" data-slot="1" data-orbital="4f-14"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-d" data-sub="4d">
                            <div class="wing-title">4d wing — <span class="mini">ℓ=2 (d)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="4d" data-index="0">
                                    <div class="unit-label">4d₁</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4d-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="4d-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4d" data-index="1">
                                    <div class="unit-label">4d₂</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4d-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="4d-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4d" data-index="2">
                                    <div class="unit-label">4d₃</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4d-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="4d-6"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4d" data-index="3">
                                    <div class="unit-label">4d₄</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4d-7"></div>
                                        <div class="slot" data-slot="1" data-orbital="4d-8"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4d" data-index="4">
                                    <div class="unit-label">4d₅</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4d-9"></div>
                                        <div class="slot" data-slot="1" data-orbital="4d-10"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-p" data-sub="4p">
                            <div class="wing-title">4p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="4p" data-index="0">
                                    <div class="unit-label">4px</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4p-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="4p-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4p" data-index="1">
                                    <div class="unit-label">4py</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4p-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="4p-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="4p" data-index="2">
                                    <div class="unit-label">4pz</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4p-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="4p-6"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-s" data-sub="4s">
                            <div class="wing-title">4s wing — <span class="mini">ℓ=0 (s)</span></div>
                            <div class="units">
                                <div class="unit" data-wing="4s" data-index="0">
                                    <div class="unit-label">4s</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="4s-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="4s-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                            
                                            <!-- Shell n=3 -->
                <div class="floor" data-n="3">
                    <div class="floor-label">Shell n=3</div>
                    <div class="wings">
                        <div class="wing wing-d" data-sub="3d">
                            <div class="wing-title">3d wing — <span class="mini">ℓ=2 (d)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="3d" data-index="0">
                                    <div class="unit-label">3d₁</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3d-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="3d-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="3d" data-index="1">
                                    <div class="unit-label">3d₂</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3d-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="3d-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="3d" data-index="2">
                                    <div class="unit-label">3d₃</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3d-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="3d-6"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="3d" data-index="3">
                                    <div class="unit-label">3d₄</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3d-7"></div>
                                        <div class="slot" data-slot="1" data-orbital="3d-8"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="3d" data-index="4">
                                    <div class="unit-label">3d₅</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3d-9"></div>
                                        <div class="slot" data-slot="1" data-orbital="3d-10"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-p" data-sub="3p">
                            <div class="wing-title">3p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                            <div class="units">
                                <div class="unit" data-wing="3p" data-index="0">
                                    <div class="unit-label">3px</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3p-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="3p-2"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="3p" data-index="1">
                                    <div class="unit-label">3py</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3p-3"></div>
                                        <div class="slot" data-slot="1" data-orbital="3p-4"></div>
                                    </div>
                                </div>
                                <div class="unit" data-wing="3p" data-index="2">
                                    <div class="unit-label">3pz</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3p-5"></div>
                                        <div class="slot" data-slot="1" data-orbital="3p-6"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="wing wing-s" data-sub="3s">
                            <div class="wing-title">3s wing — <span class="mini">ℓ=0 (s)</span></div>
                            <div class="units">
                                <div class="unit" data-wing="3s" data-index="0">
                                    <div class="unit-label">3s</div>
                                    <div class="slots">
                                        <div class="slot" data-slot="0" data-orbital="3s-1"></div>
                                        <div class="slot" data-slot="1" data-orbital="3s-2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                            
                            <!-- Shell n=2 -->
                            <div class="floor" data-n="2">
                                <div class="floor-label">Shell n=2</div>
                                <div class="wings">
                                    <div class="wing wing-p" data-sub="2p">
                                        <div class="wing-title">2p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2p" data-index="0">
                                                <div class="unit-label">2px</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-1"></div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-2"></div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="1">
                                                <div class="unit-label">2py</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-3"></div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-4"></div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="2">
                                                <div class="unit-label">2pz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2p-5"></div>
                                                    <div class="slot" data-slot="1" data-orbital="2p-6"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="wing wing-s" data-sub="2s">
                                        <div class="wing-title">2s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2s" data-index="0">
                                                <div class="unit-label">2s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="2s-1"></div>
                                                    <div class="slot" data-slot="1" data-orbital="2s-2"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Shell n=1 (Lowest Energy - Bottom) -->
                            <div class="floor" data-n="1">
                                <div class="floor-label">Shell n=1 (Lowest Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="1s">
                                        <div class="wing-title">1s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="1s" data-index="0">
                                                <div class="unit-label">1s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="1s-1"></div>
                                                    <div class="slot" data-slot="1" data-orbital="1s-2"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                    <div class="demo-controls">
                        <button class="tile-btn" onclick="showFillingOrder()">Show Filling Order</button>
                        <button class="tile-btn secondary" onclick="resetAufbau()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Hund's Rule Demonstration -->
            <div class="content-card">
                <h3 style="color: var(--success); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span class="custom-emoji emoji-star"></span>
                    Hund's Rule Demonstration
                </h3>
                <p style="color: var(--light); margin-bottom: 20px;">
                    See how electrons distribute themselves in degenerate orbitals. Click the orbitals to understand parallel vs. paired spins!
                </p>
                
                                    <div class="hund-demo">
                        <div class="building" id="hundBuilding">
                            <div class="floor" data-n="2">
                                <div class="floor-label">Shell n=2 - P Orbitals (Degenerate - Same Energy)</div>
                                <div class="wings">
                                    <div class="wing wing-p" data-sub="2p">
                                        <div class="wing-title">2p wing — <span class="mini">ℓ=1 (p)</span> <span class="degenerate-label">DEGENERATE</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="2p" data-index="0">
                                                <div class="unit-label">2px</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="p1-1" onclick="toggleElectron(this)"></div>
                                                    <div class="slot" data-slot="1" data-orbital="p1-2" onclick="toggleElectron(this)"></div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="1">
                                                <div class="unit-label">2py</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="p1-3" onclick="toggleElectron(this)"></div>
                                                    <div class="slot" data-slot="1" data-orbital="p1-4" onclick="toggleElectron(this)"></div>
                                                </div>
                                            </div>
                                            <div class="unit" data-wing="2p" data-index="2">
                                                <div class="unit-label">2pz</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" data-orbital="p1-5" onclick="toggleElectron(this)"></div>
                                                    <div class="slot" data-slot="1" data-orbital="p1-6" onclick="toggleElectron(this)"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    
                    <div class="demo-controls">
                        <button class="tile-btn" onclick="showElectronDistribution()">Show Distribution</button>
                        <button class="tile-btn secondary" onclick="resetHund()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Pauli Exclusion Principle -->
            <div class="content-card">
                <h3 style="color: var(--danger); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span class="custom-emoji emoji-nucleus"></span>
                    Pauli Exclusion Principle
                </h3>
                <p style="color: var(--light); margin-bottom: 20px;">
                    Test the rule that no two electrons can have identical quantum numbers. Try to place electrons and see what happens!
                </p>
                
                                    <div class="pauli-demo">
                        <div class="building" id="pauliBuilding">
                            <div class="floor" data-n="1">
                                <div class="floor-label">Test Orbital - Pauli Exclusion Principle (Max 2 electrons per orbital)</div>
                                <div class="wings">
                                    <div class="wing wing-s" data-sub="1s">
                                        <div class="wing-title">1s wing — <span class="mini">ℓ=0 (s)</span></div>
                                        <div class="units">
                                            <div class="unit" data-wing="1s" data-index="0">
                                                <div class="unit-label">1s</div>
                                                <div class="slots">
                                                    <div class="slot" data-slot="0" id="testOrbital1" onclick="addElectron(this)"></div>
                                                    <div class="slot" data-slot="1" id="testOrbital2" onclick="addElectron(this)"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="electron-count" style="text-align: center; margin-top: 15px; color: var(--light);">
                            Electrons: <span id="electronCount">0</span>/2
                        </div>
                    
                    <div class="demo-controls">
                        <button class="tile-btn secondary" onclick="resetPauli()">Reset</button>
                    </div>
                    
                    <div class="pauli-feedback" id="pauliFeedback"></div>
                </div>
            </div>

            <!-- Vocabulary Quiz Section -->
            <div class="vocab-quiz-section" style="background: rgba(15, 23, 42, 0.3); border: 2px solid var(--border); border-radius: 15px; padding: 25px; margin-bottom: 30px;">
                <h3 style="color: var(--accent); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span class="custom-emoji emoji-brain"></span>
                    Vocabulary Quiz
                </h3>
                <p style="color: var(--light); margin-bottom: 20px; font-style: italic;">
                    Test your understanding of the key chemistry terms before proceeding to the interactive concepts
                </p>
                
                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>1. What does Hund's Rule state?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab1" value="a" style="margin-right: 8px;">
                            Electrons fill orbitals in pairs first
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab1" value="b" style="margin-right: 8px;">
                            Electrons spread out in degenerate orbitals before pairing (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab1" value="c" style="margin-right: 8px;">
                            Each orbital can hold only 2 electrons
                        </label>
                    </div>
                </div>

                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>2. What are degenerate orbitals?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab2" value="a" style="margin-right: 8px;">
                            Orbitals with different energies
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab2" value="b" style="margin-right: 8px;">
                            Orbitals with the same energy (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab2" value="c" style="margin-right: 8px;">
                            Orbitals that are empty
                        </label>
                    </div>
                </div>

                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>3. What is the Pauli Exclusion Principle?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab3" value="a" style="margin-right: 8px;">
                            Electrons fill lowest energy orbitals first
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab3" value="b" style="margin-right: 8px;">
                            Maximum 2 electrons per orbital with opposite spins (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab3" value="c" style="margin-right: 8px;">
                            Electrons spread out before pairing
                        </label>
                    </div>
                </div>

                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>4. What are unpaired electrons?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab4" value="a" style="margin-right: 8px;">
                            Two electrons with opposite spins in same orbital
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab4" value="b" style="margin-right: 8px;">
                            Single electrons in orbitals with same spin (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab4" value="c" style="margin-right: 8px;">
                            Electrons in the highest energy level
                        </label>
                    </div>
                </div>

                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>5. What is a lone pair?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab5" value="a" style="margin-right: 8px;">
                            A single electron in an orbital
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab5" value="b" style="margin-right: 8px;">
                            Pair of electrons not involved in bonding (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab5" value="c" style="margin-right: 8px;">
                            Electrons in the outermost shell
                        </label>
                    </div>
                </div>

                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>6. What does the Aufbau Principle state?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab6" value="a" style="margin-right: 8px;">
                            Electrons spread out before pairing
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab6" value="b" style="margin-right: 8px;">
                            Electrons fill lowest energy orbitals first (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab6" value="c" style="margin-right: 8px;">
                            Maximum 2 electrons per orbital
                        </label>
                    </div>
                </div>

                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>7. How many orbitals are in a p subshell?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab7" value="a" style="margin-right: 8px;">
                            1 orbital
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab7" value="b" style="margin-right: 8px;">
                            3 orbitals (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab7" value="c" style="margin-right: 8px;">
                            5 orbitals
                        </label>
                    </div>
                </div>

                <div class="quiz-question" style="margin-bottom: 20px;">
                    <p style="color: var(--light); margin-bottom: 10px;"><strong>8. What is the ground state?</strong></p>
                    <div class="quiz-options" style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab8" value="a" style="margin-right: 8px;">
                            The highest energy configuration
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab8" value="b" style="margin-right: 8px;">
                            The lowest energy electron configuration (correct)
                        </label>
                        <label style="color: var(--light); cursor: pointer; padding: 8px; border-radius: 8px; background: rgba(30, 41, 59, 0.5);">
                            <input type="radio" name="vocab8" value="c" style="margin-right: 8px;">
                            A temporary configuration
                        </label>
                    </div>
                </div>

                <div class="quiz-controls" style="margin-top: 20px;">
                    <button class="tile-btn" onclick="checkVocabQuiz()">Check Answers</button>
                    <button class="tile-btn secondary" onclick="resetVocabQuiz()">Reset Quiz</button>
                </div>

                <div id="vocabResults" style="margin-top: 20px; padding: 15px; border-radius: 10px; display: none;"></div>
            </div>

            <!-- Interactive Quiz -->
            <div class="content-card">
                <h3 style="color: var(--accent); font-size: 24px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span class="custom-emoji emoji-study"></span>
                    Quick Understanding Check
                </h3>
                <p style="color: var(--light); margin-bottom: 20px;">
                    Test your understanding of the core rules with these interactive questions!
                </p>
                
                <div class="understanding-quiz" id="understandingQuiz">
                    <div class="quiz-question">
                        <h4>Question 1: What is the correct order for filling orbitals?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(1, 'a')">A) 1s → 2s → 2p → 3s → 3p → 4s → 3d</button>
                            <button class="quiz-option" onclick="checkAnswer(1, 'b')">B) 1s → 2s → 3s → 2p → 3p → 4s → 3d</button>
                            <button class="quiz-option" onclick="checkAnswer(1, 'c')">C) 1s → 2s → 2p → 3s → 3d → 3p → 4s</button>
                        </div>
                    </div>
                    
                                                <div class="quiz-question">
                                <h4>Question 2: How should electrons be placed in degenerate orbitals?</h4>
                                <div class="quiz-options">
                                    <button class="quiz-option" onclick="checkAnswer(2, 'a')">A) Pair up immediately</button>
                                    <button class="quiz-option" onclick="checkAnswer(2, 'b')">B) Spread out with parallel spins first</button>
                                    <button class="quiz-option" onclick="checkAnswer(2, 'c')">C) Random placement</button>
                                </div>
                            </div>
                    
                    <div class="quiz-question">
                        <h4>Question 3: What is the maximum number of electrons per orbital?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(3, 'a')">A) 1</button>
                            <button class="quiz-option" onclick="checkAnswer(3, 'b')">B) 2</button>
                            <button class="quiz-option" onclick="checkAnswer(3, 'c')">C) 3</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 4: In a 2p subshell, how should 4 electrons be arranged?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(4, 'a')">A) All in one orbital (px: ↑↓, py: empty, pz: empty)</button>
                            <button class="quiz-option" onclick="checkAnswer(4, 'b')">B) Two orbitals with 2 electrons each (px: ↑↓, py: ↑↓, pz: empty)</button>
                            <button class="quiz-option" onclick="checkAnswer(4, 'c')">C) One electron in each orbital, then pair (px: ↑, py: ↑, pz: ↑↓)</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 5: What happens when electrons pair in an orbital?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(5, 'a')">A) They have the same spin (both ↑ or both ↓)</button>
                            <button class="quiz-option" onclick="checkAnswer(5, 'b')">B) They have opposite spins (one ↑ and one ↓)</button>
                            <button class="quiz-option" onclick="checkAnswer(5, 'c')">C) They can have any spin combination</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 6: Which element has the electron configuration 1s² 2s² 2p⁶?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(6, 'a')">A) Neon (Ne)</button>
                            <button class="quiz-option" onclick="checkAnswer(6, 'b')">B) Fluorine (F)</button>
                            <button class="quiz-option" onclick="checkAnswer(6, 'c')">C) Sodium (Na)</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 7: How many unpaired electrons does oxygen (O) have in its ground state?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(7, 'a')">A) 0 unpaired electrons</button>
                            <button class="quiz-option" onclick="checkAnswer(7, 'b')">B) 2 unpaired electrons</button>
                            <button class="quiz-option" onclick="checkAnswer(7, 'c')">C) 4 unpaired electrons</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 8: What is the correct electron configuration for carbon (C)?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(8, 'a')">A) 1s² 2s² 2p² (6 electrons total)</button>
                            <button class="quiz-option" onclick="checkAnswer(8, 'b')">B) 1s² 2s² 2p⁴ (8 electrons total)</button>
                            <button class="quiz-option" onclick="checkAnswer(8, 'c')">C) 1s² 2s⁴ (6 electrons total)</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 9: Which rule explains why electrons spread out before pairing?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(9, 'a')">A) Aufbau Principle</button>
                            <button class="quiz-option" onclick="checkAnswer(9, 'b')">B) Hund's Rule</button>
                            <button class="quiz-option" onclick="checkAnswer(9, 'c')">C) Pauli Exclusion Principle</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 10: How many orbitals are in a d subshell?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(10, 'a')">A) 3 orbitals</button>
                            <button class="quiz-option" onclick="checkAnswer(10, 'b')">B) 5 orbitals</button>
                            <button class="quiz-option" onclick="checkAnswer(10, 'c')">C) 7 orbitals</button>
                        </div>
                    </div>

                    <div class="quiz-question">
                        <h4>Question 11: How are the 2p electrons arranged in nitrogen (N)?</h4>
                        <div class="quiz-options">
                            <button class="quiz-option" onclick="checkAnswer(11, 'a')">A) px: ↑↓, py: ↑↓, pz: ↑↓ (all paired)</button>
                            <button class="quiz-option" onclick="checkAnswer(11, 'b')">B) px: ↑, py: ↑, pz: ↑ (all unpaired)</button>
                            <button class="quiz-option" onclick="checkAnswer(11, 'c')">C) px: ↑↓, py: ↑, pz: empty (mixed)</button>
                        </div>
                    </div>
                </div>
                
                <div class="quiz-results" id="quizResults" style="display: none;">
                    <h4 style="color: var(--success);">Quiz Results</h4>
                    <p>Score: <span id="quizScore">0</span>/11</p>
                    <p id="quizFeedback"></p>
                </div>
            </div>
        </div>


        <!-- ======= Assessment Detailed Content ======= -->
        <div id="assessmentContent" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hideDetailedContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span class="custom-emoji emoji-arrow-left"></span>
                    Back to Study Guide
                </button>
                <h1 class="content-title">
                    <span class="custom-emoji emoji-nucleus"></span>
                    A-Level Edexcel Pearson Assessment
                </h1>
                <p class="content-subtitle">Comprehensive examination-style assessments with detailed mark schemes</p>
            </div>
            <!-- Assessment Overview -->
            <div class="objectives-section">
                <h3>📋 Electron Configuration Assessment Structure</h3>
                <p>Comprehensive assessments focused specifically on electron configuration topics:</p>
                <div class="objectives-grid">
                    <div class="objective-card">
                        <h4>📄 Paper 1: Core Principles & Rules</h4>
                        <p><strong>Duration:</strong> 45 minutes | <strong>Marks:</strong> 50</p>
                        <ul>
                            <li>Aufbau Principle & Orbital Filling</li>
                            <li>Hund's Rule & Electron Spin</li>
                            <li>Pauli Exclusion Principle</li>
                            <li>Orbital Diagrams & Notation</li>
                            <li>Energy Level Ordering</li>
                        </ul>
                    </div>
                    <div class="objective-card">
                        <h4>🧪 Paper 2: Exceptions & Complex Cases</h4>
                        <p><strong>Duration:</strong> 45 minutes | <strong>Marks:</strong> 50</p>
                        <ul>
                            <li>Chromium & Copper Exceptions</li>
                            <li>Half-filled Subshell Stability</li>
                            <li>Filled Subshell Stability</li>
                            <li>d-block Configurations</li>
                            <li>Stability Principles</li>
                        </ul>
                    </div>
                    <div class="objective-card">
                        <h4>⚡ Paper 3: Ion Formation & Applications</h4>
                        <p><strong>Duration:</strong> 50 minutes | <strong>Marks:</strong> 60</p>
                        <ul>
                            <li>Cation Formation (Metals)</li>
                            <li>Anion Formation (Non-metals)</li>
                            <li>Electron Configuration Changes</li>
                            <li>Ionic Radius Trends</li>
                            <li>Real-world Applications</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Paper Selection -->
            <div class="interactive-section">
                <h3>🎯 Select Your Assessment</h3>
                <p>Choose a paper to begin your Edexcel-style examination practice:</p>
                
                <div class="ion-formation-grid">
                    <div class="formation-card">
                        <h4>📄 Paper 1: Core Principles & Rules</h4>
                        <p>Master the fundamental principles of electron configuration</p>
                        <div class="example-box">
                            <strong>Key Topics:</strong>
                            <p>• Aufbau principle application<br>
                            • Hund's rule & electron spin<br>
                            • Pauli exclusion principle<br>
                            • Orbital diagrams & notation</p>
                        </div>
                        <div class="formation-actions">
                            <button class="btn primary" onclick="startPaper1()">Start Paper 1</button>
                            <button class="btn secondary" onclick="viewPaper1MarkScheme()">View Mark Scheme</button>
                        </div>
                    </div>

                    <div class="formation-card">
                        <h4>🧪 Paper 2: Exceptions & Complex Cases</h4>
                        <p>Explore transition metal exceptions and stability principles</p>
                        <div class="example-box">
                            <strong>Key Topics:</strong>
                            <p>• Chromium & Copper exceptions<br>
                            • Half-filled subshell stability<br>
                            • Filled subshell stability<br>
                            • d-block configurations</p>
                        </div>
                        <div class="formation-actions">
                            <button class="btn primary" onclick="startPaper2()">Start Paper 2</button>
                            <button class="btn secondary" onclick="viewPaper2MarkScheme()">View Mark Scheme</button>
                        </div>
                    </div>

                    <div class="formation-card">
                        <h4>⚡ Paper 3: Ion Formation & Applications</h4>
                        <p>Understand how atoms gain and lose electrons to form ions</p>
                        <div class="example-box">
                            <strong>Key Topics:</strong>
                            <p>• Cation formation (metals)<br>
                            • Anion formation (non-metals)<br>
                            • Electron configuration changes<br>
                            • Real-world applications</p>
                        </div>
                        <div class="formation-actions">
                            <button class="btn primary" onclick="startPaper3()">Start Paper 3</button>
                            <button class="btn secondary" onclick="viewPaper3MarkScheme()">View Mark Scheme</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ======= Paper 1: Core Principles & Rules ======= -->
        <div id="paper1Content" class="content-section" style="display: none;">
            <div class="content-header">
                <button class="btn ghost" onclick="hidePaperContent()" style="display: flex; align-items: center; gap: 8px;">
                    <span class="custom-emoji emoji-arrow-left"></span>
                    Back to Assessment
                </button>
                <h1 class="content-title">
                    <span class="custom-emoji emoji-nucleus"></span>
                    Paper 1: Core Principles & Rules
                </h1>
                <p class="content-subtitle">Duration: 45 minutes | Total Marks: 50</p>
                <div class="paper-timer" id="paper1Timer">
                    <span class="timer-label">Time Remaining:</span>
                    <span class="timer-display" id="paper1TimeDisplay">45:00</span>
                </div>
            </div>
                    Interactive Atom Builder
                </h2>
                <p style="color: var(--light); margin-bottom: 25px;">
                    Build atoms step by step and see how electrons fill orbitals according to the Aufbau principle, Hund's rule, and Pauli exclusion principle.
                </p>

                <div class="atom-builder-container" style="background: var(--dark); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <div class="element-selector" style="margin-bottom: 20px;">
                        <label for="elementSelect" style="color: var(--light); font-weight: 600; margin-bottom: 10px; display: block;">Choose an Element:</label>
                        <select id="elementSelect" onchange="loadElement()" style="width: 100%; padding: 12px; border: 2px solid var(--accent); border-radius: 8px; background: var(--dark); color: var(--light); font-size: 16px;">
                            <option value="">Select an element...</option>
                            <option value="H">Hydrogen (H) - Z=1</option>
                            <option value="He">Helium (He) - Z=2</option>
                            <option value="Li">Lithium (Li) - Z=3</option>
                            <option value="Be">Beryllium (Be) - Z=4</option>
                            <option value="B">Boron (B) - Z=5</option>
                            <option value="C">Carbon (C) - Z=6</option>
                            <option value="N">Nitrogen (N) - Z=7</option>
                            <option value="O">Oxygen (O) - Z=8</option>
                            <option value="F">Fluorine (F) - Z=9</option>
                            <option value="Ne">Neon (Ne) - Z=10</option>
                            <option value="Na">Sodium (Na) - Z=11</option>
                            <option value="Mg">Magnesium (Mg) - Z=12</option>
                            <option value="Al">Aluminum (Al) - Z=13</option>
                            <option value="Si">Silicon (Si) - Z=14</option>
                            <option value="P">Phosphorus (P) - Z=15</option>
                            <option value="S">Sulfur (S) - Z=16</option>
                            <option value="Cl">Chlorine (Cl) - Z=17</option>
                            <option value="Ar">Argon (Ar) - Z=18</option>
                            <option value="K">Potassium (K) - Z=19</option>
                            <option value="Ca">Calcium (Ca) - Z=20</option>
                            <option value="Cr">Chromium (Cr) - Z=24</option>
                            <option value="Cu">Copper (Cu) - Z=29</option>
                        </select>
                    </div>

                    <div class="atom-display" id="atomDisplay" style="text-align: center; margin: 20px 0;">
                        <div class="element-info" style="background: var(--accent); color: var(--dark); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 id="elementName" style="margin: 0; font-size: 24px;">Select an element to begin</h3>
                            <p id="elementDetails" style="margin: 5px 0 0 0; opacity: 0.8;">Choose from the dropdown above</p>
                        </div>
                        
                        <div class="electron-configuration" id="electronConfig" style="background: var(--dark); border: 2px solid var(--accent); border-radius: 10px; padding: 20px; margin: 20px 0;">
                            <h4 style="color: var(--accent); margin-bottom: 15px;">Electron Configuration:</h4>
                            <div id="configDisplay" style="font-family: 'Courier New', monospace; font-size: 18px; color: var(--light);">
                                Select an element to see its configuration
                            </div>
                        </div>

                        <div class="orbital-diagram" id="orbitalDiagram" style="background: var(--dark); border: 2px solid var(--accent); border-radius: 10px; padding: 20px; margin: 20px 0;">
                            <h4 style="color: var(--accent); margin-bottom: 15px;">Orbital Diagram:</h4>
                            <div id="orbitalDisplay" style="font-family: 'Courier New', monospace; font-size: 16px; color: var(--light);">
                                Select an element to see its orbital diagram
                            </div>
                        </div>
                    </div>

                    <div class="builder-controls" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn primary" onclick="resetAtomBuilder()">
                            <span class="custom-emoji emoji-reset"></span>
                            Reset
                        </button>
                        <button class="btn secondary" onclick="showAtomBuilderHint()">
                            <span class="custom-emoji emoji-lightbulb"></span>
                            Hint
                        </button>
                        <button class="btn secondary" onclick="checkAtomBuilder()">
                            <span class="custom-emoji emoji-check"></span>
                            Check Answer
                        </button>
                    </div>
                </div>
            </div>

            <!-- Guided Problems Section -->
            <div id="guidedProblemsSection" class="practice-section" style="display: none;">
                <h2 style="color: var(--accent); margin-bottom: 20px;">
                    <span class="custom-emoji emoji-lightbulb"></span>
                    Guided Problem Solving
                </h2>
                <p style="color: var(--light); margin-bottom: 25px;">
                    Work through electron configuration problems with step-by-step guidance and hints.
                </p>

                <div class="problem-container" style="background: var(--dark); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <div class="problem-selector" style="margin-bottom: 20px;">
                        <label for="problemSelect" style="color: var(--light); font-weight: 600; margin-bottom: 10px; display: block;">Choose a Problem:</label>
                        <select id="problemSelect" onchange="loadProblem()" style="width: 100%; padding: 12px; border: 2px solid var(--accent); border-radius: 8px; background: var(--dark); color: var(--light); font-size: 16px;">
                            <option value="">Select a problem...</option>
                            <option value="basic-1">Basic: Write electron configuration for Carbon</option>
                            <option value="basic-2">Basic: Write electron configuration for Sodium</option>
                            <option value="intermediate-1">Intermediate: Write electron configuration for Iron</option>
                            <option value="intermediate-2">Intermediate: Write electron configuration for Bromine</option>
                            <option value="advanced-1">Advanced: Write electron configuration for Chromium</option>
                            <option value="advanced-2">Advanced: Write electron configuration for Copper</option>
                            <option value="ion-1">Ion Formation: Write electron configuration for Na⁺</option>
                            <option value="ion-2">Ion Formation: Write electron configuration for Cl⁻</option>
                        </select>
                    </div>

                    <div class="problem-display" id="problemDisplay" style="display: none;">
                        <div class="problem-statement" style="background: var(--accent); color: var(--dark); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h3 id="problemTitle" style="margin: 0 0 10px 0;">Problem Title</h3>
                            <p id="problemText" style="margin: 0; font-size: 16px;">Problem description will appear here</p>
                        </div>

                        <div class="solution-steps" id="solutionSteps" style="margin-bottom: 20px;">
                            <!-- Solution steps will be populated by JavaScript -->
                        </div>

                        <div class="student-input" style="margin-bottom: 20px;">
                            <label for="studentAnswer" style="color: var(--light); font-weight: 600; margin-bottom: 10px; display: block;">Your Answer:</label>
                            <input type="text" id="studentAnswer" placeholder="Enter your electron configuration here..." style="width: 100%; padding: 12px; border: 2px solid var(--accent); border-radius: 8px; background: var(--dark); color: var(--light); font-size: 16px; font-family: 'Courier New', monospace;">
                        </div>

                        <div class="guidance-controls" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn primary" onclick="showNextStep()">
                                <span class="custom-emoji emoji-arrow-right"></span>
                                Next Step
                            </button>
                            <button class="btn secondary" onclick="showHint()">
                                <span class="custom-emoji emoji-lightbulb"></span>
                                Get Hint
                            </button>
                            <button class="btn secondary" onclick="checkAnswer()">
                                <span class="custom-emoji emoji-check"></span>
                                Check Answer
                            </button>
                            <button class="btn ghost" onclick="showFullSolution()">
                                <span class="custom-emoji emoji-eye"></span>
                                Show Solution
                            </button>
                        </div>

                        <div class="feedback" id="feedback" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;">
                            <!-- Feedback will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interactive Quiz Section -->
            <div id="interactiveQuizSection" class="practice-section" style="display: none;">
                <h2 style="color: var(--accent); margin-bottom: 20px;">
                    <span class="custom-emoji emoji-quiz"></span>
                    Interactive Quiz
                </h2>
                <p style="color: var(--light); margin-bottom: 25px;">
                    Test your knowledge with interactive multiple-choice and fill-in-the-blank questions.
                </p>

                <div class="quiz-container" style="background: var(--dark); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <div class="quiz-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                        <div class="quiz-info">
                            <h3 style="color: var(--accent); margin: 0;">Electron Configuration Quiz</h3>
                            <p style="color: var(--light); margin: 5px 0 0 0;">Test your understanding</p>
                        </div>
                        <div class="quiz-stats" style="display: flex; gap: 20px; align-items: center;">
                            <div class="score" style="color: var(--light);">
                                Score: <span id="quizScore" style="color: var(--accent); font-weight: 600;">0</span>/<span id="totalQuestions">10</span>
                            </div>
                            <div class="progress" style="color: var(--light);">
                                Question: <span id="currentQuestion">1</span>/<span id="totalQuestions2">10</span>
                            </div>
                        </div>
                    </div>

                    <div class="quiz-question" id="quizQuestion" style="margin-bottom: 25px;">
                        <div class="question-text" style="background: var(--accent); color: var(--dark); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <h4 id="questionText" style="margin: 0; font-size: 18px;">Question will appear here</h4>
                        </div>
                        
                        <div class="question-options" id="questionOptions" style="display: none;">
                            <!-- Options will be populated by JavaScript -->
                        </div>

                        <div class="question-input" id="questionInput" style="display: none;">
                            <input type="text" id="textAnswer" placeholder="Enter your answer here..." style="width: 100%; padding: 12px; border: 2px solid var(--accent); border-radius: 8px; background: var(--dark); color: var(--light); font-size: 16px; font-family: 'Courier New', monospace;">
                        </div>
                    </div>

                    <div class="quiz-controls" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn primary" onclick="startQuiz()" id="startQuizBtn">
                            <span class="custom-emoji emoji-play"></span>
                            Start Quiz
                        </button>
                        <button class="btn secondary" onclick="nextQuestion()" id="nextQuestionBtn" style="display: none;">
                            <span class="custom-emoji emoji-arrow-right"></span>
                            Next Question
                        </button>
                        <button class="btn secondary" onclick="submitAnswer()" id="submitAnswerBtn" style="display: none;">
                            <span class="custom-emoji emoji-check"></span>
                            Submit Answer
                        </button>
                        <button class="btn ghost" onclick="resetQuiz()" id="resetQuizBtn" style="display: none;">
                            <span class="custom-emoji emoji-reset"></span>
                            Reset Quiz
                        </button>
                    </div>

                    <div class="quiz-results" id="quizResults" style="display: none; margin-top: 25px; padding: 20px; background: var(--dark); border: 2px solid var(--accent); border-radius: 10px;">
                        <h4 style="color: var(--accent); margin-bottom: 15px;">Quiz Results</h4>
                        <div class="score-display" style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 48px; color: var(--accent); font-weight: bold;" id="finalScore">0</div>
                            <div style="color: var(--light); font-size: 18px;">out of 10</div>
                        </div>
                        <div class="performance-message" id="performanceMessage" style="text-align: center; margin-bottom: 20px; font-size: 16px; color: var(--light);">
                            <!-- Performance message will be populated by JavaScript -->
                        </div>
                        <div class="quiz-actions" style="display: flex; gap: 15px; justify-content: center;">
                            <button class="btn primary" onclick="retakeQuiz()">
                                <span class="custom-emoji emoji-reset"></span>
                                Retake Quiz
                            </button>
                            <button class="btn secondary" onclick="showQuizReview()">
                                <span class="custom-emoji emoji-eye"></span>
                                Review Answers
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulations Section -->
            <div id="simulationsSection" class="practice-section" style="display: none;">
                <h2 style="color: var(--accent); margin-bottom: 20px;">
                    <span class="custom-emoji emoji-simulation"></span>
                    Interactive Simulations
                </h2>
                <p style="color: var(--light); margin-bottom: 25px;">
                    Visualize electron behavior and orbital filling with interactive simulations.
                </p>

                <div class="simulation-container" style="background: var(--dark); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <div class="simulation-selector" style="margin-bottom: 20px;">
                        <label for="simulationSelect" style="color: var(--light); font-weight: 600; margin-bottom: 10px; display: block;">Choose a Simulation:</label>
                        <select id="simulationSelect" onchange="loadSimulation()" style="width: 100%; padding: 12px; border: 2px solid var(--accent); border-radius: 8px; background: var(--dark); color: var(--light); font-size: 16px;">
                            <option value="">Select a simulation...</option>
                            <option value="orbital-filling">Orbital Filling Animation</option>
                            <option value="electron-spin">Electron Spin Visualization</option>
                            <option value="energy-levels">Energy Level Diagram</option>
                            <option value="ion-formation">Ion Formation Process</option>
                            <option value="magnetic-properties">Magnetic Properties</option>
                        </select>
                    </div>

                    <div class="simulation-display" id="simulationDisplay" style="text-align: center; min-height: 300px; display: flex; align-items: center; justify-content: center; background: var(--dark); border: 2px dashed var(--accent); border-radius: 10px; margin: 20px 0;">
                        <div style="color: var(--light); font-size: 18px;">
                            Select a simulation to begin
                        </div>
                    </div>

                    <div class="simulation-controls" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn primary" onclick="playSimulation()" id="playBtn" style="display: none;">
                            <span class="custom-emoji emoji-play"></span>
                            Play
                        </button>
                        <button class="btn secondary" onclick="pauseSimulation()" id="pauseBtn" style="display: none;">
                            <span class="custom-emoji emoji-pause"></span>
                            Pause
                        </button>
                        <button class="btn secondary" onclick="resetSimulation()" id="resetBtn" style="display: none;">
                            <span class="custom-emoji emoji-reset"></span>
                            Reset
                        </button>
                        <button class="btn ghost" onclick="showSimulationInfo()" id="infoBtn" style="display: none;">
                            <span class="custom-emoji emoji-info"></span>
                            Info
                        </button>
                    </div>
                </div>
            </div>

            <!-- Practice Problems Section -->
            <div id="practiceProblemsSection" class="practice-section" style="display: none;">
                <h2 style="color: var(--accent); margin-bottom: 20px;">
                    <span class="custom-emoji emoji-practice"></span>
                    Practice Problems
                </h2>
                <p style="color: var(--light); margin-bottom: 25px;">
                    Work through a variety of electron configuration problems to master the concepts.
                </p>

                <div class="problems-container" style="background: var(--dark); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                    <div class="problem-categories" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div class="category-card" onclick="loadProblemCategory('basic')" style="background: var(--accent); color: var(--dark); padding: 20px; border-radius: 10px; cursor: pointer; text-align: center; transition: transform 0.3s ease;">
                            <h3 style="margin: 0 0 10px 0;">Basic Problems</h3>
                            <p style="margin: 0; opacity: 0.8;">Simple electron configurations</p>
                        </div>
                        <div class="category-card" onclick="loadProblemCategory('intermediate')" style="background: var(--accent); color: var(--dark); padding: 20px; border-radius: 10px; cursor: pointer; text-align: center; transition: transform 0.3s ease;">
                            <h3 style="margin: 0 0 10px 0;">Intermediate Problems</h3>
                            <p style="margin: 0; opacity: 0.8;">Transition metals and exceptions</p>
                        </div>
                        <div class="category-card" onclick="loadProblemCategory('advanced')" style="background: var(--accent); color: var(--dark); padding: 20px; border-radius: 10px; cursor: pointer; text-align: center; transition: transform 0.3s ease;">
                            <h3 style="margin: 0 0 10px 0;">Advanced Problems</h3>
                            <p style="margin: 0; opacity: 0.8;">Complex ions and applications</p>
                        </div>
                    </div>

                    <div class="problems-list" id="problemsList" style="display: none;">
                        <h3 id="categoryTitle" style="color: var(--accent); margin-bottom: 20px;">Problem Category</h3>
                        <div id="problemsGrid" class="problems-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <!-- Problems will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="problem-workspace" id="problemWorkspace" style="display: none; margin-top: 25px; padding: 20px; background: var(--dark); border: 2px solid var(--accent); border-radius: 10px;">
                        <div class="workspace-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                            <h3 id="currentProblemTitle" style="color: var(--accent); margin: 0;">Current Problem</h3>
                            <button class="btn ghost" onclick="closeProblemWorkspace()" style="padding: 8px 15px;">
                                <span class="custom-emoji emoji-close"></span>
                                Close
                            </button>
                        </div>
                        
                        <div class="problem-statement" id="currentProblemStatement" style="background: var(--accent); color: var(--dark); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                            <!-- Problem statement will be populated by JavaScript -->
                        </div>

                        <div class="workspace-area" style="margin-bottom: 20px;">
                            <label for="workspaceInput" style="color: var(--light); font-weight: 600; margin-bottom: 10px; display: block;">Your Solution:</label>
                            <textarea id="workspaceInput" placeholder="Work through your solution here..." style="width: 100%; height: 200px; padding: 15px; border: 2px solid var(--accent); border-radius: 8px; background: var(--dark); color: var(--light); font-size: 14px; font-family: 'Courier New', monospace; resize: vertical;"></textarea>
                        </div>

                        <div class="workspace-controls" style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn primary" onclick="checkProblemAnswer()">
                                <span class="custom-emoji emoji-check"></span>
                                Check Answer
                            </button>
                            <button class="btn secondary" onclick="getProblemHint()">
                                <span class="custom-emoji emoji-lightbulb"></span>
                                Get Hint
                            </button>
                            <button class="btn secondary" onclick="showProblemSolution()">
                                <span class="custom-emoji emoji-eye"></span>
                                Show Solution
                            </button>
                            <button class="btn ghost" onclick="saveProblemProgress()">
                                <span class="custom-emoji emoji-save"></span>
                                Save Progress
                            </button>
                        </div>

                        <div class="problem-feedback" id="problemFeedback" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;">
                            <!-- Feedback will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ======= Footer (Consistent with main app) ======= -->
    <footer class="app-footer">
        <span><span class="custom-emoji emoji-scientist"></span> © 2025 Electron Towers APP • Mr.Sep Educational Services</span>
    </footer>

    <script>
        // Interactive functionality for the study tiles
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects and animations
            const studyTiles = document.querySelectorAll('.study-tile');
            studyTiles.forEach(tile => {
                tile.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-12px) scale(1.03)';
                });
                
                tile.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });

            // Update progress indicators on tiles
            updateTileProgressIndicators();
            

            // Add click effects for buttons
            const buttons = document.querySelectorAll('.tile-btn, .btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                });
            });
        });

        // Placeholder functions for tile actions
        function showSection(section) {
            console.log('Showing section:', section);
            // This would show detailed content for each section
        }




        function explainExceptions() {
            console.log('Explaining exceptions');
            // This would provide detailed exception explanations
        }

        function ionExamples() {
            console.log('Showing ion examples');
            // This would display ion formation examples
        }

        function showProblems() {
            console.log('Showing practice problems');
            // This would display practice problems
        }

        function startAssessment() {
            console.log('Starting assessment');
            // This would begin the quiz
        }

        // ======= Assessment Interactive Functions =======

        // Show detailed content when clicking on Assessment tile
        function showAssessmentContent() {
            document.getElementById('detailedContent').style.display = 'block';
            document.getElementById('assessmentContent').style.display = 'block';
            document.getElementById('overviewContent').style.display = 'none';
            document.getElementById('coreRulesContent').style.display = 'none';
            document.getElementById('exceptionsContent').style.display = 'none';
            document.getElementById('ionFormationContent').style.display = 'none';
            document.querySelector('.study-tiles').style.display = 'none';
            document.querySelector('.page-title').style.display = 'none';
            
            // Initialize Assessment progress tracking
            initializeAssessmentProgress();
        }

        // ======= Assessment Progress Tracking Functions =======

        function initializeAssessmentProgress() {
            // Load saved progress
            const savedProgress = localStorage.getItem('electronTowerProgress');
            let progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            
            // Initialize assessment concept if not exists
            if (!progress.concepts.assessment) {
                progress.concepts.assessment = {
                    completed: false,
                    score: 0,
                    attempts: 0,
                    timeSpent: 0,
                    activities: {
                        vocabularyQuiz: { completed: false, score: 0, attempts: 0 },
                        understandingCheck: { completed: false, score: 0, attempts: 0 },
                        interactiveDemos: { completed: 0, total: 0 },
                        contentEngagement: { completed: false, timeSpent: 0 },
                        paper1: { completed: false, score: 0, attempts: 0 },
                        paper2: { completed: false, score: 0, attempts: 0 },
                        paper3: { completed: false, score: 0, attempts: 0 }
                    }
                };
                localStorage.setItem('electronTowerProgress', JSON.stringify(progress));
            }
            
            // Track content engagement
            updateProgress('assessment', 'contentEngagement', 0, 0, 1);
            
            // Update progress display
            updateAssessmentProgressDisplay();
        }

        function updateAssessmentProgressDisplay() {
            const savedProgress = localStorage.getItem('electronTowerProgress');
            const progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            const assessmentProgress = progress.concepts.assessment;
            
            if (!assessmentProgress) return;
            
            // Calculate completion based on activities (7 total: 4 standard + 3 papers)
            const activities = assessmentProgress.activities;
            let completedCount = 0;
            const totalCount = 7;
            
            // Check standard activities
            if (activities.contentEngagement.completed) completedCount++;
            if (activities.understandingCheck.completed) completedCount++;
            if (activities.interactiveDemos.completed > 0) completedCount++;
            if (activities.vocabularyQuiz.completed) completedCount++;
            
            // Check paper completions
            if (activities.paper1.completed) completedCount++;
            if (activities.paper2.completed) completedCount++;
            if (activities.paper3.completed) completedCount++;
            
            // Update tile progress
            updateTileProgressIndicators();
        }

        // Paper 1 Functions
        function startPaper1() {
            console.log('Starting Paper 1: Core Principles & Rules');
            
            try {
                // Hide all other content sections
                document.getElementById('detailedContent').style.display = 'block';
                document.getElementById('paper1Content').style.display = 'block';
                document.getElementById('assessmentContent').style.display = 'none';
                document.getElementById('overviewContent').style.display = 'none';
                document.getElementById('coreRulesContent').style.display = 'none';
                document.getElementById('exceptionsContent').style.display = 'none';
                document.getElementById('ionFormationContent').style.display = 'none';
                
                // Hide study tiles and page title
                const studyTiles = document.querySelector('.study-tiles');
                const pageTitle = document.querySelector('.page-title');
                if (studyTiles) studyTiles.style.display = 'none';
                if (pageTitle) pageTitle.style.display = 'none';
                
                // Start timer
                startPaper1Timer();
                
                // Scroll to top of paper
                window.scrollTo(0, 0);
                
                console.log('Paper 1 started successfully');
            } catch (error) {
                console.error('Error starting Paper 1:', error);
                alert('Error starting Paper 1. Please check the console for details.');
            }
        }

        // Paper 1 Timer
        let paper1TimerInterval;
        let paper1TimeRemaining = 45 * 60; // 45 minutes in seconds

        function startPaper1Timer() {
            paper1TimerInterval = setInterval(() => {
                paper1TimeRemaining--;
                updatePaper1TimerDisplay();
                
                if (paper1TimeRemaining <= 0) {
                    clearInterval(paper1TimerInterval);
                    alert('Time\'s up! Paper 1 has been automatically submitted.');
                    submitPaper1();
                }
            }, 1000);
        }

        function updatePaper1TimerDisplay() {
            const minutes = Math.floor(paper1TimeRemaining / 60);
            const seconds = paper1TimeRemaining % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('paper1TimeDisplay').textContent = display;
        }

        function viewPaper1MarkScheme() {
            console.log('Viewing Paper 1 Mark Scheme');
            // This would show the complete mark scheme for Paper 1
            alert('Paper 1 Mark Scheme: Core Principles & Rules\n\nThis would display the complete marking criteria and sample answers for all Paper 1 questions covering fundamental electron configuration principles.');
        }

        // Paper 1 Assessment Functions
        function showMarkScheme(questionId) {
            const scheme = document.getElementById(questionId + '-scheme');
            if (scheme.style.display === 'none') {
                scheme.style.display = 'block';
            } else {
                scheme.style.display = 'none';
            }
        }

        function submitPaper1() {
            clearInterval(paper1TimerInterval);
            
            // Collect all answers
            const answers = {
                q1a: document.getElementById('q1a').value,
                q1b: document.getElementById('q1b').value,
                q1c: document.getElementById('q1c').value,
                q2a: document.getElementById('q2a').value,
                q2b: document.getElementById('q2b').value,
                q3a: {
                    mg: document.getElementById('q3a-mg').value,
                    al: document.getElementById('q3a-al').value,
                    si: document.getElementById('q3a-si').value,
                    p: document.getElementById('q3a-p').value,
                    s: document.getElementById('q3a-s').value
                },
                q3b: document.getElementById('q3b').value,
                q4a: document.getElementById('q4a').value,
                q4b: document.getElementById('q4b').value,
                q5a: document.getElementById('q5a').value,
                q5b: document.getElementById('q5b').value
            };

            // Calculate score (simplified - in real implementation, this would be more sophisticated)
            let score = 0;
            let totalMarks = 50;
            
            // Basic scoring logic (simplified)
            Object.keys(answers).forEach(key => {
                if (typeof answers[key] === 'string' && answers[key].trim().length > 0) {
                    score += 2; // Give 2 marks for any non-empty answer
                } else if (typeof answers[key] === 'object') {
                    Object.keys(answers[key]).forEach(subKey => {
                        if (answers[key][subKey].trim().length > 0) {
                            score += 1;
                        }
                    });
                }
            });

            const percentage = Math.round((score / totalMarks) * 100);
            
            // Track Paper 1 completion
            updateProgress('assessment', 'paper1', score, totalMarks, 0);
            
            alert(`Paper 1 Submitted!\n\nScore: ${score}/${totalMarks} (${percentage}%)\n\nTime taken: ${Math.floor((45 * 60 - paper1TimeRemaining) / 60)}:${((45 * 60 - paper1TimeRemaining) % 60).toString().padStart(2, '0')}\n\nYour answers have been saved.`);
            
            // Reset timer
            paper1TimeRemaining = 45 * 60;
            updatePaper1TimerDisplay();
        }

        function savePaper1() {
            // Save progress to localStorage
            const answers = {
                q1a: document.getElementById('q1a').value,
                q1b: document.getElementById('q1b').value,
                q1c: document.getElementById('q1c').value,
                q2a: document.getElementById('q2a').value,
                q2b: document.getElementById('q2b').value,
                q3a: {
                    mg: document.getElementById('q3a-mg').value,
                    al: document.getElementById('q3a-al').value,
                    si: document.getElementById('q3a-si').value,
                    p: document.getElementById('q3a-p').value,
                    s: document.getElementById('q3a-s').value
                },
                q3b: document.getElementById('q3b').value,
                q4a: document.getElementById('q4a').value,
                q4b: document.getElementById('q4b').value,
                q5a: document.getElementById('q5a').value,
                q5b: document.getElementById('q5b').value
            };
            
            localStorage.setItem('paper1Answers', JSON.stringify(answers));
            localStorage.setItem('paper1TimeRemaining', paper1TimeRemaining.toString());
            
            alert('Paper 1 progress saved successfully!');
        }

        function resetPaper1() {
            if (confirm('Are you sure you want to reset Paper 1? All your answers will be lost.')) {
                // Clear all answers
                document.getElementById('q1a').value = '';
                document.getElementById('q1b').value = '';
                document.getElementById('q1c').value = '';
                document.getElementById('q2a').value = '';
                document.getElementById('q2b').value = '';
                document.getElementById('q3a-mg').value = '';
                document.getElementById('q3a-al').value = '';
                document.getElementById('q3a-si').value = '';
                document.getElementById('q3a-p').value = '';
                document.getElementById('q3a-s').value = '';
                document.getElementById('q3b').value = '';
                document.getElementById('q4a').value = '';
                document.getElementById('q4b').value = '';
                document.getElementById('q5a').value = '';
                document.getElementById('q5b').value = '';
                
                // Reset timer
                clearInterval(paper1TimerInterval);
                paper1TimeRemaining = 45 * 60;
                updatePaper1TimerDisplay();
                startPaper1Timer();
                
                // Hide all mark schemes
                document.querySelectorAll('[id$="-scheme"]').forEach(scheme => {
                    scheme.style.display = 'none';
                });
                
                alert('Paper 1 has been reset.');
            }
        }

        function hidePaperContent() {
            document.getElementById('paper1Content').style.display = 'none';
            document.getElementById('paper2Content').style.display = 'none';
            document.getElementById('paper3Content').style.display = 'none';
            document.getElementById('assessmentContent').style.display = 'block';
            clearInterval(paper1TimerInterval);
            clearInterval(paper2TimerInterval);
            clearInterval(paper3TimerInterval);
        }

        // ======= Paper 2 Functions =======

        // Paper 2 Functions
        function startPaper2() {
            console.log('Starting Paper 2: Exceptions & Complex Cases');
            
            try {
                // Hide all other content sections
                document.getElementById('detailedContent').style.display = 'block';
                document.getElementById('paper2Content').style.display = 'block';
                document.getElementById('assessmentContent').style.display = 'none';
                document.getElementById('paper1Content').style.display = 'none';
                document.getElementById('paper3Content').style.display = 'none';
                document.getElementById('overviewContent').style.display = 'none';
                document.getElementById('coreRulesContent').style.display = 'none';
                document.getElementById('exceptionsContent').style.display = 'none';
                document.getElementById('ionFormationContent').style.display = 'none';
                
                // Hide study tiles and page title
                const studyTiles = document.querySelector('.study-tiles');
                const pageTitle = document.querySelector('.page-title');
                if (studyTiles) studyTiles.style.display = 'none';
                if (pageTitle) pageTitle.style.display = 'none';
                
                // Start timer
                startPaper2Timer();
                
                // Scroll to top of paper
                window.scrollTo(0, 0);
                
                console.log('Paper 2 started successfully');
            } catch (error) {
                console.error('Error starting Paper 2:', error);
                alert('Error starting Paper 2. Please check the console for details.');
            }
        }

        // Paper 2 Timer
        let paper2TimerInterval;
        let paper2TimeRemaining = 45 * 60; // 45 minutes in seconds

        function startPaper2Timer() {
            paper2TimerInterval = setInterval(() => {
                paper2TimeRemaining--;
                updatePaper2TimerDisplay();
                
                if (paper2TimeRemaining <= 0) {
                    clearInterval(paper2TimerInterval);
                    alert('Time\'s up! Paper 2 has been automatically submitted.');
                    submitPaper2();
                }
            }, 1000);
        }

        function updatePaper2TimerDisplay() {
            const minutes = Math.floor(paper2TimeRemaining / 60);
            const seconds = paper2TimeRemaining % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('paper2TimeDisplay').textContent = display;
        }

        function viewPaper2MarkScheme() {
            console.log('Viewing Paper 2 Mark Scheme');
            alert('Paper 2 Mark Scheme: Exceptions & Complex Cases\n\nThis would display the complete marking criteria and sample answers for all Paper 2 questions covering transition metal exceptions.');
        }

        // Paper 2 Assessment Functions
        function submitPaper2() {
            clearInterval(paper2TimerInterval);
            
            // Collect all answers
            const answers = {
                q1a: document.getElementById('p2q1a').value,
                q1b: document.getElementById('p2q1b').value,
                q2a: document.getElementById('p2q2a').value,
                q2b: document.getElementById('p2q2b').value,
                q3a: {
                    crIon: document.getElementById('p2q3a-cr-ion').value,
                    crConfig: document.getElementById('p2q3a-cr-config').value,
                    cuIon: document.getElementById('p2q3a-cu-ion').value,
                    cuConfig: document.getElementById('p2q3a-cu-config').value,
                    feIon: document.getElementById('p2q3a-fe-ion').value,
                    feConfig: document.getElementById('p2q3a-fe-config').value
                },
                q3b: document.getElementById('p2q3b').value,
                q4a: document.getElementById('p2q4a').value,
                q4b: document.getElementById('p2q4b').value,
                q5a: document.getElementById('p2q5a').value,
                q5b: document.getElementById('p2q5b').value
            };

            // Calculate score (simplified - in real implementation, this would be more sophisticated)
            let score = 0;
            let totalMarks = 50;
            
            // Basic scoring logic (simplified)
            Object.keys(answers).forEach(key => {
                if (typeof answers[key] === 'string' && answers[key].trim().length > 0) {
                    score += 2; // Give 2 marks for any non-empty answer
                } else if (typeof answers[key] === 'object') {
                    Object.keys(answers[key]).forEach(subKey => {
                        if (answers[key][subKey].trim().length > 0) {
                            score += 1;
                        }
                    });
                }
            });

            const percentage = Math.round((score / totalMarks) * 100);
            
            // Track Paper 2 completion
            updateProgress('assessment', 'paper2', score, totalMarks, 0);
            
            alert(`Paper 2 Submitted!\n\nScore: ${score}/${totalMarks} (${percentage}%)\n\nTime taken: ${Math.floor((45 * 60 - paper2TimeRemaining) / 60)}:${((45 * 60 - paper2TimeRemaining) % 60).toString().padStart(2, '0')}\n\nYour answers have been saved.`);
            
            // Reset timer
            paper2TimeRemaining = 45 * 60;
            updatePaper2TimerDisplay();
        }

        function savePaper2() {
            // Save progress to localStorage
            const answers = {
                q1a: document.getElementById('p2q1a').value,
                q1b: document.getElementById('p2q1b').value,
                q2a: document.getElementById('p2q2a').value,
                q2b: document.getElementById('p2q2b').value,
                q3a: {
                    crIon: document.getElementById('p2q3a-cr-ion').value,
                    crConfig: document.getElementById('p2q3a-cr-config').value,
                    cuIon: document.getElementById('p2q3a-cu-ion').value,
                    cuConfig: document.getElementById('p2q3a-cu-config').value,
                    feIon: document.getElementById('p2q3a-fe-ion').value,
                    feConfig: document.getElementById('p2q3a-fe-config').value
                },
                q3b: document.getElementById('p2q3b').value,
                q4a: document.getElementById('p2q4a').value,
                q4b: document.getElementById('p2q4b').value,
                q5a: document.getElementById('p2q5a').value,
                q5b: document.getElementById('p2q5b').value
            };
            
            localStorage.setItem('paper2Answers', JSON.stringify(answers));
            localStorage.setItem('paper2TimeRemaining', paper2TimeRemaining.toString());
            
            alert('Paper 2 progress saved successfully!');
        }

        function resetPaper2() {
            if (confirm('Are you sure you want to reset Paper 2? All your answers will be lost.')) {
                // Clear all answers
                document.getElementById('p2q1a').value = '';
                document.getElementById('p2q1b').value = '';
                document.getElementById('p2q2a').value = '';
                document.getElementById('p2q2b').value = '';
                document.getElementById('p2q3a-cr-ion').value = '';
                document.getElementById('p2q3a-cr-config').value = '';
                document.getElementById('p2q3a-cu-ion').value = '';
                document.getElementById('p2q3a-cu-config').value = '';
                document.getElementById('p2q3a-fe-ion').value = '';
                document.getElementById('p2q3a-fe-config').value = '';
                document.getElementById('p2q3b').value = '';
                document.getElementById('p2q4a').value = '';
                document.getElementById('p2q4b').value = '';
                document.getElementById('p2q5a').value = '';
                document.getElementById('p2q5b').value = '';
                
                // Reset timer
                clearInterval(paper2TimerInterval);
                paper2TimeRemaining = 45 * 60;
                updatePaper2TimerDisplay();
                startPaper2Timer();
                
                // Hide all mark schemes
                document.querySelectorAll('[id$="-scheme"]').forEach(scheme => {
                    scheme.style.display = 'none';
                });
                
                alert('Paper 2 has been reset.');
            }
        }


        // ======= Paper 3 Functions =======

        // Paper 3 Functions
        function startPaper3() {
            console.log('Starting Paper 3: Ion Formation & Applications');
            
            try {
                // Hide all other content sections
                document.getElementById('detailedContent').style.display = 'block';
                document.getElementById('paper3Content').style.display = 'block';
                document.getElementById('assessmentContent').style.display = 'none';
                document.getElementById('paper1Content').style.display = 'none';
                document.getElementById('paper2Content').style.display = 'none';
                document.getElementById('overviewContent').style.display = 'none';
                document.getElementById('coreRulesContent').style.display = 'none';
                document.getElementById('exceptionsContent').style.display = 'none';
                document.getElementById('ionFormationContent').style.display = 'none';
                
                // Hide study tiles and page title
                const studyTiles = document.querySelector('.study-tiles');
                const pageTitle = document.querySelector('.page-title');
                if (studyTiles) studyTiles.style.display = 'none';
                if (pageTitle) pageTitle.style.display = 'none';
                
                // Start timer
                startPaper3Timer();
                
                // Scroll to top of paper
                window.scrollTo(0, 0);
                
                console.log('Paper 3 started successfully');
            } catch (error) {
                console.error('Error starting Paper 3:', error);
                alert('Error starting Paper 3. Please check the console for details.');
            }
        }

        // Paper 3 Timer
        let paper3TimerInterval;
        let paper3TimeRemaining = 60 * 60; // 60 minutes in seconds

        function startPaper3Timer() {
            paper3TimerInterval = setInterval(() => {
                paper3TimeRemaining--;
                updatePaper3TimerDisplay();
                
                if (paper3TimeRemaining <= 0) {
                    clearInterval(paper3TimerInterval);
                    alert('Time\'s up! Paper 3 has been automatically submitted.');
                    submitPaper3();
                }
            }, 1000);
        }

        function updatePaper3TimerDisplay() {
            const minutes = Math.floor(paper3TimeRemaining / 60);
            const seconds = paper3TimeRemaining % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('paper3TimeDisplay').textContent = display;
        }

        function viewPaper3MarkScheme() {
            console.log('Viewing Paper 3 Mark Scheme');
            alert('Paper 3 Mark Scheme: Ion Formation & Applications\n\nThis would display the complete marking criteria and sample answers for all Paper 3 questions covering ion formation and applications.');
        }

        // Paper 3 Assessment Functions
        function submitPaper3() {
            clearInterval(paper3TimerInterval);
            
            // Collect all answers
            const answers = {
                q1a: document.getElementById('p3q1a').value,
                q1b: document.getElementById('p3q1b').value,
                q2a: {
                    feIon: document.getElementById('p3q2a-fe-ion').value,
                    feConfig: document.getElementById('p3q2a-fe-config').value,
                    feMag: document.getElementById('p3q2a-fe-mag').value,
                    fe2Ion: document.getElementById('p3q2a-fe2-ion').value,
                    fe2Config: document.getElementById('p3q2a-fe2-config').value,
                    fe2Mag: document.getElementById('p3q2a-fe2-mag').value,
                    cuIon: document.getElementById('p3q2a-cu-ion').value,
                    cuConfig: document.getElementById('p3q2a-cu-config').value,
                    cuMag: document.getElementById('p3q2a-cu-mag').value,
                    crIon: document.getElementById('p3q2a-cr-ion').value,
                    crConfig: document.getElementById('p3q2a-cr-config').value,
                    crMag: document.getElementById('p3q2a-cr-mag').value
                },
                q2b: document.getElementById('p3q2b').value,
                q3a: document.getElementById('p3q3a').value,
                q3b: document.getElementById('p3q3b').value,
                q4a: document.getElementById('p3q4a').value,
                q4b: document.getElementById('p3q4b').value,
                q5a: document.getElementById('p3q5a').value,
                q5b: document.getElementById('p3q5b').value,
                q6a: document.getElementById('p3q6a').value,
                q6b: document.getElementById('p3q6b').value
            };

            // Calculate score (simplified - in real implementation, this would be more sophisticated)
            let score = 0;
            let totalMarks = 60;
            
            // Basic scoring logic (simplified)
            Object.keys(answers).forEach(key => {
                if (typeof answers[key] === 'string' && answers[key].trim().length > 0) {
                    score += 2; // Give 2 marks for any non-empty answer
                } else if (typeof answers[key] === 'object') {
                    Object.keys(answers[key]).forEach(subKey => {
                        if (answers[key][subKey].trim().length > 0) {
                            score += 1;
                        }
                    });
                }
            });

            const percentage = Math.round((score / totalMarks) * 100);
            
            // Track Paper 3 completion
            updateProgress('assessment', 'paper3', score, totalMarks, 0);
            
            alert(`Paper 3 Submitted!\n\nScore: ${score}/${totalMarks} (${percentage}%)\n\nTime taken: ${Math.floor((60 * 60 - paper3TimeRemaining) / 60)}:${((60 * 60 - paper3TimeRemaining) % 60).toString().padStart(2, '0')}\n\nYour answers have been saved.`);
            
            // Reset timer
            paper3TimeRemaining = 60 * 60;
            updatePaper3TimerDisplay();
        }

        function savePaper3() {
            // Save progress to localStorage
            const answers = {
                q1a: document.getElementById('p3q1a').value,
                q1b: document.getElementById('p3q1b').value,
                q2a: {
                    feIon: document.getElementById('p3q2a-fe-ion').value,
                    feConfig: document.getElementById('p3q2a-fe-config').value,
                    feMag: document.getElementById('p3q2a-fe-mag').value,
                    fe2Ion: document.getElementById('p3q2a-fe2-ion').value,
                    fe2Config: document.getElementById('p3q2a-fe2-config').value,
                    fe2Mag: document.getElementById('p3q2a-fe2-mag').value,
                    cuIon: document.getElementById('p3q2a-cu-ion').value,
                    cuConfig: document.getElementById('p3q2a-cu-config').value,
                    cuMag: document.getElementById('p3q2a-cu-mag').value,
                    crIon: document.getElementById('p3q2a-cr-ion').value,
                    crConfig: document.getElementById('p3q2a-cr-config').value,
                    crMag: document.getElementById('p3q2a-cr-mag').value
                },
                q2b: document.getElementById('p3q2b').value,
                q3a: document.getElementById('p3q3a').value,
                q3b: document.getElementById('p3q3b').value,
                q4a: document.getElementById('p3q4a').value,
                q4b: document.getElementById('p3q4b').value,
                q5a: document.getElementById('p3q5a').value,
                q5b: document.getElementById('p3q5b').value,
                q6a: document.getElementById('p3q6a').value,
                q6b: document.getElementById('p3q6b').value
            };
            
            localStorage.setItem('paper3Answers', JSON.stringify(answers));
            localStorage.setItem('paper3TimeRemaining', paper3TimeRemaining.toString());
            
            alert('Paper 3 progress saved successfully!');
        }

        function resetPaper3() {
            if (confirm('Are you sure you want to reset Paper 3? All your answers will be lost.')) {
                // Clear all answers
                document.getElementById('p3q1a').value = '';
                document.getElementById('p3q1b').value = '';
                document.getElementById('p3q2a-fe-ion').value = '';
                document.getElementById('p3q2a-fe-config').value = '';
                document.getElementById('p3q2a-fe-mag').value = '';
                document.getElementById('p3q2a-fe2-ion').value = '';
                document.getElementById('p3q2a-fe2-config').value = '';
                document.getElementById('p3q2a-fe2-mag').value = '';
                document.getElementById('p3q2a-cu-ion').value = '';
                document.getElementById('p3q2a-cu-config').value = '';
                document.getElementById('p3q2a-cu-mag').value = '';
                document.getElementById('p3q2a-cr-ion').value = '';
                document.getElementById('p3q2a-cr-config').value = '';
                document.getElementById('p3q2a-cr-mag').value = '';
                document.getElementById('p3q2b').value = '';
                document.getElementById('p3q3a').value = '';
                document.getElementById('p3q3b').value = '';
                document.getElementById('p3q4a').value = '';
                document.getElementById('p3q4b').value = '';
                document.getElementById('p3q5a').value = '';
                document.getElementById('p3q5b').value = '';
                document.getElementById('p3q6a').value = '';
                document.getElementById('p3q6b').value = '';
                
                // Reset timer
                clearInterval(paper3TimerInterval);
                paper3TimeRemaining = 60 * 60;
                updatePaper3TimerDisplay();
                startPaper3Timer();
                
                // Hide all mark schemes
                document.querySelectorAll('[id$="-scheme"]').forEach(scheme => {
                    scheme.style.display = 'none';
                });
                
                alert('Paper 3 has been reset.');
            }
        }

        // ======= Overview Tab Interactive Functions =======

        // Show detailed content when clicking on Overview tile
        function showOverviewContent() {
            document.getElementById('detailedContent').style.display = 'block';
            document.getElementById('overviewContent').style.display = 'block';
            document.getElementById('coreRulesContent').style.display = 'none';
            document.querySelector('.study-tiles').style.display = 'none';
            document.querySelector('.page-title').style.display = 'none';
            
            // Initialize overview progress tracking
            initializeOverviewProgress();
        }

        // ======= Overview Progress Tracking Functions =======

        function initializeOverviewProgress() {
            // Load saved progress
            const savedProgress = localStorage.getItem('electronTowerProgress');
            let progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            
            // Initialize overview concept if not exists
            if (!progress.concepts.overview) {
                progress.concepts.overview = {
                    completed: false,
                    score: 0,
                    attempts: 0,
                    timeSpent: 0,
                    activities: {
                        vocabularyQuiz: { completed: false, score: 0, attempts: 0 },
                        understandingCheck: { completed: false, score: 0, attempts: 0 },
                        interactiveDemos: { completed: 0, total: 0 },
                        contentEngagement: { completed: false, timeSpent: 0 }
                    }
                };
                localStorage.setItem('electronTowerProgress', JSON.stringify(progress));
            }
            
            // Update progress display
            updateOverviewProgressDisplay();
            
            // Track content engagement
            updateProgress('overview', 'contentEngagement', 0, 0, 1);
        }

        function updateOverviewProgressDisplay() {
            const savedProgress = localStorage.getItem('electronTowerProgress');
            const progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            const overviewProgress = progress.concepts.overview;
            
            if (!overviewProgress) return;
            
            // Calculate completion based on activities
            const activities = overviewProgress.activities;
            let completedCount = 0;
            const totalCount = 4;
            
            // Check each progress item
            const progressItems = [
                'progress-core-concepts',
                'progress-learning-objectives', 
                'progress-importance',
                'progress-assessment'
            ];
            
            // Mark core concepts as completed (user is viewing the page)
            if (activities.contentEngagement.completed) {
                markProgressItemCompleted('progress-core-concepts');
                completedCount++;
            }
            
            // Check if assessment is completed
            if (activities.understandingCheck.completed) {
                markProgressItemCompleted('progress-assessment');
                completedCount++;
            }
            
            // Update progress bar
            const percentage = Math.round((completedCount / totalCount) * 100);
            updateProgressBar(percentage);
            
            // Update tile progress
            updateTileProgressIndicators();
            
            // Trigger progress dashboard refresh if it's open in another tab
            triggerProgressDashboardRefresh();
        }

        function markProgressItemCompleted(itemId) {
            const item = document.getElementById(itemId);
            if (item) {
                item.setAttribute('data-completed', 'true');
                item.classList.add('completed');
                const checkbox = item.querySelector('.progress-checkbox');
                if (checkbox) {
                    checkbox.textContent = '✅';
                }
            }
        }

        function updateProgressBar(percentage) {
            const progressFill = document.getElementById('overviewProgressFill');
            const progressText = document.getElementById('overviewProgressText');
            
            if (progressFill) {
                progressFill.style.width = percentage + '%';
            }
            
            if (progressText) {
                progressText.textContent = percentage + '% Complete';
            }
        }

        // ======= Overview Assessment Functions =======

        function showOverviewAssessment() {
            document.getElementById('overviewAssessmentCard').style.display = 'block';
            document.getElementById('showAssessmentBtn').style.display = 'none';
            markProgressItemCompleted('progress-assessment');
            updateOverviewProgressDisplay();
        }

        function submitOverviewAssessment() {
            // Get answers
            const answers = {
                q1: document.querySelector('input[name="overviewQ1"]:checked')?.value,
                q2: document.querySelector('input[name="overviewQ2"]:checked')?.value,
                q3: document.querySelector('input[name="overviewQ3"]:checked')?.value,
                q4: document.querySelector('input[name="overviewQ4"]:checked')?.value,
                q5: document.querySelector('input[name="overviewQ5"]:checked')?.value
            };
            
            // Check if all questions answered
            const unanswered = Object.values(answers).some(answer => !answer);
            if (unanswered) {
                alert('Please answer all questions before submitting.');
                return;
            }
            
            // Correct answers
            const correctAnswers = {
                q1: 'b', // Lowest energy first
                q2: 'b', // Place one electron in each orbital with same spin, then pair
                q3: 'b', // 2 electrons
                q4: 'b', // Chromium and Copper
                q5: 'b'  // Loses an electron
            };
            
            // Calculate score
            let score = 0;
            Object.keys(answers).forEach(question => {
                if (answers[question] === correctAnswers[question]) {
                    score++;
                }
            });
            
            // Update progress
            updateProgress('overview', 'understandingCheck', score, 5, 0);
            
            // Show results
            showAssessmentResults(score, 5);
            
            // Mark assessment as completed
            markProgressItemCompleted('progress-assessment');
            updateOverviewProgressDisplay();
        }

        function showAssessmentResults(score, total) {
            const resultsDiv = document.getElementById('overviewAssessmentResults');
            const scoreElement = document.getElementById('overviewScore');
            const messageElement = document.getElementById('overviewCompletionMessage');
            
            if (scoreElement) {
                scoreElement.textContent = `${score}/${total}`;
            }
            
            if (messageElement) {
                if (score >= 4) {
                    messageElement.textContent = 'Excellent! You have a strong understanding of the overview content.';
                } else if (score >= 3) {
                    messageElement.textContent = 'Good job! You understand most of the overview content.';
                } else {
                    messageElement.textContent = 'Consider reviewing the overview content to improve your understanding.';
                }
            }
            
            if (resultsDiv) {
                resultsDiv.style.display = 'block';
            }
            
            // Hide submit button and show reset
            const submitBtn = document.getElementById('submitOverviewBtn');
            const resetBtn = document.getElementById('resetOverviewBtn');
            
            if (submitBtn) submitBtn.style.display = 'none';
            if (resetBtn) resetBtn.style.display = 'inline-flex';
        }

        function resetOverviewAssessment() {
            // Clear all radio button selections
            const radioButtons = document.querySelectorAll('#overviewAssessmentCard input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.checked = false;
            });
            
            // Hide results
            const resultsDiv = document.getElementById('overviewAssessmentResults');
            if (resultsDiv) {
                resultsDiv.style.display = 'none';
            }
            
            // Show submit button and hide reset
            const submitBtn = document.getElementById('submitOverviewBtn');
            const resetBtn = document.getElementById('resetOverviewBtn');
            
            if (submitBtn) submitBtn.style.display = 'inline-flex';
            if (resetBtn) resetBtn.style.display = 'none';
        }

        // ======= Cross-Tab Progress Sync =======

        function triggerProgressDashboardRefresh() {
            // Dispatch a custom event that progress.html can listen for
            window.dispatchEvent(new CustomEvent('progressUpdated', {
                detail: { source: 'study.html' }
            }));
            
            // Also try to communicate with progress.html if it's open in another tab
            if (window.opener && !window.opener.closed) {
                try {
                    window.opener.postMessage({ type: 'progressUpdated' }, '*');
                } catch (e) {
                    // Cross-origin or other security restrictions
                }
            }
        }

        // ======= Core Rules Interactive Functions =======

        // Show detailed content when clicking on Core Rules tile
        function showCoreRulesContent() {
            document.getElementById('detailedContent').style.display = 'block';
            document.getElementById('overviewContent').style.display = 'none';
            document.getElementById('coreRulesContent').style.display = 'block';
            document.getElementById('exceptionsContent').style.display = 'none';
            document.querySelector('.study-tiles').style.display = 'none';
            document.querySelector('.page-title').style.display = 'none';
            
            // Initialize Core Rules progress tracking
            initializeCoreRulesProgress();
        }

        // ======= Core Rules Progress Tracking Functions =======

        function initializeCoreRulesProgress() {
            // Load saved progress
            const savedProgress = localStorage.getItem('electronTowerProgress');
            let progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            
            // Initialize coreRules concept if not exists
            if (!progress.concepts.coreRules) {
                progress.concepts.coreRules = {
                    completed: false,
                    score: 0,
                    attempts: 0,
                    timeSpent: 0,
                    activities: {
                        vocabularyQuiz: { completed: false, score: 0, attempts: 0 },
                        understandingCheck: { completed: false, score: 0, attempts: 0 },
                        interactiveDemos: { completed: 0, total: 0 },
                        contentEngagement: { completed: false, timeSpent: 0 }
                    }
                };
                localStorage.setItem('electronTowerProgress', JSON.stringify(progress));
            }
            
            // Track content engagement
            updateProgress('coreRules', 'contentEngagement', 0, 0, 1);
            
            // Update progress display
            updateCoreRulesProgressDisplay();
        }

        function updateCoreRulesProgressDisplay() {
            const savedProgress = localStorage.getItem('electronTowerProgress');
            const progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            const coreRulesProgress = progress.concepts.coreRules;
            
            if (!coreRulesProgress) return;
            
            // Calculate completion based on activities
            const activities = coreRulesProgress.activities;
            let completedCount = 0;
            const totalCount = 4;
            
            // Check each activity
            if (activities.contentEngagement.completed) completedCount++;
            if (activities.understandingCheck.completed) completedCount++;
            if (activities.interactiveDemos.completed > 0) completedCount++;
            if (activities.vocabularyQuiz.completed) completedCount++;
            
            // Update tile progress
            updateTileProgressIndicators();
        }

        // Show detailed content when clicking on Exceptions tile
        function showExceptionsContent() {
            document.getElementById('detailedContent').style.display = 'block';
            document.getElementById('overviewContent').style.display = 'none';
            document.getElementById('coreRulesContent').style.display = 'none';
            document.getElementById('exceptionsContent').style.display = 'block';
            document.getElementById('ionFormationContent').style.display = 'none';
            document.querySelector('.study-tiles').style.display = 'none';
            document.querySelector('.page-title').style.display = 'none';
            
            // Initialize Exceptions progress tracking
            initializeExceptionsProgress();
        }

        // ======= Exceptions Progress Tracking Functions =======

        function initializeExceptionsProgress() {
            // Load saved progress
            const savedProgress = localStorage.getItem('electronTowerProgress');
            let progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            
            // Initialize exceptions concept if not exists
            if (!progress.concepts.exceptions) {
                progress.concepts.exceptions = {
                    completed: false,
                    score: 0,
                    attempts: 0,
                    timeSpent: 0,
                    activities: {
                        vocabularyQuiz: { completed: false, score: 0, attempts: 0 },
                        understandingCheck: { completed: false, score: 0, attempts: 0 },
                        interactiveDemos: { completed: 0, total: 0 },
                        contentEngagement: { completed: false, timeSpent: 0 }
                    }
                };
                localStorage.setItem('electronTowerProgress', JSON.stringify(progress));
            }
            
            // Track content engagement
            updateProgress('exceptions', 'contentEngagement', 0, 0, 1);
            
            // Update progress display
            updateExceptionsProgressDisplay();
        }

        function updateExceptionsProgressDisplay() {
            const savedProgress = localStorage.getItem('electronTowerProgress');
            const progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            const exceptionsProgress = progress.concepts.exceptions;
            
            if (!exceptionsProgress) return;
            
            // Calculate completion based on activities
            const activities = exceptionsProgress.activities;
            let completedCount = 0;
            const totalCount = 4;
            
            // Check each activity
            if (activities.contentEngagement.completed) completedCount++;
            if (activities.understandingCheck.completed) completedCount++;
            if (activities.interactiveDemos.completed > 0) completedCount++;
            if (activities.vocabularyQuiz.completed) completedCount++;
            
            // Update tile progress
            updateTileProgressIndicators();
        }

        // Show detailed content when clicking on Ion Formation tile
        function showIonFormationContent() {
            document.getElementById('detailedContent').style.display = 'block';
            document.getElementById('overviewContent').style.display = 'none';
            document.getElementById('coreRulesContent').style.display = 'none';
            document.getElementById('exceptionsContent').style.display = 'none';
            document.getElementById('ionFormationContent').style.display = 'block';
            document.querySelector('.study-tiles').style.display = 'none';
            document.querySelector('.page-title').style.display = 'none';
            
            // Track content engagement
            updateProgress('ionFormation', 'contentEngagement', 0, 0, 1);
        }

        // Aufbau Sequence Demonstration
        function showFillingOrder() {
            // Complete Aufbau sequence from main app: 1s → 2s → 2p → 3s → 3p → 4s → 3d → 4p → 5s → 4d → 5p → 6s → 4f → 5d → 6p → 7s → 5f → 6d → 7p
            // This follows the main app's electron filling logic exactly
            
            // Track interactive demo completion
            updateProgress('coreRules', 'interactiveDemo', 0, 0, 0);
            
            // Reset all slots first
            resetAufbau();
            
            // Define the complete filling order based on main app ORDER constant
            const fillingSequence = [
                // 1s orbital (2 electrons)
                { slotId: '1s-1', spin: 'up' },
                { slotId: '1s-2', spin: 'down' },
                
                // 2s orbital (2 electrons)  
                { slotId: '2s-1', spin: 'up' },
                { slotId: '2s-2', spin: 'down' },
                
                // 2p orbitals (6 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '2p-1', spin: 'up' },    // 2px first electron
                { slotId: '2p-3', spin: 'up' },    // 2py first electron  
                { slotId: '2p-5', spin: 'up' },    // 2pz first electron
                { slotId: '2p-2', spin: 'down' },  // 2px second electron
                { slotId: '2p-4', spin: 'down' },  // 2py second electron
                { slotId: '2p-6', spin: 'down' },  // 2pz second electron
                
                // 3s orbital (2 electrons)
                { slotId: '3s-1', spin: 'up' },
                { slotId: '3s-2', spin: 'down' },
                
                // 3p orbitals (6 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '3p-1', spin: 'up' },    // 3px first electron
                { slotId: '3p-3', spin: 'up' },    // 3py first electron
                { slotId: '3p-5', spin: 'up' },    // 3pz first electron
                { slotId: '3p-2', spin: 'down' },  // 3px second electron
                { slotId: '3p-4', spin: 'down' },  // 3py second electron
                { slotId: '3p-6', spin: 'down' },  // 3pz second electron
                
                // 4s orbital (2 electrons)
                { slotId: '4s-1', spin: 'up' },
                { slotId: '4s-2', spin: 'down' },
                
                // 3d orbitals (10 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '3d-1', spin: 'up' },    // 3d₁ first electron
                { slotId: '3d-3', spin: 'up' },    // 3d₂ first electron
                { slotId: '3d-5', spin: 'up' },    // 3d₃ first electron
                { slotId: '3d-7', spin: 'up' },    // 3d₄ first electron
                { slotId: '3d-9', spin: 'up' },    // 3d₅ first electron
                { slotId: '3d-2', spin: 'down' },  // 3d₁ second electron
                { slotId: '3d-4', spin: 'down' },  // 3d₂ second electron
                { slotId: '3d-6', spin: 'down' },  // 3d₃ second electron
                { slotId: '3d-8', spin: 'down' },  // 3d₄ second electron
                { slotId: '3d-10', spin: 'down' }, // 3d₅ second electron
                
                // 4p orbitals (6 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '4p-1', spin: 'up' },    // 4px first electron
                { slotId: '4p-3', spin: 'up' },    // 4py first electron
                { slotId: '4p-5', spin: 'up' },    // 4pz first electron
                { slotId: '4p-2', spin: 'down' },  // 4px second electron
                { slotId: '4p-4', spin: 'down' },  // 4py second electron
                { slotId: '4p-6', spin: 'down' },  // 4pz second electron
                
                // 5s orbital (2 electrons)
                { slotId: '5s-1', spin: 'up' },
                { slotId: '5s-2', spin: 'down' },
                
                // 4d orbitals (10 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '4d-1', spin: 'up' },    // 4d₁ first electron
                { slotId: '4d-3', spin: 'up' },    // 4d₂ first electron
                { slotId: '4d-5', spin: 'up' },    // 4d₃ first electron
                { slotId: '4d-7', spin: 'up' },    // 4d₄ first electron
                { slotId: '4d-9', spin: 'up' },    // 4d₅ first electron
                { slotId: '4d-2', spin: 'down' },  // 4d₁ second electron
                { slotId: '4d-4', spin: 'down' },  // 4d₂ second electron
                { slotId: '4d-6', spin: 'down' },  // 4d₃ second electron
                { slotId: '4d-8', spin: 'down' },  // 4d₄ second electron
                { slotId: '4d-10', spin: 'down' }, // 4d₅ second electron
                
                // 5p orbitals (6 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '5p-1', spin: 'up' },    // 5px first electron
                { slotId: '5p-3', spin: 'up' },    // 5py first electron
                { slotId: '5p-5', spin: 'up' },    // 5pz first electron
                { slotId: '5p-2', spin: 'down' },  // 5px second electron
                { slotId: '5p-4', spin: 'down' },  // 5py second electron
                { slotId: '5p-6', spin: 'down' },  // 5pz second electron
                
                // 6s orbital (2 electrons)
                { slotId: '6s-1', spin: 'up' },
                { slotId: '6s-2', spin: 'down' },
                
                // 4f orbitals (14 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '4f-1', spin: 'up' },    // 4f₁ first electron
                { slotId: '4f-3', spin: 'up' },    // 4f₂ first electron
                { slotId: '4f-5', spin: 'up' },    // 4f₃ first electron
                { slotId: '4f-7', spin: 'up' },    // 4f₄ first electron
                { slotId: '4f-9', spin: 'up' },    // 4f₅ first electron
                { slotId: '4f-11', spin: 'up' },   // 4f₆ first electron
                { slotId: '4f-13', spin: 'up' },   // 4f₇ first electron
                { slotId: '4f-2', spin: 'down' },  // 4f₁ second electron
                { slotId: '4f-4', spin: 'down' },  // 4f₂ second electron
                { slotId: '4f-6', spin: 'down' },  // 4f₃ second electron
                { slotId: '4f-8', spin: 'down' },  // 4f₄ second electron
                { slotId: '4f-10', spin: 'down' }, // 4f₅ second electron
                { slotId: '4f-12', spin: 'down' }, // 4f₆ second electron
                { slotId: '4f-14', spin: 'down' }, // 4f₇ second electron
                
                // 5d orbitals (10 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '5d-1', spin: 'up' },    // 5d₁ first electron
                { slotId: '5d-3', spin: 'up' },    // 5d₂ first electron
                { slotId: '5d-5', spin: 'up' },    // 5d₃ first electron
                { slotId: '5d-7', spin: 'up' },    // 5d₄ first electron
                { slotId: '5d-9', spin: 'up' },    // 5d₅ first electron
                { slotId: '5d-2', spin: 'down' },  // 5d₁ second electron
                { slotId: '5d-4', spin: 'down' },  // 5d₂ second electron
                { slotId: '5d-6', spin: 'down' },  // 5d₃ second electron
                { slotId: '5d-8', spin: 'down' },  // 5d₄ second electron
                { slotId: '5d-10', spin: 'down' }, // 5d₅ second electron
                
                // 6p orbitals (6 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '6p-1', spin: 'up' },    // 6px first electron
                { slotId: '6p-3', spin: 'up' },    // 6py first electron
                { slotId: '6p-5', spin: 'up' },    // 6pz first electron
                { slotId: '6p-2', spin: 'down' },  // 6px second electron
                { slotId: '6p-4', spin: 'down' },  // 6py second electron
                { slotId: '6p-6', spin: 'down' },  // 6pz second electron
                
                // 7s orbital (2 electrons)
                { slotId: '7s-1', spin: 'up' },
                { slotId: '7s-2', spin: 'down' },
                
                // 5f orbitals (14 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '5f-1', spin: 'up' },    // 5f₁ first electron
                { slotId: '5f-3', spin: 'up' },    // 5f₂ first electron
                { slotId: '5f-5', spin: 'up' },    // 5f₃ first electron
                { slotId: '5f-7', spin: 'up' },    // 5f₄ first electron
                { slotId: '5f-9', spin: 'up' },    // 5f₅ first electron
                { slotId: '5f-11', spin: 'up' },   // 5f₆ first electron
                { slotId: '5f-13', spin: 'up' },   // 5f₇ first electron
                { slotId: '5f-2', spin: 'down' },  // 5f₁ second electron
                { slotId: '5f-4', spin: 'down' },  // 5f₂ second electron
                { slotId: '5f-6', spin: 'down' },  // 5f₃ second electron
                { slotId: '5f-8', spin: 'down' },  // 5f₄ second electron
                { slotId: '5f-10', spin: 'down' }, // 5f₅ second electron
                { slotId: '5f-12', spin: 'down' }, // 5f₆ second electron
                { slotId: '5f-14', spin: 'down' }, // 5f₇ second electron
                
                // 6d orbitals (10 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '6d-1', spin: 'up' },    // 6d₁ first electron
                { slotId: '6d-3', spin: 'up' },    // 6d₂ first electron
                { slotId: '6d-5', spin: 'up' },    // 6d₃ first electron
                { slotId: '6d-7', spin: 'up' },    // 6d₄ first electron
                { slotId: '6d-9', spin: 'up' },    // 6d₅ first electron
                { slotId: '6d-2', spin: 'down' },  // 6d₁ second electron
                { slotId: '6d-4', spin: 'down' },  // 6d₂ second electron
                { slotId: '6d-6', spin: 'down' },  // 6d₃ second electron
                { slotId: '6d-8', spin: 'down' },  // 6d₄ second electron
                { slotId: '6d-10', spin: 'down' }, // 6d₅ second electron
                
                // 7p orbitals (6 electrons) - Hund's rule: one in each orbital first, then pair
                { slotId: '7p-1', spin: 'up' },    // 7px first electron
                { slotId: '7p-3', spin: 'up' },    // 7py first electron
                { slotId: '7p-5', spin: 'up' },    // 7pz first electron
                { slotId: '7p-2', spin: 'down' },  // 7px second electron
                { slotId: '7p-4', spin: 'down' },  // 7py second electron
                { slotId: '7p-6', spin: 'down' }   // 7pz second electron
            ];
            
            let currentIndex = 0;
            
            const fillNextElectron = () => {
                if (currentIndex >= fillingSequence.length) return;
                
                const { slotId, spin } = fillingSequence[currentIndex];
                const slot = document.querySelector(`[data-orbital="${slotId}"]`);
                
                if (slot) {
                    // Use same electron symbols as main app: "up" → "↑", "down" → "↓"
                    const electronSymbol = spin === 'up' ? '↑' : '↓';
                    
                    // Apply correct classes: 'filled' for up spins, 'paired' for down spins (red)
                    if (spin === 'up') {
                        slot.classList.add('filled');
                    } else {
                        slot.classList.add('paired'); // This makes down spins red
                    }
                    
                    slot.textContent = electronSymbol;
                    slot.style.animation = 'pulse 0.5s ease-in-out';
                    setTimeout(() => {
                        slot.style.animation = '';
                    }, 500);
                }
                
                currentIndex++;
                setTimeout(fillNextElectron, 300); // Faster animation for longer sequence
            };
            
            fillNextElectron();
        }

        function resetAufbau() {
            const slots = document.querySelectorAll('#aufbauBuilding .slot');
            slots.forEach(slot => {
                slot.classList.remove('filled', 'half-filled', 'paired');
                slot.textContent = '';
            });
        }

        // Hund's Rule Demonstration
        function toggleElectron(slot) {
            if (slot.classList.contains('filled')) {
                slot.classList.remove('filled');
                slot.textContent = '';
            } else {
                slot.classList.add('filled');
                slot.textContent = '↑'; // Use main app's "up" spin symbol
                
                // Track interactive demo completion when user interacts
                updateProgress('coreRules', 'interactiveDemo', 0, 0, 0);
            }
        }

        function showElectronDistribution() {
            // Show the correct Hund's rule distribution matching main app logic exactly
            // Main app logic: "Spread out: single-occupy all orbitals first" with same spin, then pair
            
            // Track interactive demo completion
            updateProgress('coreRules', 'interactiveDemo', 0, 0, 0);
            
            // Reset first
            resetHund();
            
            // Define the exact Hund's rule filling sequence for p orbitals
            const hundSequence = [
                // Step 1: Spread out - place one electron in each orbital with same spin (up)
                { slotId: 'p1-1', spin: 'up', delay: 500 },   // 2px first electron (↑)
                { slotId: 'p1-3', spin: 'up', delay: 1000 },  // 2py first electron (↑)
                { slotId: 'p1-5', spin: 'up', delay: 1500 },  // 2pz first electron (↑)
                
                // Step 2: Now pair electrons with opposite spins (down)
                { slotId: 'p1-2', spin: 'down', delay: 2000 }, // 2px second electron (↓)
                { slotId: 'p1-4', spin: 'down', delay: 2500 }, // 2py second electron (↓)
                { slotId: 'p1-6', spin: 'down', delay: 3000 }  // 2pz second electron (↓)
            ];
            
            // Execute the sequence
            hundSequence.forEach(({ slotId, spin, delay }) => {
                setTimeout(() => {
                    const slot = document.querySelector(`[data-orbital="${slotId}"]`);
                    if (slot) {
                        // Use same electron symbols as main app: "up" → "↑", "down" → "↓"
                        const electronSymbol = spin === 'up' ? '↑' : '↓';
                        
                        if (spin === 'up') {
                            slot.classList.add('filled');
                        } else {
                            slot.classList.add('paired');
                        }
                        slot.textContent = electronSymbol;
                        slot.style.animation = 'pulse 0.5s ease-in-out';
                        setTimeout(() => {
                            slot.style.animation = '';
                        }, 500);
                    }
                }, delay);
            });
        }

        function resetHund() {
            const slots = document.querySelectorAll('#hundBuilding .slot');
            slots.forEach(slot => {
                slot.classList.remove('half-filled', 'paired', 'filled');
                slot.textContent = '';
            });
        }

        // Pauli Exclusion Principle
        let electronCount = 0;
        const maxElectrons = 2;

        function addElectron(slot) {
            if (electronCount < maxElectrons) {
                electronCount++;
                updateElectronDisplay();
                
                if (electronCount === 1) {
                    slot.classList.add('filled');
                    slot.textContent = '↑';
                } else if (electronCount === 2) {
                    slot.classList.add('paired');
                    slot.textContent = '↓';
                }
                
                showPauliFeedback();
            }
        }

        function updateElectronDisplay() {
            const countElement = document.getElementById('electronCount');
            if (countElement) {
                countElement.textContent = electronCount;
            }
        }

        function showPauliFeedback() {
            const feedbackElement = document.getElementById('pauliFeedback');
            if (feedbackElement) {
                if (electronCount === 1) {
                    feedbackElement.textContent = '✅ First electron added successfully!';
                    feedbackElement.className = 'pauli-feedback success';
                } else if (electronCount === 2) {
                    feedbackElement.textContent = '✅ Second electron added with opposite spin! Pauli principle satisfied.';
                    feedbackElement.className = 'pauli-feedback success';
                }
            }
        }


        function resetPauli() {
            electronCount = 0;
            updateElectronDisplay();
            const slots = document.querySelectorAll('#pauliBuilding .slot');
            slots.forEach(slot => {
                slot.classList.remove('filled', 'paired');
                slot.textContent = '';
            });
            const feedbackElement = document.getElementById('pauliFeedback');
            if (feedbackElement) {
                feedbackElement.textContent = '';
                feedbackElement.className = 'pauli-feedback';
            }
        }

        // Quiz Functions
        let quizAnswers = {};

        function checkAnswer(questionNum, selectedAnswer) {
            const correctAnswers = {
                1: 'a', // 1s → 2s → 2p → 3s → 3p → 4s → 3d
                2: 'b', // Spread out with parallel spins first
                3: 'b', // 2 electrons max per orbital
                4: 'c', // One electron in each orbital, then pair (px: ↑, py: ↑, pz: ↑↓)
                5: 'b', // They have opposite spins (one ↑ and one ↓)
                6: 'a', // Neon (Ne)
                7: 'b', // 2 unpaired electrons
                8: 'a', // 1s² 2s² 2p² (6 electrons total)
                9: 'b', // Hund's Rule
                10: 'b', // 5 orbitals
                11: 'b' // px: ↑, py: ↑, pz: ↑ (all unpaired)
            };

            quizAnswers[questionNum] = selectedAnswer;
            
            // Update button appearance
            const options = document.querySelectorAll(`.quiz-question:nth-child(${questionNum}) .quiz-option`);
            options.forEach(option => {
                option.classList.remove('correct', 'incorrect');
                const optionLetter = option.textContent.charAt(0).toLowerCase();
                if (optionLetter === correctAnswers[questionNum]) {
                    option.classList.add('correct');
                } else if (optionLetter === selectedAnswer) {
                    option.classList.add('incorrect');
                }
            });

            // Check if all questions are answered
            if (Object.keys(quizAnswers).length === 11) {
                setTimeout(showQuizResults, 1000);
            }
        }

        function showQuizResults() {
            const correctAnswers = {
                1: 'a', // 1s → 2s → 2p → 3s → 3p → 4s → 3d
                2: 'b', // Spread out with parallel spins first
                3: 'b', // 2 electrons max per orbital
                4: 'c', // One electron in each orbital, then pair (px: ↑, py: ↑, pz: ↑↓)
                5: 'b', // They have opposite spins (one ↑ and one ↓)
                6: 'a', // Neon (Ne)
                7: 'b', // 2 unpaired electrons
                8: 'a', // 1s² 2s² 2p² (6 electrons total)
                9: 'b', // Hund's Rule
                10: 'b', // 5 orbitals
                11: 'b' // px: ↑, py: ↑, pz: ↑ (all unpaired)
            };

            let score = 0;
            for (let question in quizAnswers) {
                if (quizAnswers[question] === correctAnswers[question]) {
                    score++;
                }
            }

            const scoreElement = document.getElementById('quizScore');
            const feedbackElement = document.getElementById('quizFeedback');
            const resultsElement = document.getElementById('quizResults');

            if (scoreElement) scoreElement.textContent = score;
            if (feedbackElement) {
                if (score >= 9) {
                    feedbackElement.textContent = '🎉 Excellent! You have mastered the core rules and electron configurations!';
                } else if (score >= 7) {
                    feedbackElement.textContent = '👍 Good work! You understand most concepts. Review the incorrect answers to strengthen your understanding.';
                } else if (score >= 5) {
                    feedbackElement.textContent = '📚 Keep studying! You have a basic understanding but need more practice with the core rules.';
                } else {
                    feedbackElement.textContent = '🔄 Review the material! Focus on the three core rules and orbital notation.';
                }
            }
            if (resultsElement) resultsElement.style.display = 'block';

            // Track progress in localStorage
            updateProgress('coreRules', 'understandingCheck', score, 11);
        }

        // Hide detailed content and return to tiles
        function hideDetailedContent() {
            document.getElementById('detailedContent').style.display = 'none';
            document.querySelector('.study-tiles').style.display = 'grid';
            document.querySelector('.page-title').style.display = 'block';
        }

        // Progress tracking function
        function updateProgress(concept, activityType, score = 0, totalQuestions = 0, timeSpent = 0) {
            const savedProgress = localStorage.getItem('electronTowerProgress');
            const progress = savedProgress ? JSON.parse(savedProgress) : getDefaultProgress();
            
            if (!progress.concepts[concept]) {
                progress.concepts[concept] = { 
                    completed: false, 
                    score: 0, 
                    attempts: 0, 
                    timeSpent: 0,
                    activities: {
                        vocabularyQuiz: { completed: false, score: 0, attempts: 0 },
                        understandingCheck: { completed: false, score: 0, attempts: 0 },
                        interactiveDemos: { completed: 0, total: 0 },
                        contentEngagement: { completed: false, timeSpent: 0 }
                    }
                };
            }
            
            // Update specific activity
            if (activityType === 'vocabularyQuiz') {
                progress.concepts[concept].activities.vocabularyQuiz.score += score;
                progress.concepts[concept].activities.vocabularyQuiz.attempts++;
                progress.concepts[concept].activities.vocabularyQuiz.completed = (score / totalQuestions) >= 0.7;
            } else if (activityType === 'understandingCheck') {
                progress.concepts[concept].activities.understandingCheck.score += score;
                progress.concepts[concept].activities.understandingCheck.attempts++;
                progress.concepts[concept].activities.understandingCheck.completed = (score / totalQuestions) >= 0.7;
            } else if (activityType === 'interactiveDemo') {
                progress.concepts[concept].activities.interactiveDemos.completed++;
            } else if (activityType === 'contentEngagement') {
                progress.concepts[concept].activities.contentEngagement.completed = true;
                progress.concepts[concept].activities.contentEngagement.timeSpent += timeSpent;
            }
            
            // Update overall concept progress
            progress.concepts[concept].score += score;
            progress.concepts[concept].attempts++;
            progress.concepts[concept].timeSpent += timeSpent;
            
            // Calculate overall completion based on weighted activities
            const activities = progress.concepts[concept].activities;
            const vocabWeight = 0.2;
            const understandingWeight = 0.3;
            const interactiveWeight = 0.3;
            const engagementWeight = 0.2;
            
            let completionScore = 0;
            if (activities.vocabularyQuiz.completed) completionScore += vocabWeight;
            if (activities.understandingCheck.completed) completionScore += understandingWeight;
            if (activities.interactiveDemos.completed > 0) completionScore += interactiveWeight;
            if (activities.contentEngagement.completed) completionScore += engagementWeight;
            
            progress.concepts[concept].completed = completionScore >= 0.7; // 70% of activities completed
            
            // Update streak
            const today = new Date().toDateString();
            if (progress.lastStudyDate !== today) {
                progress.streak++;
                progress.lastStudyDate = today;
            }
            
            localStorage.setItem('electronTowerProgress', JSON.stringify(progress));
            
            // Update tile progress indicators
            updateTileProgressIndicators();
            
            // Check for achievements
            checkAchievements(progress);
        }

        function getDefaultProgress() {
            const defaultConcept = {
                completed: false, 
                score: 0, 
                attempts: 0, 
                timeSpent: 0,
                activities: {
                    vocabularyQuiz: { completed: false, score: 0, attempts: 0 },
                    understandingCheck: { completed: false, score: 0, attempts: 0 },
                    interactiveDemos: { completed: 0, total: 0 },
                    contentEngagement: { completed: false, timeSpent: 0 }
                }
            };
            
            return {
                concepts: {
                    overview: { ...defaultConcept },
                    coreRules: { ...defaultConcept },
                    sublevels: { ...defaultConcept },
                    exceptions: { ...defaultConcept },
                    applications: { ...defaultConcept },
                    practice: { ...defaultConcept }
                },
                achievements: [],
                streak: 0,
                lastStudyDate: null,
                totalQuizzes: 0,
                totalTimeSpent: 0
            };
        }

        
        
        // Function to display current progress state
        function showProgressState() {
            const progress = JSON.parse(localStorage.getItem('electronTowerProgress'));
            if (!progress) {
                console.log('No progress data found');
                return;
            }
            
            console.log('📊 Current Progress State:');
            console.log('Overall Progress:', progress);
            
            Object.keys(progress.concepts).forEach(concept => {
                const conceptData = progress.concepts[concept];
                if (conceptData.activities) {
                    const progressData = calculateConceptProgress(conceptData.activities);
                    console.log(`${concept}:`, {
                        percentage: progressData.percentage + '%',
                        activities: `${progressData.activitiesCompleted}/${progressData.totalActivities}`,
                        completed: conceptData.completed,
                        activities: conceptData.activities
                    });
                }
            });
        }
        
        // Simple test to verify basic functionality
        
        // Manual test function to create progress and display it
        
        // Reset all progress function
        function resetAllProgress() {
            console.log('🔄 Resetting all progress...');
            localStorage.removeItem('electronTowerProgress');
            updateTileProgressIndicators();
            console.log('✅ All progress reset! Tiles should now show 0% progress.');
        }
        
        // Quick test function for browser console
        
        
        
        function calculateConceptProgress(activities) {
            const vocabWeight = 0.2;
            const understandingWeight = 0.3;
            const interactiveWeight = 0.3;
            const engagementWeight = 0.2;
            
            let completionScore = 0;
            if (activities.vocabularyQuiz.completed) completionScore += vocabWeight;
            if (activities.understandingCheck.completed) completionScore += understandingWeight;
            if (activities.interactiveDemos.completed > 0) completionScore += interactiveWeight;
            if (activities.contentEngagement.completed) completionScore += engagementWeight;
            
            return {
                percentage: Math.round(completionScore * 100),
                activitiesCompleted: Math.round(completionScore * 4),
                totalActivities: 4
            };
        }

        function checkAchievements(progress) {
            const achievements = progress.achievements || [];
            
            // First quiz achievement
            const totalQuizzes = Object.values(progress.concepts).reduce((sum, c) => sum + c.attempts, 0);
            if (totalQuizzes >= 1 && !achievements.includes('first_quiz')) {
                achievements.push('first_quiz');
                showAchievementNotification('First Steps', 'Complete your first quiz!');
            }
            
            // Perfect score achievement
            const hasPerfectScore = Object.values(progress.concepts).some(c => c.score > 0 && c.score === c.attempts);
            if (hasPerfectScore && !achievements.includes('perfect_score')) {
                achievements.push('perfect_score');
                showAchievementNotification('Perfectionist', 'Get a perfect quiz score!');
            }
            
            // All concepts achievement
            const allCompleted = Object.values(progress.concepts).every(c => c.completed);
            if (allCompleted && !achievements.includes('all_concepts')) {
                achievements.push('all_concepts');
                showAchievementNotification('Electron Expert', 'Complete all concepts!');
            }
            
            progress.achievements = achievements;
            localStorage.setItem('electronTowerProgress', JSON.stringify(progress));
        }

        function showAchievementNotification(title, description) {
            // Create a simple notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--success);
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">🏆 ${title}</div>
                <div style="font-size: 0.9rem;">${description}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function updateTileProgressIndicators() {
            // Get progress data or use default
            const savedProgress = localStorage.getItem('electronTowerProgress');
            let progress;
            
            if (savedProgress) {
                progress = JSON.parse(savedProgress);
            } else {
                // Initialize with default progress structure
                progress = getDefaultProgress();
                localStorage.setItem('electronTowerProgress', JSON.stringify(progress));
            }
            
            // Update Core Rules tile
            const coreRulesProgress = progress.concepts.coreRules;
            if (coreRulesProgress && coreRulesProgress.activities) {
                const activities = coreRulesProgress.activities;
                const vocabWeight = 0.2;
                const understandingWeight = 0.3;
                const interactiveWeight = 0.3;
                const engagementWeight = 0.2;
                
                let completionScore = 0;
                if (activities.vocabularyQuiz.completed) completionScore += vocabWeight;
                if (activities.understandingCheck.completed) completionScore += understandingWeight;
                if (activities.interactiveDemos.completed > 0) completionScore += interactiveWeight;
                if (activities.contentEngagement.completed) completionScore += engagementWeight;
                
                const percentage = Math.round(completionScore * 100);
                const activitiesCompleted = Math.round(completionScore * 4);
                
                const tile = document.querySelector('.study-tile.rules');
                if (tile) {
                    // Remove existing progress div if it exists
                    const existingProgress = tile.querySelector('.tile-progress');
                    if (existingProgress) {
                        existingProgress.remove();
                    }
                    
                    // Create new progress div
                    const progressDiv = document.createElement('div');
                    progressDiv.className = 'tile-progress';
                    progressDiv.style.cssText = `
                        background: ${percentage > 0 ? 'var(--success)' : 'var(--neutral)'};
                        color: white;
                        padding: 5px 10px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        margin-top: 10px;
                        text-align: center;
                    `;
                    progressDiv.innerHTML = `Progress: ${percentage}% (${activitiesCompleted}/4 activities)`;
                    tile.querySelector('.tile-header').appendChild(progressDiv);
                }
            }

            // Update Exceptions tile
            const exceptionsProgress = progress.concepts.exceptions;
            if (exceptionsProgress && exceptionsProgress.activities) {
                const activities = exceptionsProgress.activities;
                const vocabWeight = 0.2;
                const understandingWeight = 0.3;
                const interactiveWeight = 0.3;
                const engagementWeight = 0.2;
                
                let completionScore = 0;
                if (activities.vocabularyQuiz.completed) completionScore += vocabWeight;
                if (activities.understandingCheck.completed) completionScore += understandingWeight;
                if (activities.interactiveDemos.completed > 0) completionScore += interactiveWeight;
                if (activities.contentEngagement.completed) completionScore += engagementWeight;
                
                const percentage = Math.round(completionScore * 100);
                const activitiesCompleted = Math.round(completionScore * 4);
                
                const tile = document.querySelector('.study-tile.exceptions');
                if (tile) {
                    // Remove existing progress div if it exists
                    const existingProgress = tile.querySelector('.tile-progress');
                    if (existingProgress) {
                        existingProgress.remove();
                    }
                    
                    // Create new progress div
                    const progressDiv = document.createElement('div');
                    progressDiv.className = 'tile-progress';
                    progressDiv.style.cssText = `
                        background: ${percentage > 0 ? 'var(--success)' : 'var(--neutral)'};
                        color: white;
                        padding: 5px 10px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        margin-top: 10px;
                        text-align: center;
                    `;
                    progressDiv.innerHTML = `Progress: ${percentage}% (${activitiesCompleted}/4 activities)`;
                    tile.querySelector('.tile-header').appendChild(progressDiv);
                }
            }

            // Update Ion Formation tile
            const ionFormationProgress = progress.concepts.ionFormation;
            if (ionFormationProgress && ionFormationProgress.activities) {
                const activities = ionFormationProgress.activities;
                const vocabWeight = 0.2;
                const understandingWeight = 0.3;
                const interactiveWeight = 0.3;
                const engagementWeight = 0.2;
                
                let completionScore = 0;
                if (activities.vocabularyQuiz.completed) completionScore += vocabWeight;
                if (activities.understandingCheck.completed) completionScore += understandingWeight;
                if (activities.interactiveDemos.completed > 0) completionScore += interactiveWeight;
                if (activities.contentEngagement.completed) completionScore += engagementWeight;
                
                const percentage = Math.round(completionScore * 100);
                const activitiesCompleted = Math.round(completionScore * 4);
                
                const tile = document.querySelector('.study-tile.ions');
                if (tile) {
                    // Remove existing progress div if it exists
                    const existingProgress = tile.querySelector('.tile-progress');
                    if (existingProgress) {
                        existingProgress.remove();
                    }
                    
                    // Create new progress div
                    const progressDiv = document.createElement('div');
                    progressDiv.className = 'tile-progress';
                    progressDiv.style.cssText = `
                        background: ${percentage > 0 ? 'var(--success)' : 'var(--neutral)'};
                        color: white;
                        padding: 5px 10px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        margin-top: 10px;
                        text-align: center;
                    `;
                    progressDiv.innerHTML = `Progress: ${percentage}% (${activitiesCompleted}/4 activities)`;
                    tile.querySelector('.tile-header').appendChild(progressDiv);
                }
            }

            // Update Overview tile
            const overviewProgress = progress.concepts.overview;
            if (overviewProgress && overviewProgress.activities) {
                const activities = overviewProgress.activities;
                
                // Special handling for overview - treat as single activity
                const isCompleted = activities.understandingCheck.completed;
                const percentage = isCompleted ? 100 : 0;
                const activitiesCompleted = isCompleted ? 1 : 0;
                const totalActivities = 1;
                
                const tile = document.querySelector('.study-tile.overview');
                if (tile) {
                    // Remove existing progress div if it exists
                    const existingProgress = tile.querySelector('.tile-progress');
                    if (existingProgress) {
                        existingProgress.remove();
                    }
                    
                    // Create new progress div
                    const progressDiv = document.createElement('div');
                    progressDiv.className = 'tile-progress';
                    
                    let progressClass = 'not-started';
                    if (percentage > 0 && percentage < 100) {
                        progressClass = 'incomplete';
                    } else if (percentage >= 100) {
                        progressClass = 'completed';
                    }
                    
                    progressDiv.classList.add(progressClass);
                    progressDiv.style.cssText = `
                        background: ${percentage >= 100 ? 'var(--success)' : percentage > 0 ? 'var(--warning)' : 'var(--neutral)'};
                        color: white;
                        padding: 5px 10px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        margin-top: 10px;
                        text-align: center;
                    `;
                    progressDiv.innerHTML = `Progress: ${percentage}% (${activitiesCompleted}/${totalActivities} activity)`;
                    tile.querySelector('.tile-header').appendChild(progressDiv);
                }
            }

            // Update Assessment tile
            const assessmentProgress = progress.concepts.assessment;
            if (assessmentProgress && assessmentProgress.activities) {
                const activities = assessmentProgress.activities;
                
                // Calculate completion based on activities (7 total: 4 standard + 3 papers)
                let completedCount = 0;
                const totalCount = 7;
                
                // Check standard activities
                if (activities.contentEngagement.completed) completedCount++;
                if (activities.understandingCheck.completed) completedCount++;
                if (activities.interactiveDemos.completed > 0) completedCount++;
                if (activities.vocabularyQuiz.completed) completedCount++;
                
                // Check paper completions
                if (activities.paper1.completed) completedCount++;
                if (activities.paper2.completed) completedCount++;
                if (activities.paper3.completed) completedCount++;
                
                const percentage = Math.round((completedCount / totalCount) * 100);
                
                const tile = document.querySelector('.study-tile.assessment');
                if (tile) {
                    // Remove existing progress div if it exists
                    const existingProgress = tile.querySelector('.tile-progress');
                    if (existingProgress) {
                        existingProgress.remove();
                    }
                    
                    // Create new progress div
                    const progressDiv = document.createElement('div');
                    progressDiv.className = 'tile-progress';
                    progressDiv.style.cssText = `
                        background: ${percentage > 0 ? 'var(--success)' : 'var(--neutral)'};
                        color: white;
                        padding: 5px 10px;
                        border-radius: 15px;
                        font-size: 0.8rem;
                        margin-top: 10px;
                        text-align: center;
                    `;
                    progressDiv.innerHTML = `Progress: ${percentage}% (${completedCount}/${totalCount} activities)`;
                    tile.querySelector('.tile-header').appendChild(progressDiv);
                }
            }
        }

        // ======= Exceptions Interactive Functions =======

        // Chromium Exception Demonstration
        function showChromiumException() {
            const building = document.getElementById('chromiumBuilding');
            const standardConfig = document.getElementById('chromiumStandard');
            const actualConfig = document.getElementById('chromiumActual');
            
            if (!building) return;

            // Track interactive demo completion
            updateProgress('exceptions', 'interactiveDemo', 0, 0, 0);

            // Clear all slots first
            const slots = building.querySelectorAll('.slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.className = 'slot';
            });

            // Reset configuration displays
            if (standardConfig) standardConfig.textContent = '4s² 3d⁴';
            if (actualConfig) actualConfig.textContent = '4s¹ 3d⁵';

            // Chromium (Z=24) filling sequence following ORDER: 4s comes before 3d
            // Standard: 4s² 3d⁴, Exception: 4s¹ 3d⁵
            const fillingSequence = [
                // Step 1: Fill 4s first (following ORDER array)
                { slotId: '4s1', spin: 'up', delay: 500 },
                { slotId: '4s2', spin: 'down', delay: 1000 },
                
                // Step 2: Fill 3d with 4 electrons (Hund's rule: spread out first)
                { slotId: '3d1', spin: 'up', delay: 1500 },
                { slotId: '3d3', spin: 'up', delay: 2000 },
                { slotId: '3d5', spin: 'up', delay: 2500 },
                { slotId: '3d7', spin: 'up', delay: 3000 }
            ];

            // Show standard configuration first (4s² 3d⁴)
            fillingSequence.forEach((electron) => {
                setTimeout(() => {
                    const slot = building.querySelector(`[data-orbital="${electron.slotId}"]`);
                    if (slot) {
                        slot.textContent = electron.spin === 'up' ? '↑' : '↓';
                        slot.classList.add(electron.spin === 'up' ? 'filled' : 'paired');
                    }
                }, electron.delay);
            });

            // Show exception configuration (4s¹ 3d⁵) after delay
            setTimeout(() => {
                // Move one electron from 4s to 3d
                const slot4s2 = building.querySelector('[data-orbital="4s2"]');
                if (slot4s2) {
                    slot4s2.textContent = '';
                    slot4s2.classList.remove('paired');
                }

                // Add electron to 3d (the 5th d electron)
                const slot3d9 = building.querySelector('[data-orbital="3d9"]');
                if (slot3d9) {
                    slot3d9.textContent = '↑';
                    slot3d9.classList.add('filled');
                }

                // Update configuration display to show the transition
                if (standardConfig) {
                    standardConfig.style.opacity = '0.5';
                    standardConfig.style.textDecoration = 'line-through';
                }
                if (actualConfig) {
                    actualConfig.style.opacity = '1';
                    actualConfig.style.fontWeight = 'bold';
                }
                
                // Track interactive demo completion
                updateProgress('exceptions', 'interactiveDemo');
            }, 4000);
        }

        function resetChromiumDemo() {
            const building = document.getElementById('chromiumBuilding');
            const standardConfig = document.getElementById('chromiumStandard');
            const actualConfig = document.getElementById('chromiumActual');
            
            if (!building) return;

            const slots = building.querySelectorAll('.slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.className = 'slot';
            });

            // Reset configuration displays
            if (standardConfig) {
                standardConfig.textContent = '4s² 3d⁴';
                standardConfig.style.opacity = '1';
                standardConfig.style.textDecoration = 'none';
            }
            if (actualConfig) {
                actualConfig.textContent = '4s¹ 3d⁵';
                actualConfig.style.opacity = '1';
                actualConfig.style.fontWeight = 'normal';
            }
        }

        // Copper Exception Demonstration
        function showCopperException() {
            const building = document.getElementById('copperBuilding');
            const standardConfig = document.getElementById('copperStandard');
            const actualConfig = document.getElementById('copperActual');
            
            if (!building) return;

            // Track interactive demo completion
            updateProgress('exceptions', 'interactiveDemo', 0, 0, 0);

            // Clear all slots first
            const slots = building.querySelectorAll('.slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.className = 'slot';
            });

            // Reset configuration displays
            if (standardConfig) standardConfig.textContent = '4s² 3d⁹';
            if (actualConfig) actualConfig.textContent = '4s¹ 3d¹⁰';

            // Copper (Z=29) filling sequence following ORDER: 4s comes before 3d
            // Standard: 4s² 3d⁹, Exception: 4s¹ 3d¹⁰
            const fillingSequence = [
                // Step 1: Fill 4s first (following ORDER array)
                { slotId: '4s1', spin: 'up', delay: 500 },
                { slotId: '4s2', spin: 'down', delay: 1000 },
                
                // Step 2: Fill 3d with 9 electrons (Hund's rule: spread out first, then pair)
                { slotId: '3d1', spin: 'up', delay: 1500 },
                { slotId: '3d3', spin: 'up', delay: 2000 },
                { slotId: '3d5', spin: 'up', delay: 2500 },
                { slotId: '3d7', spin: 'up', delay: 3000 },
                { slotId: '3d9', spin: 'up', delay: 3500 },
                { slotId: '3d2', spin: 'down', delay: 4000 },
                { slotId: '3d4', spin: 'down', delay: 4500 },
                { slotId: '3d6', spin: 'down', delay: 5000 },
                { slotId: '3d8', spin: 'down', delay: 5500 }
            ];

            // Show standard configuration first (4s² 3d⁹)
            fillingSequence.forEach((electron) => {
                setTimeout(() => {
                    const slot = building.querySelector(`[data-orbital="${electron.slotId}"]`);
                    if (slot) {
                        slot.textContent = electron.spin === 'up' ? '↑' : '↓';
                        slot.classList.add(electron.spin === 'up' ? 'filled' : 'paired');
                    }
                }, electron.delay);
            });

            // Show exception configuration (4s¹ 3d¹⁰) after delay
            setTimeout(() => {
                // Move one electron from 4s to 3d
                const slot4s2 = building.querySelector('[data-orbital="4s2"]');
                if (slot4s2) {
                    slot4s2.textContent = '';
                    slot4s2.classList.remove('paired');
                }

                // Add electron to 3d (fill the last orbital)
                const slot3d10 = building.querySelector('[data-orbital="3d10"]');
                if (slot3d10) {
                    slot3d10.textContent = '↓';
                    slot3d10.classList.add('paired');
                }

                // Update configuration display to show the transition
                if (standardConfig) {
                    standardConfig.style.opacity = '0.5';
                    standardConfig.style.textDecoration = 'line-through';
                }
                if (actualConfig) {
                    actualConfig.style.opacity = '1';
                    actualConfig.style.fontWeight = 'bold';
                }
                
                // Track interactive demo completion
                updateProgress('exceptions', 'interactiveDemo');
            }, 6500);
        }

        function resetCopperDemo() {
            const building = document.getElementById('copperBuilding');
            const standardConfig = document.getElementById('copperStandard');
            const actualConfig = document.getElementById('copperActual');
            
            if (!building) return;

            const slots = building.querySelectorAll('.slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.className = 'slot';
            });

            // Reset configuration displays
            if (standardConfig) {
                standardConfig.textContent = '4s² 3d⁹';
                standardConfig.style.opacity = '1';
                standardConfig.style.textDecoration = 'none';
            }
            if (actualConfig) {
                actualConfig.textContent = '4s¹ 3d¹⁰';
                actualConfig.style.opacity = '1';
                actualConfig.style.fontWeight = 'normal';
            }
        }

        // Exceptions Quiz Functions
        let exceptionQuizAnswers = {};

        function checkExceptionAnswer(questionNum, selectedAnswer) {
            const correctAnswers = {
                1: 'b', // Chromium (Cr)
                2: 'b', // Half-filled and filled subshells provide extra stability
                3: 'b', // [Kr] 5s¹ 4d¹⁰
                4: 'b', // 5 electrons
                5: 'c'  // Calcium (Ca)
            };

            exceptionQuizAnswers[questionNum] = selectedAnswer;
            
            // Update button appearance
            const options = document.querySelectorAll(`.understanding-quiz .quiz-question:nth-child(${questionNum}) .quiz-option`);
            options.forEach(option => {
                option.classList.remove('correct', 'incorrect');
                const optionLetter = option.textContent.charAt(0).toLowerCase();
                if (optionLetter === correctAnswers[questionNum]) {
                    option.classList.add('correct');
                } else if (optionLetter === selectedAnswer) {
                    option.classList.add('incorrect');
                }
            });

            // Check if all questions are answered
            if (Object.keys(exceptionQuizAnswers).length === 5) {
                setTimeout(showExceptionQuizResults, 1000);
            }
        }

        function showExceptionQuizResults() {
            const correctAnswers = {
                1: 'b', // Chromium (Cr)
                2: 'b', // Half-filled and filled subshells provide extra stability
                3: 'b', // [Kr] 5s¹ 4d¹⁰
                4: 'b', // 5 electrons
                5: 'c'  // Calcium (Ca)
            };

            let score = 0;
            for (let question in exceptionQuizAnswers) {
                if (exceptionQuizAnswers[question] === correctAnswers[question]) {
                    score++;
                }
            }

            const scoreElement = document.getElementById('exceptionQuizScore');
            const feedbackElement = document.getElementById('exceptionQuizFeedback');
            const resultsElement = document.getElementById('exceptionQuizResults');

            if (scoreElement) scoreElement.textContent = score;
            if (feedbackElement) {
                if (score >= 4) {
                    feedbackElement.textContent = '🎉 Excellent! You understand electron configuration exceptions!';
                } else if (score >= 3) {
                    feedbackElement.textContent = '👍 Good work! Review the incorrect answers to strengthen your understanding.';
                } else {
                    feedbackElement.textContent = '📚 Keep studying! Review the exception elements and their configurations.';
                }
            }
            if (resultsElement) resultsElement.style.display = 'block';

            // Track progress in localStorage
            updateProgress('exceptions', 'understandingCheck', score, 5);
        }

        function resetExceptionQuiz() {
            exceptionQuizAnswers = {};
            const options = document.querySelectorAll('.understanding-quiz .quiz-option');
            options.forEach(option => {
                option.classList.remove('correct', 'incorrect');
            });
            document.getElementById('exceptionQuizResults').style.display = 'none';
        }

        // Exceptions Vocabulary Quiz
        function checkExceptionsQuiz() {
            const answers = {
                exceptions1: 'b', // An element that breaks standard rules for greater stability
                exceptions2: 'b', // Half-filled 3d subshell provides extra stability
                exceptions3: 'b', // [Ar] 4s¹ 3d¹⁰
                exceptions4: 'b'  // Half-filled and filled subshells
            };
            
            let correct = 0;
            let total = 4;
            
            // Check each question
            for (let i = 1; i <= total; i++) {
                const selected = document.querySelector(`input[name="exceptions${i}"]:checked`);
                if (selected && selected.value === answers[`exceptions${i}`]) {
                    correct++;
                }
            }
            
            // Track vocabulary quiz completion
            updateProgress('exceptions', 'vocabularyQuiz', correct, total, 0);
            
            const resultsDiv = document.getElementById('exceptionsResults');
            const percentage = Math.round((correct / total) * 100);
            
            let resultText = '';
            let resultClass = '';
            
            if (percentage >= 80) {
                resultText = `🎉 Excellent! You got ${correct}/${total} correct (${percentage}%). You have a strong understanding of electron configuration exceptions!`;
                resultClass = 'success';
            } else if (percentage >= 60) {
                resultText = `👍 Good job! You got ${correct}/${total} correct (${percentage}%). Review the exception elements to improve further.`;
                resultClass = 'warning';
            } else {
                resultText = `📚 Keep studying! You got ${correct}/${total} correct (${percentage}%). Review the exception section and try again.`;
                resultClass = 'error';
            }
            
            resultsDiv.innerHTML = resultText;
            resultsDiv.className = `pauli-feedback ${resultClass}`;
            resultsDiv.style.display = 'block';

            // Track progress for vocabulary quiz
            updateProgress('exceptions', 'vocabularyQuiz', correct, total);
        }

        function resetExceptionsQuiz() {
            // Clear all radio button selections
            const radioButtons = document.querySelectorAll('input[name^="exceptions"]');
            radioButtons.forEach(radio => {
                radio.checked = false;
            });
            
            // Hide results
            document.getElementById('exceptionsResults').style.display = 'none';
        }

        // Show objective details when clicked
        function showObjectiveDetails(objective) {
            const objectives = {
                aufbau: {
                    title: "Aufbau Principle",
                    description: "Electrons fill orbitals in order of increasing energy, following the diagonal pattern: 1s → 2s → 2p → 3s → 3p → 4s → 3d → 4p...",
                    examples: ["Hydrogen: 1s¹", "Helium: 1s²", "Carbon: 1s² 2s² 2p²", "Neon: 1s² 2s² 2p⁶"]
                },
                hund: {
                    title: "Hund's Rule",
                    description: "Electrons prefer to occupy separate degenerate orbitals with parallel spins before pairing. This maximizes total spin and follows the principle of maximum multiplicity. Degenerate orbitals have the same energy level.",
                    examples: ["Carbon p-subshell: ↑ ↑ (not ↑↓)", "Nitrogen p-subshell: ↑ ↑ ↑", "Oxygen p-subshell: ↑↓ ↑ ↑"]
                },
                pauli: {
                    title: "Pauli Exclusion Principle",
                    description: "No two electrons in an atom can have identical quantum numbers. Each orbital can hold at most 2 electrons, and they must have opposite spins (↑↓).",
                    examples: ["1s orbital: ↑↓ (2 electrons max, opposite spins)", "2p orbital: ↑↓ (2 electrons max, opposite spins)", "3d orbital: ↑↓ (2 electrons max, opposite spins)"]
                },
                exceptions: {
                    title: "Notable Exceptions",
                    description: "Some elements break the standard rules for stability, particularly transition metals seeking half-filled or filled d-subshells.",
                    examples: ["Chromium: [Ar] 4s¹ 3d⁵ (not 4s² 3d⁴)", "Copper: [Ar] 4s¹ 3d¹⁰ (not 4s² 3d⁹)"]
                },
                ions: {
                    title: "Ion Formation",
                    description: "Atoms gain or lose electrons to form ions. Cations lose electrons (positive charge), anions gain electrons (negative charge).",
                    examples: ["Na⁺: loses 1 electron", "Ca²⁺: loses 2 electrons", "Cl⁻: gains 1 electron", "O²⁻: gains 2 electrons"]
                },
                octet: {
                    title: "Octet Rule",
                    description: "Atoms tend to gain, lose, or share electrons to achieve 8 valence electrons, providing maximum stability.",
                    examples: ["Neon: 8 valence electrons (stable)", "Sodium: 1 valence electron (unstable)", "Chlorine: 7 valence electrons (unstable)"]
                }
            };

            const obj = objectives[objective];
            if (obj) {
                alert(`${obj.title}\n\n${obj.description}\n\nExamples:\n${obj.examples.join('\n')}`);
            }
        }



        // ======= Ion Formation Interactive Functions =======

        // Sodium Cation Formation Demonstration
        function showSodiumCation() {
            const building = document.getElementById('sodiumBuilding');
            const standardConfig = document.getElementById('sodiumStandard');
            const actualConfig = document.getElementById('sodiumActual');
            
            if (!building) return;

            // Reset configuration displays
            if (standardConfig) standardConfig.textContent = 'Na: 1s² 2s² 2p⁶ 3s¹';
            if (actualConfig) actualConfig.textContent = 'Na⁺: 1s² 2s² 2p⁶';

            // Animate electron loss from 3s orbital
            const slot3s1 = document.querySelector('[data-orbital="3s-1"]');
            if (slot3s1) {
                setTimeout(() => {
                    slot3s1.textContent = '';
                    slot3s1.style.opacity = '0.3';
                    
                    // Update configuration display
                    if (standardConfig) {
                        standardConfig.style.opacity = '0.5';
                        standardConfig.style.textDecoration = 'line-through';
                    }
                    if (actualConfig) {
                        actualConfig.style.fontWeight = 'bold';
                        actualConfig.style.color = 'var(--success)';
                    }
                }, 1000);
            }

            // Track interactive demo completion
            setTimeout(() => {
                updateProgress('ionFormation', 'interactiveDemo');
            }, 2000);
        }

        function resetSodiumDemo() {
            const building = document.getElementById('sodiumBuilding');
            const standardConfig = document.getElementById('sodiumStandard');
            const actualConfig = document.getElementById('sodiumActual');
            
            if (!building) return;

            // Reset all slots
            const slots = building.querySelectorAll('.slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.style.opacity = '1';
            });

            // Restore original electron configuration
            document.getElementById('1s1').textContent = '↑';
            document.getElementById('1s2').textContent = '↓';
            document.getElementById('2s1').textContent = '↑';
            document.getElementById('2s2').textContent = '↓';
            document.getElementById('2p1').textContent = '↑';
            document.getElementById('2p2').textContent = '↓';
            document.getElementById('2p3').textContent = '↑';
            document.getElementById('2p4').textContent = '↓';
            document.getElementById('2p5').textContent = '↑';
            document.getElementById('2p6').textContent = '↓';
            document.getElementById('3s1').textContent = '↑';

            // Reset configuration display styling
            if (standardConfig) {
                standardConfig.textContent = 'Na: 1s² 2s² 2p⁶ 3s¹';
                standardConfig.style.opacity = '1';
                standardConfig.style.textDecoration = 'none';
            }
            if (actualConfig) {
                actualConfig.textContent = 'Na⁺: 1s² 2s² 2p⁶';
                actualConfig.style.fontWeight = 'normal';
                actualConfig.style.color = 'inherit';
            }
        }

        // Chlorine Anion Formation Demonstration
        function showChlorineAnion() {
            const building = document.getElementById('chlorineBuilding');
            const standardConfig = document.getElementById('chlorineStandard');
            const actualConfig = document.getElementById('chlorineActual');
            
            if (!building) return;

            // Reset configuration displays
            if (standardConfig) standardConfig.textContent = 'Cl: [Ne] 3s² 3p⁵';
            if (actualConfig) actualConfig.textContent = 'Cl⁻: [Ne] 3s² 3p⁶';

            // Animate electron gain in 3p orbital
            const slot3p6 = document.getElementById('cl3p6');
            if (slot3p6) {
                setTimeout(() => {
                    slot3p6.textContent = '↓';
                    slot3p6.style.color = 'var(--success)';
                    slot3p6.style.fontWeight = 'bold';
                    
                    // Update configuration display
                    if (standardConfig) {
                        standardConfig.style.opacity = '0.5';
                        standardConfig.style.textDecoration = 'line-through';
                    }
                    if (actualConfig) {
                        actualConfig.style.fontWeight = 'bold';
                        actualConfig.style.color = 'var(--success)';
                    }
                }, 1000);
            }

            // Track interactive demo completion
            setTimeout(() => {
                updateProgress('ionFormation', 'interactiveDemo');
            }, 2000);
        }

        function resetChlorineDemo() {
            const building = document.getElementById('chlorineBuilding');
            const standardConfig = document.getElementById('chlorineStandard');
            const actualConfig = document.getElementById('chlorineActual');
            
            if (!building) return;

            // Reset all slots
            const slots = building.querySelectorAll('.slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.style.opacity = '1';
                slot.style.color = 'inherit';
                slot.style.fontWeight = 'normal';
            });

            // Restore original electron configuration
            document.getElementById('cl1s1').textContent = '↑';
            document.getElementById('cl1s2').textContent = '↓';
            document.getElementById('cl2s1').textContent = '↑';
            document.getElementById('cl2s2').textContent = '↓';
            document.getElementById('cl2p1').textContent = '↑';
            document.getElementById('cl2p2').textContent = '↓';
            document.getElementById('cl2p3').textContent = '↑';
            document.getElementById('cl2p4').textContent = '↓';
            document.getElementById('cl2p5').textContent = '↑';
            document.getElementById('cl2p6').textContent = '↓';
            document.getElementById('cl3s1').textContent = '↑';
            document.getElementById('cl3s2').textContent = '↓';
            document.getElementById('cl3p1').textContent = '↑';
            document.getElementById('cl3p2').textContent = '↓';
            document.getElementById('cl3p3').textContent = '↑';
            document.getElementById('cl3p4').textContent = '↓';
            document.getElementById('cl3p5').textContent = '↑';

            // Reset configuration display styling
            if (standardConfig) {
                standardConfig.textContent = 'Cl: [Ne] 3s² 3p⁵';
                standardConfig.style.opacity = '1';
                standardConfig.style.textDecoration = 'none';
            }
            if (actualConfig) {
                actualConfig.textContent = 'Cl⁻: [Ne] 3s² 3p⁶';
                actualConfig.style.fontWeight = 'normal';
                actualConfig.style.color = 'inherit';
            }
        }

        // Iron Cation Formation Demonstration
        function showIronCation() {
            const building = document.getElementById('ironBuilding');
            const standardConfig = document.getElementById('ironStandard');
            const actualConfig = document.getElementById('ironActual');
            
            if (!building) return;

            // Reset configuration displays
            if (standardConfig) standardConfig.textContent = 'Fe: [Ar] 4s² 3d⁶';
            if (actualConfig) actualConfig.textContent = 'Fe²⁺: [Ar] 3d⁶';

            // Animate electron loss from 4s orbital (transition metals lose s electrons first)
            const slot4s1 = document.getElementById('fe4s1');
            const slot4s2 = document.getElementById('fe4s2');
            
            if (slot4s1 && slot4s2) {
                setTimeout(() => {
                    slot4s1.textContent = '';
                    slot4s1.style.opacity = '0.3';
                }, 1000);
                
                setTimeout(() => {
                    slot4s2.textContent = '';
                    slot4s2.style.opacity = '0.3';
                    
                    // Update configuration display
                    if (standardConfig) {
                        standardConfig.style.opacity = '0.5';
                        standardConfig.style.textDecoration = 'line-through';
                    }
                    if (actualConfig) {
                        actualConfig.style.fontWeight = 'bold';
                        actualConfig.style.color = 'var(--success)';
                    }
                }, 1500);
            }

            // Track interactive demo completion
            setTimeout(() => {
                updateProgress('ionFormation', 'interactiveDemo');
            }, 3000);
        }

        function resetIronDemo() {
            const building = document.getElementById('ironBuilding');
            const standardConfig = document.getElementById('ironStandard');
            const actualConfig = document.getElementById('ironActual');
            
            if (!building) return;

            // Reset all slots
            const slots = building.querySelectorAll('.slot');
            slots.forEach(slot => {
                slot.textContent = '';
                slot.style.opacity = '1';
            });

            // Restore original electron configuration
            document.getElementById('fe1s1').textContent = '↑';
            document.getElementById('fe1s2').textContent = '↓';
            document.getElementById('fe2s1').textContent = '↑';
            document.getElementById('fe2s2').textContent = '↓';
            document.getElementById('fe2p1').textContent = '↑';
            document.getElementById('fe2p2').textContent = '↓';
            document.getElementById('fe2p3').textContent = '↑';
            document.getElementById('fe2p4').textContent = '↓';
            document.getElementById('fe2p5').textContent = '↑';
            document.getElementById('fe2p6').textContent = '↓';
            document.getElementById('fe3s1').textContent = '↑';
            document.getElementById('fe3s2').textContent = '↓';
            document.getElementById('fe3p1').textContent = '↑';
            document.getElementById('fe3p2').textContent = '↓';
            document.getElementById('fe3p3').textContent = '↑';
            document.getElementById('fe3p4').textContent = '↓';
            document.getElementById('fe3p5').textContent = '↑';
            document.getElementById('fe3p6').textContent = '↓';
            document.getElementById('fe3d1').textContent = '↑';
            document.getElementById('fe3d2').textContent = '↓';
            document.getElementById('fe3d3').textContent = '↑';
            document.getElementById('fe3d4').textContent = '↓';
            document.getElementById('fe3d5').textContent = '↑';
            document.getElementById('fe3d6').textContent = '↓';
            document.getElementById('fe4s1').textContent = '↑';
            document.getElementById('fe4s2').textContent = '↓';

            // Reset configuration display styling
            if (standardConfig) {
                standardConfig.textContent = 'Fe: [Ar] 4s² 3d⁶';
                standardConfig.style.opacity = '1';
                standardConfig.style.textDecoration = 'none';
            }
            if (actualConfig) {
                actualConfig.textContent = 'Fe²⁺: [Ar] 3d⁶';
                actualConfig.style.fontWeight = 'normal';
                actualConfig.style.color = 'inherit';
            }
        }

        // Ion Formation Vocabulary Quiz
        function checkIonVocabQuiz() {
            const answers = {
                q1: 'b', // Cation is positively charged
                q2: 'b', // Transition metals lose s electrons first, then d
                q3: 'b', // Ionic radius decreases for cations
                q4: 'b', // Oxygen forms -2 anion
                q5: 'b'  // Na⁺ has configuration 1s² 2s² 2p⁶
            };

            let correct = 0;
            let total = Object.keys(answers).length;

            Object.keys(answers).forEach(question => {
                const selected = document.querySelector(`input[name="${question}"]:checked`);
                if (selected && selected.value === answers[question]) {
                    correct++;
                }
            });

            const resultsDiv = document.getElementById('ionVocabResults');
            const percentage = Math.round((correct / total) * 100);
            
            resultsDiv.innerHTML = `
                <div class="quiz-score">
                    <h4>Quiz Results</h4>
                    <p>You scored ${correct}/${total} (${percentage}%)</p>
                    <p>${percentage >= 70 ? '🎉 Great job! You understand ion formation vocabulary!' : '📚 Review the vocabulary section and try again.'}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';

            // Track progress
            updateProgress('ionFormation', 'vocabularyQuiz', correct, total);
        }

        function resetIonVocabQuiz() {
            const inputs = document.querySelectorAll('#ionVocabQuiz input[type="radio"]');
            inputs.forEach(input => input.checked = false);
            document.getElementById('ionVocabResults').style.display = 'none';
        }

        // Ion Formation Understanding Check
        function checkIonUnderstanding() {
            const answers = {
                uq1: 'b', // Mg²⁺ (loses 2 electrons)
                uq2: 'c', // Both Cl⁻ and K⁺ are isoelectronic with Ar
                uq3: 'b'  // Fe³⁺: [Ar] 3d⁵ (loses 2 from 4s, 1 from 3d)
            };

            let correct = 0;
            let total = Object.keys(answers).length;

            Object.keys(answers).forEach(question => {
                const selected = document.querySelector(`input[name="${question}"]:checked`);
                if (selected && selected.value === answers[question]) {
                    correct++;
                }
            });

            const resultsDiv = document.getElementById('ionUnderstandingResults');
            const percentage = Math.round((correct / total) * 100);
            
            resultsDiv.innerHTML = `
                <div class="understanding-score">
                    <h4>Understanding Check Results</h4>
                    <p>You scored ${correct}/${total} (${percentage}%)</p>
                    <p>${percentage >= 70 ? '🎉 Excellent! You understand ion formation concepts!' : '📚 Review the concepts and try again.'}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';

            // Track progress
            updateProgress('ionFormation', 'understandingCheck', correct, total);
        }

        function resetIonUnderstanding() {
            const inputs = document.querySelectorAll('#ionUnderstandingCheck input[type="radio"]');
            inputs.forEach(input => input.checked = false);
            document.getElementById('ionUnderstandingResults').style.display = 'none';
        }

        // Update tile click handlers to show detailed content
        document.addEventListener('DOMContentLoaded', function() {
            // Update the Overview tile to show detailed content
            const overviewTile = document.querySelector('.study-tile.overview');
            if (overviewTile) {
                const learnMoreBtn = overviewTile.querySelector('.tile-btn');
                if (learnMoreBtn) {
                    learnMoreBtn.onclick = showOverviewContent;
                }
            }

        });

        // ======= Drawing Tools Functions =======
        let drawingCanvas, drawingCtx;
        let isDrawing = false;
        let currentTool = 'pencil';
        let drawingHistory = [];
        let historyIndex = -1;
        let lastX = 0, lastY = 0;

        // Initialize drawing canvas when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeDrawingCanvas();
            setupDrawingEventListeners();
        });

        function initializeDrawingCanvas() {
            drawingCanvas = document.getElementById('drawingCanvas');
            if (!drawingCanvas) return;
            
            drawingCtx = drawingCanvas.getContext('2d');
            drawingCtx.lineCap = 'round';
            drawingCtx.lineJoin = 'round';
            
            // Set initial drawing state
            updateDrawingSettings();
            
            // Save initial blank state
            saveDrawingState();
        }

        function setupDrawingEventListeners() {
            if (!drawingCanvas) return;

            // Mouse events
            drawingCanvas.addEventListener('mousedown', startDrawing);
            drawingCanvas.addEventListener('mousemove', draw);
            drawingCanvas.addEventListener('mouseup', stopDrawing);
            drawingCanvas.addEventListener('mouseout', stopDrawing);

            // Touch events for tablets
            drawingCanvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            drawingCanvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            drawingCanvas.addEventListener('touchend', handleTouchEnd, { passive: false });

            // Tool selection
            document.querySelectorAll('.drawing-tool[data-tool]').forEach(tool => {
                tool.addEventListener('click', function() {
                    selectDrawingTool(this.dataset.tool);
                });
            });

            // Brush size slider
            const brushSizeSlider = document.getElementById('brushSize');
            if (brushSizeSlider) {
                brushSizeSlider.addEventListener('input', function() {
                    document.getElementById('brushSizeValue').textContent = this.value;
                    updateDrawingSettings();
                });
            }

            // Color picker
            const brushColorPicker = document.getElementById('brushColor');
            if (brushColorPicker) {
                brushColorPicker.addEventListener('change', updateDrawingSettings);
            }
        }

        function startDrawing(e) {
            isDrawing = true;
            const rect = drawingCanvas.getBoundingClientRect();
            lastX = e.clientX - rect.left;
            lastY = e.clientY - rect.top;
            
            if (currentTool === 'pencil' || currentTool === 'brush') {
                drawingCtx.beginPath();
                drawingCtx.moveTo(lastX, lastY);
            }
            
            updateDrawingStatus('Drawing...');
        }

        function draw(e) {
            if (!isDrawing) return;
            
            const rect = drawingCanvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;

            if (currentTool === 'eraser') {
                drawingCtx.globalCompositeOperation = 'destination-out';
                drawingCtx.lineTo(currentX, currentY);
                drawingCtx.stroke();
                drawingCtx.globalCompositeOperation = 'source-over';
            } else {
                // Normal drawing mode (pencil, brush, shapes)
                drawingCtx.lineTo(currentX, currentY);
                drawingCtx.stroke();
            }

            lastX = currentX;
            lastY = currentY;
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                saveDrawingState();
                updateDrawingStatus('Drawing saved. Ready to continue.');
            }
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = drawingCanvas.getBoundingClientRect();
            lastX = touch.clientX - rect.left;
            lastY = touch.clientY - rect.top;
            startDrawing({ clientX: touch.clientX, clientY: touch.clientY });
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!isDrawing) return;
            const touch = e.touches[0];
            draw({ clientX: touch.clientX, clientY: touch.clientY });
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            stopDrawing();
        }

        function selectDrawingTool(tool) {
            currentTool = tool;
            
            // Update active tool
            document.querySelectorAll('.drawing-tool[data-tool]').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
            
            // Update cursor
            drawingCanvas.style.cursor = tool === 'eraser' ? 'grab' : 'crosshair';
            
            updateDrawingStatus(`Selected: ${tool.charAt(0).toUpperCase() + tool.slice(1)} tool`);
        }

        function updateDrawingSettings() {
            if (!drawingCtx) return;
            
            const brushSize = document.getElementById('brushSize')?.value || 3;
            const brushColor = document.getElementById('brushColor')?.value || '#000000';
            
            drawingCtx.lineWidth = brushSize;
            drawingCtx.strokeStyle = brushColor;
        }

        function saveDrawingState() {
            if (!drawingCanvas) return;
            
            const imageData = drawingCtx.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height);
            
            // Remove any states after current index (for redo functionality)
            drawingHistory = drawingHistory.slice(0, historyIndex + 1);
            
            // Add new state
            drawingHistory.push(imageData);
            historyIndex++;
            
            // Limit history size
            if (drawingHistory.length > 20) {
                drawingHistory.shift();
                historyIndex--;
            }
        }

        function undoDrawing() {
            if (historyIndex > 0) {
                historyIndex--;
                drawingCtx.putImageData(drawingHistory[historyIndex], 0, 0);
                updateDrawingStatus('Undone. Ready to continue.');
            } else {
                updateDrawingStatus('Nothing to undo.');
            }
        }

        function redoDrawing() {
            if (historyIndex < drawingHistory.length - 1) {
                historyIndex++;
                drawingCtx.putImageData(drawingHistory[historyIndex], 0, 0);
                updateDrawingStatus('Redone. Ready to continue.');
            } else {
                updateDrawingStatus('Nothing to redo.');
            }
        }

        function clearDrawing() {
            if (confirm('Are you sure you want to clear the drawing?')) {
                drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
                saveDrawingState();
                updateDrawingStatus('Drawing cleared. Ready to start fresh.');
            }
        }

        function saveDrawing() {
            if (!drawingCanvas) return;
            
            const link = document.createElement('a');
            link.download = `electron-configuration-drawing-${Date.now()}.png`;
            link.href = drawingCanvas.toDataURL();
            link.click();
            
            updateDrawingStatus('Drawing saved as PNG file!');
        }

        function loadTemplate(templateType) {
            if (!drawingCanvas || !drawingCtx) return;
            
            // Clear current drawing
            drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
            
            // Draw template based on type
            switch(templateType) {
                case 'orbital':
                    drawOrbitalTemplate();
                    break;
                case 'lewis':
                    drawLewisTemplate();
                    break;
                case 'molecular':
                    drawMolecularTemplate();
                    break;
                case 'energy':
                    drawEnergyTemplate();
                    break;
            }
            
            saveDrawingState();
            updateDrawingStatus(`Loaded ${templateType} template. Ready to customize.`);
        }

        function drawOrbitalTemplate() {
            drawingCtx.strokeStyle = '#333';
            drawingCtx.lineWidth = 2;
            
            // Draw orbital boxes
            const startX = 50;
            const startY = 100;
            const boxWidth = 40;
            const boxHeight = 30;
            const spacing = 50;
            
            // 1s orbital
            drawingCtx.strokeRect(startX, startY, boxWidth, boxHeight);
            drawingCtx.fillText('1s', startX + 15, startY + 20);
            
            // 2s orbital
            drawingCtx.strokeRect(startX + spacing, startY, boxWidth, boxHeight);
            drawingCtx.fillText('2s', startX + spacing + 15, startY + 20);
            
            // 2p orbitals
            for (let i = 0; i < 3; i++) {
                const x = startX + (spacing * 2) + (i * spacing);
                drawingCtx.strokeRect(x, startY, boxWidth, boxHeight);
                drawingCtx.fillText(`2p${i === 0 ? 'x' : i === 1 ? 'y' : 'z'}`, x + 10, startY + 20);
            }
            
            // Add labels
            drawingCtx.font = '16px Arial';
            drawingCtx.fillText('Orbital Diagram Template', startX, startY - 20);
            drawingCtx.fillText('Draw electrons as arrows ↑ or ↓', startX, startY + 80);
        }

        function drawLewisTemplate() {
            drawingCtx.strokeStyle = '#333';
            drawingCtx.lineWidth = 2;
            
            const centerX = drawingCanvas.width / 2;
            const centerY = drawingCanvas.height / 2;
            const radius = 60;
            
            // Draw central atom
            drawingCtx.beginPath();
            drawingCtx.arc(centerX, centerY, 20, 0, 2 * Math.PI);
            drawingCtx.stroke();
            drawingCtx.fillText('X', centerX - 5, centerY + 5);
            
            // Draw bonding positions
            const positions = [
                { x: centerX, y: centerY - radius },
                { x: centerX + radius, y: centerY },
                { x: centerX, y: centerY + radius },
                { x: centerX - radius, y: centerY }
            ];
            
            positions.forEach(pos => {
                drawingCtx.beginPath();
                drawingCtx.arc(pos.x, pos.y, 15, 0, 2 * Math.PI);
                drawingCtx.stroke();
                drawingCtx.fillText('Y', pos.x - 5, pos.y + 5);
                
                // Draw bond line
                drawingCtx.beginPath();
                drawingCtx.moveTo(centerX, centerY);
                drawingCtx.lineTo(pos.x, pos.y);
                drawingCtx.stroke();
            });
            
            drawingCtx.font = '16px Arial';
            drawingCtx.fillText('Lewis Structure Template', centerX - 80, centerY - 100);
        }

        function drawMolecularTemplate() {
            drawingCtx.strokeStyle = '#333';
            drawingCtx.lineWidth = 2;
            
            const centerX = drawingCanvas.width / 2;
            const centerY = drawingCanvas.height / 2;
            
            // Draw 3D molecular shape template
            drawingCtx.font = '16px Arial';
            drawingCtx.fillText('Molecular Geometry Template', centerX - 100, 50);
            drawingCtx.fillText('Draw 3D molecular shapes here', centerX - 100, 80);
            
            // Draw coordinate axes
            drawingCtx.strokeStyle = '#999';
            drawingCtx.beginPath();
            drawingCtx.moveTo(centerX - 100, centerY);
            drawingCtx.lineTo(centerX + 100, centerY);
            drawingCtx.stroke();
            
            drawingCtx.beginPath();
            drawingCtx.moveTo(centerX, centerY - 100);
            drawingCtx.lineTo(centerX, centerY + 100);
            drawingCtx.stroke();
        }

        function drawEnergyTemplate() {
            drawingCtx.strokeStyle = '#333';
            drawingCtx.lineWidth = 2;
            
            const startX = 50;
            const startY = 50;
            const levelHeight = 40;
            const levelWidth = 200;
            
            // Draw energy levels
            const levels = ['4p', '3d', '4s', '3p', '3s', '2p', '2s', '1s'];
            
            levels.forEach((level, index) => {
                const y = startY + (index * levelHeight);
                drawingCtx.strokeRect(startX, y, levelWidth, levelHeight - 5);
                drawingCtx.fillText(level, startX + 10, y + 20);
            });
            
            drawingCtx.font = '16px Arial';
            drawingCtx.fillText('Energy Level Diagram Template', startX, startY - 20);
        }

        function updateDrawingStatus(message) {
            const statusElement = document.getElementById('drawingStatus');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        // ======= Electron Configuration Functions =======
        const electronConfigurations = {
            'H': '1s¹', 'He': '1s²',
            'Li': '1s²2s¹', 'Be': '1s²2s²', 'B': '1s²2s²2p¹', 'C': '1s²2s²2p²', 'N': '1s²2s²2p³', 'O': '1s²2s²2p⁴', 'F': '1s²2s²2p⁵', 'Ne': '1s²2s²2p⁶',
            'Na': '1s²2s²2p⁶3s¹', 'Mg': '1s²2s²2p⁶3s²', 'Al': '1s²2s²2p⁶3s²3p¹', 'Si': '1s²2s²2p⁶3s²3p²', 'P': '1s²2s²2p⁶3s²3p³', 'S': '1s²2s²2p⁶3s²3p⁴', 'Cl': '1s²2s²2p⁶3s²3p⁵', 'Ar': '1s²2s²2p⁶3s²3p⁶',
            'K': '1s²2s²2p⁶3s²3p⁶4s¹', 'Ca': '1s²2s²2p⁶3s²3p⁶4s²',
            'Sc': '1s²2s²2p⁶3s²3p⁶4s²3d¹', 'Ti': '1s²2s²2p⁶3s²3p⁶4s²3d²', 'V': '1s²2s²2p⁶3s²3p⁶4s²3d³', 'Cr': '1s²2s²2p⁶3s²3p⁶4s¹3d⁵', 'Mn': '1s²2s²2p⁶3s²3p⁶4s²3d⁵',
            'Fe': '1s²2s²2p⁶3s²3p⁶4s²3d⁶', 'Co': '1s²2s²2p⁶3s²3p⁶4s²3d⁷', 'Ni': '1s²2s²2p⁶3s²3p⁶4s²3d⁸', 'Cu': '1s²2s²2p⁶3s²3p⁶4s¹3d¹⁰', 'Zn': '1s²2s²2p⁶3s²3p⁶4s²3d¹⁰'
        };

        function generateElectronConfig() {
            const elementInput = document.getElementById('elementInput');
            const previewElement = document.getElementById('electronConfigPreview');
            
            if (!elementInput || !previewElement) return;
            
            const input = elementInput.value.trim();
            let config = '';
            
            // Try to find configuration
            if (electronConfigurations[input]) {
                config = electronConfigurations[input];
            } else {
                // Try case-insensitive search
                const upperInput = input.toUpperCase();
                if (electronConfigurations[upperInput]) {
                    config = electronConfigurations[upperInput];
                } else {
                    // Try atomic number
                    const atomicNumber = parseInt(input);
                    if (atomicNumber && atomicNumber >= 1 && atomicNumber <= 30) {
                        const elementSymbols = Object.keys(electronConfigurations);
                        if (elementSymbols[atomicNumber - 1]) {
                            config = electronConfigurations[elementSymbols[atomicNumber - 1]];
                        }
                    }
                }
            }
            
            if (config) {
                previewElement.innerHTML = `$${config}$`;
                // Re-render MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise([previewElement]);
                }
            } else {
                previewElement.innerHTML = 'Element not found. Please try a valid element symbol, name, or atomic number (1-30).';
            }
        }

        function updateConfigPreview() {
            const customConfig = document.getElementById('customConfig');
            const previewElement = document.getElementById('customConfigPreview');
            
            if (!customConfig || !previewElement) return;
            
            const config = customConfig.value.trim();
            if (config) {
                previewElement.innerHTML = `$${config}$`;
                // Re-render MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise([previewElement]);
                }
            } else {
                previewElement.innerHTML = 'Your configuration will appear here with proper formatting';
            }
        }

        // ======= Question-Specific Drawing Functions =======
        let questionDrawingCanvases = {};
        let questionDrawingContexts = {};
        let questionDrawingHistory = {};
        let questionHistoryIndex = {};

        function initializeQuestionDrawingCanvas(questionId) {
            const canvas = document.querySelector(`[data-question="${questionId}"]`);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            
            questionDrawingCanvases[questionId] = canvas;
            questionDrawingContexts[questionId] = ctx;
            questionDrawingHistory[questionId] = [];
            questionHistoryIndex[questionId] = -1;
            
            // Set up event listeners for this specific canvas
            setupQuestionDrawingEventListeners(questionId);
            
            // Save initial blank state
            saveQuestionDrawingState(questionId);
        }

        function setupQuestionDrawingEventListeners(questionId) {
            const canvas = questionDrawingCanvases[questionId];
            if (!canvas) return;

            // Mouse events
            canvas.addEventListener('mousedown', (e) => startQuestionDrawing(e, questionId));
            canvas.addEventListener('mousemove', (e) => drawQuestionDrawing(e, questionId));
            canvas.addEventListener('mouseup', () => stopQuestionDrawing(questionId));
            canvas.addEventListener('mouseout', () => stopQuestionDrawing(questionId));

            // Touch events for tablets
            canvas.addEventListener('touchstart', (e) => handleQuestionTouchStart(e, questionId), { passive: false });
            canvas.addEventListener('touchmove', (e) => handleQuestionTouchMove(e, questionId), { passive: false });
            canvas.addEventListener('touchend', (e) => handleQuestionTouchEnd(e, questionId), { passive: false });

            // Tool selection for this question
            const container = canvas.closest('.drawing-tools-container');
            if (container) {
                container.querySelectorAll('.drawing-tool[data-tool]').forEach(tool => {
                    tool.addEventListener('click', function() {
                        selectQuestionDrawingTool(this.dataset.tool, questionId);
                    });
                });

                // Brush size slider
                const brushSizeSlider = container.querySelector('.brushSize');
                if (brushSizeSlider) {
                    brushSizeSlider.addEventListener('input', function() {
                        const valueSpan = container.querySelector('.brushSizeValue');
                        if (valueSpan) valueSpan.textContent = this.value;
                        updateQuestionDrawingSettings(questionId);
                    });
                }

                // Color picker
                const brushColorPicker = container.querySelector('.brushColor');
                if (brushColorPicker) {
                    brushColorPicker.addEventListener('change', () => updateQuestionDrawingSettings(questionId));
                }
            }
        }

        function startQuestionDrawing(e, questionId) {
            const canvas = questionDrawingCanvases[questionId];
            const ctx = questionDrawingContexts[questionId];
            if (!canvas || !ctx) return;
            
            const rect = canvas.getBoundingClientRect();
            const lastX = e.clientX - rect.left;
            const lastY = e.clientY - rect.top;
            
            canvas.dataset.lastX = lastX;
            canvas.dataset.lastY = lastY;
            canvas.dataset.isDrawing = 'true';
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
        }

        function drawQuestionDrawing(e, questionId) {
            const canvas = questionDrawingCanvases[questionId];
            const ctx = questionDrawingContexts[questionId];
            if (!canvas || !ctx || canvas.dataset.isDrawing !== 'true') return;
            
            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            const lastX = parseFloat(canvas.dataset.lastX);
            const lastY = parseFloat(canvas.dataset.lastY);

            // Get current tool from the drawing toolbar
            const container = canvas.closest('.drawing-tools-container');
            const activeTool = container?.querySelector('.drawing-tool.active')?.dataset.tool || 'pencil';
            
            if (activeTool === 'eraser') {
                // Eraser mode
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                ctx.globalCompositeOperation = 'source-over';
            } else {
                // Normal drawing mode
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
            }

            canvas.dataset.lastX = currentX;
            canvas.dataset.lastY = currentY;
        }

        function stopQuestionDrawing(questionId) {
            const canvas = questionDrawingCanvases[questionId];
            if (!canvas) return;
            
            if (canvas.dataset.isDrawing === 'true') {
                canvas.dataset.isDrawing = 'false';
                saveQuestionDrawingState(questionId);
            }
        }

        function handleQuestionTouchStart(e, questionId) {
            e.preventDefault();
            const touch = e.touches[0];
            const syntheticEvent = {
                clientX: touch.clientX,
                clientY: touch.clientY
            };
            startQuestionDrawing(syntheticEvent, questionId);
        }

        function handleQuestionTouchMove(e, questionId) {
            e.preventDefault();
            const touch = e.touches[0];
            const syntheticEvent = {
                clientX: touch.clientX,
                clientY: touch.clientY
            };
            drawQuestionDrawing(syntheticEvent, questionId);
        }

        function handleQuestionTouchEnd(e, questionId) {
            e.preventDefault();
            stopQuestionDrawing(questionId);
        }

        function selectQuestionDrawingTool(tool, questionId) {
            const container = questionDrawingCanvases[questionId]?.closest('.drawing-tools-container');
            if (!container) return;
            
            // Update active tool
            container.querySelectorAll('.drawing-tool[data-tool]').forEach(t => {
                t.classList.remove('active');
            });
            container.querySelector(`[data-tool="${tool}"]`).classList.add('active');
            
            // Update cursor
            const canvas = questionDrawingCanvases[questionId];
            if (canvas) {
                canvas.style.cursor = tool === 'eraser' ? 'grab' : 'crosshair';
            }
        }

        function updateQuestionDrawingSettings(questionId) {
            const ctx = questionDrawingContexts[questionId];
            const container = questionDrawingCanvases[questionId]?.closest('.drawing-tools-container');
            if (!ctx || !container) return;
            
            const brushSize = container.querySelector('.brushSize')?.value || 3;
            const brushColor = container.querySelector('.brushColor')?.value || '#000000';
            
            ctx.lineWidth = brushSize;
            ctx.strokeStyle = brushColor;
        }

        function saveQuestionDrawingState(questionId) {
            const canvas = questionDrawingCanvases[questionId];
            const ctx = questionDrawingContexts[questionId];
            if (!canvas || !ctx) return;
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            // Remove any states after current index
            questionDrawingHistory[questionId] = questionDrawingHistory[questionId].slice(0, questionHistoryIndex[questionId] + 1);
            
            // Add new state
            questionDrawingHistory[questionId].push(imageData);
            questionHistoryIndex[questionId]++;
            
            // Limit history size
            if (questionDrawingHistory[questionId].length > 20) {
                questionDrawingHistory[questionId].shift();
                questionHistoryIndex[questionId]--;
            }
        }

        function saveQuestionDrawing(questionId) {
            const canvas = questionDrawingCanvases[questionId];
            if (!canvas) return;
            
            const link = document.createElement('a');
            link.download = `question-${questionId}-drawing-${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function undoQuestionDrawing(questionId) {
            const ctx = questionDrawingContexts[questionId];
            if (!ctx || questionHistoryIndex[questionId] <= 0) return;
            
            questionHistoryIndex[questionId]--;
            ctx.putImageData(questionDrawingHistory[questionId][questionHistoryIndex[questionId]], 0, 0);
        }

        function clearQuestionDrawing(questionId) {
            const canvas = questionDrawingCanvases[questionId];
            const ctx = questionDrawingContexts[questionId];
            if (!canvas || !ctx) return;
            
            if (confirm('Are you sure you want to clear the drawing?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                saveQuestionDrawingState(questionId);
            }
        }

        function loadOrbitalTemplate(questionId) {
            const canvas = questionDrawingCanvases[questionId];
            const ctx = questionDrawingContexts[questionId];
            if (!canvas || !ctx) return;
            
            // Clear current drawing
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw orbital template
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.font = '14px Arial';
            
            const startX = 50;
            const startY = 80;
            const boxWidth = 40;
            const boxHeight = 30;
            const spacing = 50;
            
            // Draw 2p orbitals for nitrogen/oxygen
            for (let i = 0; i < 3; i++) {
                const x = startX + (i * spacing);
                ctx.strokeRect(x, startY, boxWidth, boxHeight);
                ctx.fillText(`2p${i === 0 ? 'x' : i === 1 ? 'y' : 'z'}`, x + 10, startY + 20);
            }
            
            ctx.fillText('Orbital Diagram Template - Add electrons as arrows ↑ or ↓', startX, startY - 20);
            
            saveQuestionDrawingState(questionId);
        }

        // ======= Enhanced Math Input Functions =======
        let currentMathInput = null;
        let mathMode = 'normal'; // 'normal', 'superscript', 'subscript'

        function insertMathSymbol(symbol, targetId) {
            const input = document.getElementById(targetId);
            if (!input) return;
            
            // Set current input for focus tracking
            currentMathInput = targetId;
            
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const value = input.value;
            
            // Handle special symbols
            if (symbol === '←') {
                // Backspace
                if (start > 0) {
                    input.value = value.substring(0, start - 1) + value.substring(end);
                    input.setSelectionRange(start - 1, start - 1);
                }
            } else {
                // Convert symbol based on current mode
                let processedSymbol = symbol;
                if (mathMode === 'superscript' && /[0-9]/.test(symbol)) {
                    processedSymbol = convertToSuperscript(symbol);
                } else if (mathMode === 'subscript' && /[0-9]/.test(symbol)) {
                    processedSymbol = convertToSubscript(symbol);
                }
                
                // Insert symbol
                input.value = value.substring(0, start) + processedSymbol + value.substring(end);
                input.setSelectionRange(start + processedSymbol.length, start + processedSymbol.length);
            }
            
            // Focus the input
            input.focus();
        }

        function convertToSuperscript(text) {
            const superscriptMap = {
                '0': '⁰', '1': '¹', '2': '²', '3': '³', '4': '⁴',
                '5': '⁵', '6': '⁶', '7': '⁷', '8': '⁸', '9': '⁹'
            };
            return text.split('').map(char => superscriptMap[char] || char).join('');
        }

        function convertToSubscript(text) {
            const subscriptMap = {
                '0': '₀', '1': '₁', '2': '₂', '3': '₃', '4': '₄',
                '5': '₅', '6': '₆', '7': '₇', '8': '₈', '9': '₉'
            };
            return text.split('').map(char => subscriptMap[char] || char).join('');
        }

        function setMathMode(mode, targetId) {
            mathMode = mode;
            currentMathInput = targetId;
            
            // Update button states for this specific question
            const questionId = targetId;
            document.querySelectorAll(`[id$="Mode_${questionId}"]`).forEach(btn => {
                btn.classList.remove('active');
            });
            
            const modeButton = document.getElementById(mode + 'Mode_' + questionId);
            if (modeButton) {
                modeButton.classList.add('active');
            }
            
            // Focus the target input
            const input = document.getElementById(targetId);
            if (input) {
                input.focus();
            }
        }

        function clearMathInput(targetId) {
            const input = document.getElementById(targetId);
            if (input) {
                input.value = '';
                input.focus();
            }
        }

        function toggleMathToolbar(targetId) {
            const toolbar = document.getElementById('toolbar_' + targetId);
            const toggle = document.getElementById('toggle_' + targetId);
            
            if (toolbar && toggle) {
                toolbar.classList.toggle('visible');
                toggle.classList.toggle('active');
                
                // Update toggle text
                const isVisible = toolbar.classList.contains('visible');
                const textSpan = toggle.querySelector('span:nth-child(2)');
                if (textSpan) {
                    textSpan.textContent = isVisible ? 'Hide Math Tools' : 'Math Tools';
                }
            }
        }

        function clearCurrentInput() {
            if (currentMathInput) {
                const input = document.getElementById(currentMathInput);
                if (input) {
                    input.value = '';
                    const overlayId = currentMathInput.replace('Config', 'Overlay');
                    const previewId = currentMathInput.replace('Config', 'Preview');
                    updateMathInput(currentMathInput, overlayId, previewId);
                }
            }
        }

        function updateMathInput(inputId, overlayId, previewId) {
            const input = document.getElementById(inputId);
            const overlay = document.getElementById(overlayId);
            const preview = document.getElementById(previewId);
            
            if (!input || !overlay || !preview) return;
            
            const value = input.value;
            
            // Update overlay with formatted text
            overlay.textContent = value || input.placeholder;
            
            // Update preview with MathJax
            if (value.trim()) {
                preview.innerHTML = `$${value}$`;
                // Re-render MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise([preview]);
                }
            } else {
                preview.innerHTML = 'Your configuration will appear here';
            }
        }

        function handleMathInputKeydown(event, inputId, overlayId, previewId) {
            currentMathInput = inputId;
            
            // Handle special key combinations
            if (event.ctrlKey || event.metaKey) {
                switch(event.key) {
                    case 'v':
                        // Paste - update after paste
                        setTimeout(() => updateMathInput(inputId, overlayId, previewId), 10);
                        break;
                    case 'z':
                        event.preventDefault();
                        // Undo functionality could be added here
                        break;
                }
            }
            
            // Update display on any key press
            setTimeout(() => updateMathInput(inputId, overlayId, previewId), 10);
        }

        function updateConfigPreview(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            if (!input || !preview) return;
            
            const config = input.value.trim();
            if (config) {
                preview.innerHTML = `$${config}$`;
                // Re-render MathJax
                if (window.MathJax) {
                    MathJax.typesetPromise([preview]);
                }
            } else {
                preview.innerHTML = 'Your configuration will appear here';
            }
        }

        function generateConfigForElement(element, inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;
            
            const config = electronConfigurations[element];
            if (config) {
                input.value = config;
                updateConfigPreview(inputId, inputId.replace('Config', 'Preview'));
            }
        }

        function clearConfigInputs(inputIds) {
            inputIds.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.value = '';
                    updateConfigPreview(id, id.replace('Config', 'Preview'));
                }
            });
        }

        function clearCustomConfig() {
            const input = document.getElementById('customConfig');
            if (input) {
                input.value = '';
                updateMathInput('customConfig', 'customConfigOverlay', 'customConfigPreview');
            }
        }

        // Initialize question drawing canvases when they become visible
        function initializeVisibleQuestionCanvases() {
            document.querySelectorAll('.question-drawing-canvas').forEach(canvas => {
                const questionId = canvas.dataset.question;
                if (questionId && !questionDrawingCanvases[questionId]) {
                    initializeQuestionDrawingCanvas(questionId);
                }
            });
        }

        // Call initialization when assessment content is shown
        const originalShowAssessmentContent = showAssessmentContent;
        showAssessmentContent = function() {
            originalShowAssessmentContent();
            setTimeout(initializeVisibleQuestionCanvases, 100);
        };

        // ======= Vocabulary Functions =======
        function showVocabDefinition(term) {
            const definitions = {
                aufbau: {
                    title: "Aufbau Principle",
                    definition: "Electrons fill orbitals in order of increasing energy, following the diagonal pattern: 1s → 2s → 2p → 3s → 3p → 4s → 3d → 4p...",
                    examples: ["Hydrogen: 1s¹", "Helium: 1s²", "Carbon: 1s² 2s² 2p²", "Neon: 1s² 2s² 2p⁶"]
                },
                hund: {
                    title: "Hund's Rule",
                    definition: "Electrons prefer to occupy separate degenerate orbitals with parallel spins before pairing. This maximizes total spin and follows the principle of maximum multiplicity.",
                    examples: ["Carbon p-subshell: ↑ ↑ (not ↑↓)", "Nitrogen p-subshell: ↑ ↑ ↑", "Oxygen p-subshell: ↑↓ ↑ ↑"]
                },
                pauli: {
                    title: "Pauli Exclusion Principle",
                    definition: "No two electrons in an atom can have identical quantum numbers. Each orbital can hold at most 2 electrons, and they must have opposite spins (↑↓).",
                    examples: ["1s orbital: ↑↓ (2 electrons max, opposite spins)", "2p orbital: ↑↓ (2 electrons max, opposite spins)", "3d orbital: ↑↓ (2 electrons max, opposite spins)"]
                },
                degenerate: {
                    title: "Degenerate Orbitals",
                    definition: "Orbitals that have the same energy level. For example, the three 2p orbitals (2px, 2py, 2pz) are degenerate.",
                    examples: ["2p orbitals: 2px, 2py, 2pz", "3d orbitals: 3dxy, 3dxz, 3dyz, 3dx²-y², 3dz²"]
                },
                valence: {
                    title: "Valence Electrons",
                    definition: "Electrons in the outermost shell of an atom. These electrons are involved in chemical bonding and determine the element's chemical properties.",
                    examples: ["Carbon: 4 valence electrons (2s² 2p²)", "Oxygen: 6 valence electrons (2s² 2p⁴)", "Sodium: 1 valence electron (3s¹)"]
                },
                octet: {
                    title: "Octet Rule",
                    definition: "Atoms tend to gain, lose, or share electrons to achieve 8 valence electrons, providing maximum stability similar to noble gases.",
                    examples: ["Neon: 8 valence electrons (stable)", "Sodium: 1 valence electron (unstable)", "Chlorine: 7 valence electrons (unstable)"]
                }
            };

            const vocab = definitions[term];
            if (vocab) {
                alert(`${vocab.title}\n\nDefinition: ${vocab.definition}\n\nExamples:\n${vocab.examples.join('\n')}`);
            }
        }

        // Vocabulary Quiz Functions
        function checkVocabQuiz() {
            const answers = {
                vocab1: 'b', // Hund's Rule: electrons spread out before pairing
                vocab2: 'b', // Degenerate orbitals have same energy
                vocab3: 'b', // Pauli Exclusion: max 2 electrons with opposite spins
                vocab4: 'b', // Unpaired electrons: single electrons with same spin
                vocab5: 'b', // Lone pair: pair of electrons not involved in bonding
                vocab6: 'b', // Aufbau Principle: electrons fill lowest energy first
                vocab7: 'b', // p subshell: 3 orbitals
                vocab8: 'b'  // Ground state: lowest energy configuration
            };
            
            let correct = 0;
            let total = 8;
            
            // Check each question
            for (let i = 1; i <= total; i++) {
                const selected = document.querySelector(`input[name="vocab${i}"]:checked`);
                if (selected && selected.value === answers[`vocab${i}`]) {
                    correct++;
                }
            }
            
            const resultsDiv = document.getElementById('vocabResults');
            const percentage = Math.round((correct / total) * 100);
            
            let resultText = '';
            let resultClass = '';
            
            if (percentage >= 80) {
                resultText = `🎉 Excellent! You got ${correct}/${total} correct (${percentage}%). You have a strong understanding of chemistry vocabulary!`;
                resultClass = 'success';
            } else if (percentage >= 60) {
                resultText = `👍 Good job! You got ${correct}/${total} correct (${percentage}%). Review the vocabulary cards to improve further.`;
                resultClass = 'warning';
            } else {
                resultText = `📚 Keep studying! You got ${correct}/${total} correct (${percentage}%). Review the vocabulary section and try again.`;
                resultClass = 'error';
            }
            
            resultsDiv.innerHTML = resultText;
            resultsDiv.className = `pauli-feedback ${resultClass}`;
            resultsDiv.style.display = 'block';

            // Track progress for vocabulary quiz
            updateProgress('coreRules', 'vocabularyQuiz', correct, total);
        }

        function resetVocabQuiz() {
            // Clear all radio button selections
            const radioButtons = document.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.checked = false;
            });
            
            // Hide results
            const resultsDiv = document.getElementById('vocabResults');
            resultsDiv.style.display = 'none';
        }

        // ======= Practice Interactive Functions =======

        // Show Practice content when clicking on Practice tile
        function showPracticeContent(section = 'atom-builder') {
            try {
                // Hide all other content sections
                document.getElementById('detailedContent').style.display = 'block';
                document.getElementById('practiceContent').style.display = 'block';
                document.getElementById('assessmentContent').style.display = 'none';
                document.getElementById('overviewContent').style.display = 'none';
                document.getElementById('coreRulesContent').style.display = 'none';
                document.getElementById('exceptionsContent').style.display = 'none';
                document.getElementById('ionFormationContent').style.display = 'none';
                document.querySelector('.study-tiles').style.display = 'none';
                
                // Show the specified practice section
                showPracticeSection(section);
                
                // Scroll to top
                window.scrollTo(0, 0);
            } catch (error) {
                console.error('Error showing practice content:', error);
            }
        }

        // Show specific practice section
        function showPracticeSection(section) {
            // Hide all practice sections
            const sections = ['atomBuilderSection', 'guidedProblemsSection', 'interactiveQuizSection', 'simulationsSection', 'practiceProblemsSection'];
            sections.forEach(sec => {
                const element = document.getElementById(sec);
                if (element) element.style.display = 'none';
            });

            // Show selected section
            const sectionMap = {
                'atom-builder': 'atomBuilderSection',
                'guided-problems': 'guidedProblemsSection',
                'interactive-quiz': 'interactiveQuizSection',
                'simulations': 'simulationsSection',
                'practice-problems': 'practiceProblemsSection'
            };

            const targetSection = sectionMap[section];
            if (targetSection) {
                const element = document.getElementById(targetSection);
                if (element) element.style.display = 'block';
            }

            // Update navigation button states
            const navButtons = ['atomBuilderBtn', 'guidedProblemsBtn', 'interactiveQuizBtn', 'simulationsBtn', 'practiceProblemsBtn'];
            navButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.classList.remove('primary');
                    btn.classList.add('secondary');
                }
            });

            // Highlight active button
            const activeButtonMap = {
                'atom-builder': 'atomBuilderBtn',
                'guided-problems': 'guidedProblemsBtn',
                'interactive-quiz': 'interactiveQuizBtn',
                'simulations': 'simulationsBtn',
                'practice-problems': 'practiceProblemsBtn'
            };

            const activeBtnId = activeButtonMap[section];
            if (activeBtnId) {
                const activeBtn = document.getElementById(activeBtnId);
                if (activeBtn) {
                    activeBtn.classList.remove('secondary');
                    activeBtn.classList.add('primary');
                }
            }
        }

        // ======= Atom Builder Functions =======

        // Element data for atom builder
        const elementData = {
            'H': { name: 'Hydrogen', atomicNumber: 1, config: '1s¹', orbital: '1s: ↑' },
            'He': { name: 'Helium', atomicNumber: 2, config: '1s²', orbital: '1s: ↑↓' },
            'Li': { name: 'Lithium', atomicNumber: 3, config: '1s² 2s¹', orbital: '1s: ↑↓\n2s: ↑' },
            'Be': { name: 'Beryllium', atomicNumber: 4, config: '1s² 2s²', orbital: '1s: ↑↓\n2s: ↑↓' },
            'B': { name: 'Boron', atomicNumber: 5, config: '1s² 2s² 2p¹', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑' },
            'C': { name: 'Carbon', atomicNumber: 6, config: '1s² 2s² 2p²', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑ ↑' },
            'N': { name: 'Nitrogen', atomicNumber: 7, config: '1s² 2s² 2p³', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑ ↑ ↑' },
            'O': { name: 'Oxygen', atomicNumber: 8, config: '1s² 2s² 2p⁴', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑ ↑' },
            'F': { name: 'Fluorine', atomicNumber: 9, config: '1s² 2s² 2p⁵', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑' },
            'Ne': { name: 'Neon', atomicNumber: 10, config: '1s² 2s² 2p⁶', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓' },
            'Na': { name: 'Sodium', atomicNumber: 11, config: '1s² 2s² 2p⁶ 3s¹', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑' },
            'Mg': { name: 'Magnesium', atomicNumber: 12, config: '1s² 2s² 2p⁶ 3s²', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓' },
            'Al': { name: 'Aluminum', atomicNumber: 13, config: '1s² 2s² 2p⁶ 3s² 3p¹', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑' },
            'Si': { name: 'Silicon', atomicNumber: 14, config: '1s² 2s² 2p⁶ 3s² 3p²', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑ ↑' },
            'P': { name: 'Phosphorus', atomicNumber: 15, config: '1s² 2s² 2p⁶ 3s² 3p³', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑ ↑ ↑' },
            'S': { name: 'Sulfur', atomicNumber: 16, config: '1s² 2s² 2p⁶ 3s² 3p⁴', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑↓ ↑ ↑' },
            'Cl': { name: 'Chlorine', atomicNumber: 17, config: '1s² 2s² 2p⁶ 3s² 3p⁵', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑↓ ↑↓ ↑' },
            'Ar': { name: 'Argon', atomicNumber: 18, config: '1s² 2s² 2p⁶ 3s² 3p⁶', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑↓ ↑↓ ↑↓' },
            'K': { name: 'Potassium', atomicNumber: 19, config: '1s² 2s² 2p⁶ 3s² 3p⁶ 4s¹', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑↓ ↑↓ ↑↓\n4s: ↑' },
            'Ca': { name: 'Calcium', atomicNumber: 20, config: '1s² 2s² 2p⁶ 3s² 3p⁶ 4s²', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑↓ ↑↓ ↑↓\n4s: ↑↓' },
            'Cr': { name: 'Chromium', atomicNumber: 24, config: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s¹', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑↓ ↑↓ ↑↓\n3d: ↑ ↑ ↑ ↑ ↑\n4s: ↑' },
            'Cu': { name: 'Copper', atomicNumber: 29, config: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s¹', orbital: '1s: ↑↓\n2s: ↑↓\n2p: ↑↓ ↑↓ ↑↓\n3s: ↑↓\n3p: ↑↓ ↑↓ ↑↓\n3d: ↑↓ ↑↓ ↑↓ ↑↓ ↑↓\n4s: ↑' }
        };

        function loadElement() {
            const select = document.getElementById('elementSelect');
            const element = select.value;
            
            if (element && elementData[element]) {
                const data = elementData[element];
                document.getElementById('elementName').textContent = `${data.name} (${element})`;
                document.getElementById('elementDetails').textContent = `Atomic Number: ${data.atomicNumber}`;
                document.getElementById('configDisplay').textContent = data.config;
                document.getElementById('orbitalDisplay').textContent = data.orbital;
            } else {
                document.getElementById('elementName').textContent = 'Select an element to begin';
                document.getElementById('elementDetails').textContent = 'Choose from the dropdown above';
                document.getElementById('configDisplay').textContent = 'Select an element to see its configuration';
                document.getElementById('orbitalDisplay').textContent = 'Select an element to see its orbital diagram';
            }
        }

        function resetAtomBuilder() {
            document.getElementById('elementSelect').value = '';
            loadElement();
        }

        function showAtomBuilderHint() {
            const select = document.getElementById('elementSelect');
            const element = select.value;
            
            if (!element) {
                alert('Please select an element first!');
                return;
            }
            
            const hints = {
                'H': 'Hydrogen has only 1 electron, so it goes in the 1s orbital.',
                'He': 'Helium has 2 electrons, filling the 1s orbital completely.',
                'Li': 'Lithium has 3 electrons. After filling 1s², the third electron goes to 2s.',
                'C': 'Carbon follows Hund\'s rule - electrons fill orbitals singly before pairing.',
                'Cr': 'Chromium is an exception - it promotes one 4s electron to 3d for stability.',
                'Cu': 'Copper is an exception - it promotes one 4s electron to 3d for stability.'
            };
            
            alert(hints[element] || 'Remember: Follow the Aufbau principle, Hund\'s rule, and Pauli exclusion principle!');
        }

        function checkAtomBuilder() {
            const select = document.getElementById('elementSelect');
            const element = select.value;
            
            if (!element) {
                alert('Please select an element first!');
                return;
            }
            
            alert('Great! You\'ve successfully built the ' + elementData[element].name + ' atom. The electron configuration and orbital diagram are displayed correctly!');
        }

        // ======= Guided Problems Functions =======

        const problemData = {
            'basic-1': {
                title: 'Basic: Carbon Electron Configuration',
                text: 'Write the electron configuration for Carbon (C, Z=6).',
                steps: [
                    'Step 1: Identify the atomic number (Z=6)',
                    'Step 2: Fill orbitals in order of increasing energy',
                    'Step 3: 1s² (2 electrons)',
                    'Step 4: 2s² (2 electrons)',
                    'Step 5: 2p² (2 electrons)',
                    'Final Answer: 1s² 2s² 2p²'
                ],
                answer: '1s² 2s² 2p²'
            },
            'basic-2': {
                title: 'Basic: Sodium Electron Configuration',
                text: 'Write the electron configuration for Sodium (Na, Z=11).',
                steps: [
                    'Step 1: Identify the atomic number (Z=11)',
                    'Step 2: Fill orbitals in order of increasing energy',
                    'Step 3: 1s² (2 electrons)',
                    'Step 4: 2s² (2 electrons)',
                    'Step 5: 2p⁶ (6 electrons)',
                    'Step 6: 3s¹ (1 electron)',
                    'Final Answer: 1s² 2s² 2p⁶ 3s¹'
                ],
                answer: '1s² 2s² 2p⁶ 3s¹'
            },
            'intermediate-1': {
                title: 'Intermediate: Iron Electron Configuration',
                text: 'Write the electron configuration for Iron (Fe, Z=26).',
                steps: [
                    'Step 1: Identify the atomic number (Z=26)',
                    'Step 2: Fill orbitals in order of increasing energy',
                    'Step 3: 1s² 2s² 2p⁶ 3s² 3p⁶ (18 electrons)',
                    'Step 4: 4s² (2 electrons)',
                    'Step 5: 3d⁶ (6 electrons)',
                    'Final Answer: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁶ 4s²'
                ],
                answer: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁶ 4s²'
            },
            'intermediate-2': {
                title: 'Intermediate: Bromine Electron Configuration',
                text: 'Write the electron configuration for Bromine (Br, Z=35).',
                steps: [
                    'Step 1: Identify the atomic number (Z=35)',
                    'Step 2: Fill orbitals in order of increasing energy',
                    'Step 3: 1s² 2s² 2p⁶ 3s² 3p⁶ (18 electrons)',
                    'Step 4: 4s² (2 electrons)',
                    'Step 5: 3d¹⁰ (10 electrons)',
                    'Step 6: 4p⁵ (5 electrons)',
                    'Final Answer: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p⁵'
                ],
                answer: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p⁵'
            },
            'advanced-1': {
                title: 'Advanced: Chromium Exception',
                text: 'Write the electron configuration for Chromium (Cr, Z=24). Note: This is an exception!',
                steps: [
                    'Step 1: Identify the atomic number (Z=24)',
                    'Step 2: Expected: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁴ 4s²',
                    'Step 3: Exception: One 4s electron promotes to 3d',
                    'Step 4: Result: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s¹',
                    'Final Answer: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s¹'
                ],
                answer: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s¹'
            },
            'advanced-2': {
                title: 'Advanced: Copper Exception',
                text: 'Write the electron configuration for Copper (Cu, Z=29). Note: This is an exception!',
                steps: [
                    'Step 1: Identify the atomic number (Z=29)',
                    'Step 2: Expected: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁹ 4s²',
                    'Step 3: Exception: One 4s electron promotes to 3d',
                    'Step 4: Result: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s¹',
                    'Final Answer: 1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s¹'
                ],
                answer: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s¹'
            },
            'ion-1': {
                title: 'Ion Formation: Sodium Ion',
                text: 'Write the electron configuration for Na⁺ (sodium ion).',
                steps: [
                    'Step 1: Start with Na: 1s² 2s² 2p⁶ 3s¹',
                    'Step 2: Na⁺ loses 1 electron (the 3s electron)',
                    'Step 3: Remove the 3s¹ electron',
                    'Final Answer: 1s² 2s² 2p⁶'
                ],
                answer: '1s² 2s² 2p⁶'
            },
            'ion-2': {
                title: 'Ion Formation: Chloride Ion',
                text: 'Write the electron configuration for Cl⁻ (chloride ion).',
                steps: [
                    'Step 1: Start with Cl: 1s² 2s² 2p⁶ 3s² 3p⁵',
                    'Step 2: Cl⁻ gains 1 electron (goes to 3p)',
                    'Step 3: Add one electron to 3p⁵ to make 3p⁶',
                    'Final Answer: 1s² 2s² 2p⁶ 3s² 3p⁶'
                ],
                answer: '1s² 2s² 2p⁶ 3s² 3p⁶'
            }
        };

        let currentStep = 0;
        let currentProblem = null;

        function loadProblem() {
            const select = document.getElementById('problemSelect');
            const problemId = select.value;
            
            if (problemId && problemData[problemId]) {
                currentProblem = problemData[problemId];
                currentStep = 0;
                
                document.getElementById('problemDisplay').style.display = 'block';
                document.getElementById('problemTitle').textContent = currentProblem.title;
                document.getElementById('problemText').textContent = currentProblem.text;
                document.getElementById('studentAnswer').value = '';
                document.getElementById('feedback').style.display = 'none';
                
                updateSolutionSteps();
            } else {
                document.getElementById('problemDisplay').style.display = 'none';
            }
        }

        function updateSolutionSteps() {
            const stepsDiv = document.getElementById('solutionSteps');
            if (currentProblem && currentStep < currentProblem.steps.length) {
                stepsDiv.innerHTML = `
                    <h4 style="color: var(--accent); margin-bottom: 15px;">Solution Steps:</h4>
                    <div style="background: var(--dark); border: 2px solid var(--accent); border-radius: 10px; padding: 15px;">
                        <p style="color: var(--light); margin: 0; font-weight: 600;">${currentProblem.steps[currentStep]}</p>
                    </div>
                `;
            } else {
                stepsDiv.innerHTML = '<p style="color: var(--light);">All steps completed!</p>';
            }
        }

        function showNextStep() {
            if (currentProblem && currentStep < currentProblem.steps.length - 1) {
                currentStep++;
                updateSolutionSteps();
            } else {
                alert('You\'ve reached the final step!');
            }
        }

        function showHint() {
            if (currentProblem) {
                const hints = {
                    'basic-1': 'Remember: Fill orbitals in order of increasing energy (1s, 2s, 2p, 3s, 3p, 4s, 3d, 4p...)',
                    'basic-2': 'Sodium has 11 electrons. After filling the first two shells, the 11th electron goes to 3s.',
                    'intermediate-1': 'Iron has 26 electrons. Fill 4s before 3d, but remember the order when writing the configuration.',
                    'intermediate-2': 'Bromine has 35 electrons. The 4p orbital can hold up to 6 electrons.',
                    'advanced-1': 'Chromium is an exception! It promotes one 4s electron to 3d for extra stability.',
                    'advanced-2': 'Copper is an exception! It promotes one 4s electron to 3d for extra stability.',
                    'ion-1': 'Cations lose electrons. Which electron would sodium lose first?',
                    'ion-2': 'Anions gain electrons. Where would chlorine add an electron?'
                };
                alert(hints[currentProblem.title.split(':')[0].toLowerCase().replace(' ', '-')] || 'Think about the Aufbau principle and electron filling order!');
            }
        }

        function checkAnswer() {
            const studentAnswer = document.getElementById('studentAnswer').value.trim();
            const feedbackDiv = document.getElementById('feedback');
            
            if (!studentAnswer) {
                alert('Please enter your answer first!');
                return;
            }
            
            if (currentProblem) {
                const isCorrect = studentAnswer.toLowerCase() === currentProblem.answer.toLowerCase();
                
                feedbackDiv.innerHTML = `
                    <div style="background: ${isCorrect ? 'var(--success)' : 'var(--error)'}; color: var(--dark); padding: 15px; border-radius: 8px;">
                        <h4 style="margin: 0 0 10px 0;">${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h4>
                        <p style="margin: 0 0 10px 0;">${isCorrect ? 'Great job! You got it right!' : 'Not quite right. Let\'s try again.'}</p>
                        <p style="margin: 0; font-weight: 600;">Correct answer: ${currentProblem.answer}</p>
                    </div>
                `;
                feedbackDiv.style.display = 'block';
            }
        }

        function showFullSolution() {
            if (currentProblem) {
                alert(`Full Solution:\n\n${currentProblem.steps.join('\n')}`);
            }
        }

        // ======= Interactive Quiz Functions =======

        const quizQuestions = [
            {
                type: 'multiple-choice',
                question: 'What is the electron configuration for Carbon (C, Z=6)?',
                options: ['1s² 2s² 2p²', '1s² 2s² 2p⁴', '1s² 2s² 2p⁶', '1s² 2s² 2p¹'],
                correct: 0
            },
            {
                type: 'multiple-choice',
                question: 'Which principle states that electrons fill orbitals singly before pairing?',
                options: ['Aufbau Principle', 'Hund\'s Rule', 'Pauli Exclusion Principle', 'Heisenberg Uncertainty Principle'],
                correct: 1
            },
            {
                type: 'fill-in',
                question: 'Write the electron configuration for Sodium (Na, Z=11):',
                answer: '1s² 2s² 2p⁶ 3s¹'
            },
            {
                type: 'multiple-choice',
                question: 'What is the electron configuration for Chromium (Cr, Z=24)?',
                options: ['1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁴ 4s²', '1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s¹', '1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁶ 4s²', '1s² 2s² 2p⁶ 3s² 3p⁶ 3d³ 4s²'],
                correct: 1
            },
            {
                type: 'fill-in',
                question: 'Write the electron configuration for Na⁺ (sodium ion):',
                answer: '1s² 2s² 2p⁶'
            },
            {
                type: 'multiple-choice',
                question: 'How many electrons can fit in a p orbital?',
                options: ['2', '6', '10', '14'],
                correct: 1
            },
            {
                type: 'fill-in',
                question: 'Write the electron configuration for Copper (Cu, Z=29):',
                answer: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s¹'
            },
            {
                type: 'multiple-choice',
                question: 'Which element has the electron configuration 1s² 2s² 2p⁶?',
                options: ['Neon', 'Fluorine', 'Sodium ion', 'All of the above'],
                correct: 3
            },
            {
                type: 'fill-in',
                question: 'Write the electron configuration for Chlorine (Cl, Z=17):',
                answer: '1s² 2s² 2p⁶ 3s² 3p⁵'
            },
            {
                type: 'multiple-choice',
                question: 'What is the maximum number of electrons in the n=3 shell?',
                options: ['8', '18', '32', '50'],
                correct: 1
            }
        ];

        let currentQuizQuestion = 0;
        let quizScore = 0;
        let practiceQuizAnswers = [];

        function startQuiz() {
            currentQuizQuestion = 0;
            quizScore = 0;
            practiceQuizAnswers = [];
            
            document.getElementById('startQuizBtn').style.display = 'none';
            document.getElementById('nextQuestionBtn').style.display = 'inline-block';
            document.getElementById('submitAnswerBtn').style.display = 'inline-block';
            document.getElementById('resetQuizBtn').style.display = 'inline-block';
            document.getElementById('quizResults').style.display = 'none';
            
            showQuizQuestion();
        }

        function showQuizQuestion() {
            const question = quizQuestions[currentQuizQuestion];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('currentQuestion').textContent = currentQuizQuestion + 1;
            
            if (question.type === 'multiple-choice') {
                document.getElementById('questionOptions').style.display = 'block';
                document.getElementById('questionInput').style.display = 'none';
                
                const optionsDiv = document.getElementById('questionOptions');
                optionsDiv.innerHTML = '';
                
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.style.cssText = 'margin: 10px 0; padding: 10px; background: var(--dark); border: 2px solid var(--accent); border-radius: 8px; cursor: pointer; transition: background 0.3s ease;';
                    optionDiv.innerHTML = `<input type="radio" name="quizAnswer" value="${index}" style="margin-right: 10px;"> ${option}`;
                    optionDiv.onclick = () => {
                        optionDiv.querySelector('input').checked = true;
                        optionDiv.style.background = 'var(--accent)';
                        optionDiv.style.color = 'var(--dark)';
                    };
                    optionsDiv.appendChild(optionDiv);
                });
            } else {
                document.getElementById('questionOptions').style.display = 'none';
                document.getElementById('questionInput').style.display = 'block';
                document.getElementById('textAnswer').value = '';
            }
        }

        function submitAnswer() {
            const question = quizQuestions[currentQuizQuestion];
            let userAnswer = null;
            
            if (question.type === 'multiple-choice') {
                const selected = document.querySelector('input[name="quizAnswer"]:checked');
                userAnswer = selected ? parseInt(selected.value) : null;
            } else {
                userAnswer = document.getElementById('textAnswer').value.trim();
            }
            
            if (userAnswer === null || userAnswer === '') {
                alert('Please select an answer or enter your response!');
                return;
            }
            
            let isCorrect = false;
            if (question.type === 'multiple-choice') {
                isCorrect = userAnswer === question.correct;
            } else {
                isCorrect = userAnswer.toLowerCase() === question.answer.toLowerCase();
            }
            
            if (isCorrect) {
                quizScore++;
            }
            
            practiceQuizAnswers.push({
                question: question.question,
                userAnswer: userAnswer,
                correctAnswer: question.type === 'multiple-choice' ? question.options[question.correct] : question.answer,
                isCorrect: isCorrect
            });
            
            if (currentQuizQuestion < quizQuestions.length - 1) {
                currentQuizQuestion++;
                showQuizQuestion();
            } else {
                showQuizResults();
            }
        }

        function nextQuestion() {
            if (currentQuizQuestion < quizQuestions.length - 1) {
                currentQuizQuestion++;
                showQuizQuestion();
            } else {
                showQuizResults();
            }
        }

        function showQuizResults() {
            document.getElementById('nextQuestionBtn').style.display = 'none';
            document.getElementById('submitAnswerBtn').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            
            document.getElementById('finalScore').textContent = quizScore;
            document.getElementById('totalQuestions').textContent = quizQuestions.length;
            document.getElementById('totalQuestions2').textContent = quizQuestions.length;
            
            const percentage = Math.round((quizScore / quizQuestions.length) * 100);
            let message = '';
            if (percentage >= 90) {
                message = '🎉 Excellent! You have mastered electron configuration!';
            } else if (percentage >= 70) {
                message = '👍 Good job! You have a solid understanding.';
            } else if (percentage >= 50) {
                message = '📚 Keep practicing! You\'re on the right track.';
            } else {
                message = '💪 Don\'t give up! Review the material and try again.';
            }
            
            document.getElementById('performanceMessage').textContent = message;
        }

        function retakeQuiz() {
            startQuiz();
        }

        function showQuizReview() {
            let review = 'Quiz Review:\n\n';
            practiceQuizAnswers.forEach((answer, index) => {
                review += `Question ${index + 1}: ${answer.question}\n`;
                review += `Your Answer: ${answer.userAnswer}\n`;
                review += `Correct Answer: ${answer.correctAnswer}\n`;
                review += `Result: ${answer.isCorrect ? '✅ Correct' : '❌ Incorrect'}\n\n`;
            });
            alert(review);
        }

        function resetQuiz() {
            currentQuizQuestion = 0;
            quizScore = 0;
            practiceQuizAnswers = [];
            
            document.getElementById('startQuizBtn').style.display = 'inline-block';
            document.getElementById('nextQuestionBtn').style.display = 'none';
            document.getElementById('submitAnswerBtn').style.display = 'none';
            document.getElementById('resetQuizBtn').style.display = 'none';
            document.getElementById('quizResults').style.display = 'none';
            document.getElementById('questionText').textContent = 'Question will appear here';
            document.getElementById('questionOptions').style.display = 'none';
            document.getElementById('questionInput').style.display = 'none';
        }

        // ======= Simulation Functions =======

        function loadSimulation() {
            const select = document.getElementById('simulationSelect');
            const simulation = select.value;
            
            if (simulation) {
                document.getElementById('playBtn').style.display = 'inline-block';
                document.getElementById('pauseBtn').style.display = 'inline-block';
                document.getElementById('resetBtn').style.display = 'inline-block';
                document.getElementById('infoBtn').style.display = 'inline-block';
                
                const display = document.getElementById('simulationDisplay');
                display.innerHTML = `
                    <div style="color: var(--light); font-size: 18px;">
                        <h3 style="color: var(--accent); margin-bottom: 15px;">${simulation.replace('-', ' ').toUpperCase()}</h3>
                        <p>Click Play to start the simulation</p>
                    </div>
                `;
            } else {
                document.getElementById('playBtn').style.display = 'none';
                document.getElementById('pauseBtn').style.display = 'none';
                document.getElementById('resetBtn').style.display = 'none';
                document.getElementById('infoBtn').style.display = 'none';
                document.getElementById('simulationDisplay').innerHTML = '<div style="color: var(--light); font-size: 18px;">Select a simulation to begin</div>';
            }
        }

        function playSimulation() {
            const select = document.getElementById('simulationSelect');
            const simulation = select.value;
            
            const display = document.getElementById('simulationDisplay');
            display.innerHTML = `
                <div style="color: var(--light); font-size: 16px;">
                    <h3 style="color: var(--accent); margin-bottom: 15px;">${simulation.replace('-', ' ').toUpperCase()} - Playing</h3>
                    <p>Simulation is running... (This is a placeholder for the actual simulation)</p>
                    <div style="margin: 20px 0; padding: 20px; background: var(--accent); color: var(--dark); border-radius: 10px;">
                        <p style="margin: 0; font-weight: 600;">Interactive visualization would appear here</p>
                    </div>
                </div>
            `;
        }

        function pauseSimulation() {
            const display = document.getElementById('simulationDisplay');
            display.innerHTML = `
                <div style="color: var(--light); font-size: 16px;">
                    <h3 style="color: var(--accent); margin-bottom: 15px;">Simulation Paused</h3>
                    <p>Click Play to resume</p>
                </div>
            `;
        }

        function resetSimulation() {
            loadSimulation();
        }

        function showSimulationInfo() {
            const select = document.getElementById('simulationSelect');
            const simulation = select.value;
            
            const info = {
                'orbital-filling': 'Shows how electrons fill orbitals according to the Aufbau principle.',
                'electron-spin': 'Visualizes electron spin and the Pauli exclusion principle.',
                'energy-levels': 'Displays energy level diagrams and orbital energies.',
                'ion-formation': 'Demonstrates how atoms gain or lose electrons to form ions.',
                'magnetic-properties': 'Shows how electron configuration affects magnetic properties.'
            };
            
            alert(info[simulation] || 'This simulation helps visualize electron configuration concepts.');
        }

        // ======= Practice Problems Functions =======

        const problemCategories = {
            'basic': [
                {
                    title: 'Hydrogen Configuration',
                    statement: 'Write the electron configuration for Hydrogen (H, Z=1).',
                    solution: '1s¹',
                    hint: 'Hydrogen has only 1 electron, so it goes in the 1s orbital.'
                },
                {
                    title: 'Helium Configuration',
                    statement: 'Write the electron configuration for Helium (He, Z=2).',
                    solution: '1s²',
                    hint: 'Helium has 2 electrons, filling the 1s orbital completely.'
                },
                {
                    title: 'Lithium Configuration',
                    statement: 'Write the electron configuration for Lithium (Li, Z=3).',
                    solution: '1s² 2s¹',
                    hint: 'After filling 1s², the third electron goes to 2s.'
                }
            ],
            'intermediate': [
                {
                    title: 'Iron Configuration',
                    statement: 'Write the electron configuration for Iron (Fe, Z=26).',
                    solution: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁶ 4s²',
                    hint: 'Fill 4s before 3d, but write 3d before 4s in the configuration.'
                },
                {
                    title: 'Bromine Configuration',
                    statement: 'Write the electron configuration for Bromine (Br, Z=35).',
                    solution: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s² 4p⁵',
                    hint: 'Bromine has 35 electrons. Fill 4s, then 3d, then 4p.'
                },
                {
                    title: 'Chromium Exception',
                    statement: 'Write the electron configuration for Chromium (Cr, Z=24).',
                    solution: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d⁵ 4s¹',
                    hint: 'Chromium is an exception - it promotes one 4s electron to 3d.'
                }
            ],
            'advanced': [
                {
                    title: 'Copper Exception',
                    statement: 'Write the electron configuration for Copper (Cu, Z=29).',
                    solution: '1s² 2s² 2p⁶ 3s² 3p⁶ 3d¹⁰ 4s¹',
                    hint: 'Copper is an exception - it promotes one 4s electron to 3d.'
                },
                {
                    title: 'Sodium Ion',
                    statement: 'Write the electron configuration for Na⁺ (sodium ion).',
                    solution: '1s² 2s² 2p⁶',
                    hint: 'Cations lose electrons. Sodium loses its 3s electron.'
                },
                {
                    title: 'Chloride Ion',
                    statement: 'Write the electron configuration for Cl⁻ (chloride ion).',
                    solution: '1s² 2s² 2p⁶ 3s² 3p⁶',
                    hint: 'Anions gain electrons. Chlorine gains one electron in 3p.'
                }
            ]
        };

        function loadProblemCategory(category) {
            const problemsList = document.getElementById('problemsList');
            const categoryTitle = document.getElementById('categoryTitle');
            const problemsGrid = document.getElementById('problemsGrid');
            
            categoryTitle.textContent = category.charAt(0).toUpperCase() + category.slice(1) + ' Problems';
            problemsList.style.display = 'block';
            
            problemsGrid.innerHTML = '';
            
            problemCategories[category].forEach((problem, index) => {
                const problemCard = document.createElement('div');
                problemCard.style.cssText = 'background: var(--accent); color: var(--dark); padding: 20px; border-radius: 10px; cursor: pointer; transition: transform 0.3s ease;';
                problemCard.innerHTML = `
                    <h4 style="margin: 0 0 10px 0;">${problem.title}</h4>
                    <p style="margin: 0; opacity: 0.8;">Click to solve</p>
                `;
                problemCard.onclick = () => openProblem(problem);
                problemsGrid.appendChild(problemCard);
            });
        }

        function openProblem(problem) {
            const workspace = document.getElementById('problemWorkspace');
            const title = document.getElementById('currentProblemTitle');
            const statement = document.getElementById('currentProblemStatement');
            const input = document.getElementById('workspaceInput');
            const feedback = document.getElementById('problemFeedback');
            
            title.textContent = problem.title;
            statement.innerHTML = `<p style="margin: 0; font-size: 16px;">${problem.statement}</p>`;
            input.value = '';
            feedback.style.display = 'none';
            
            workspace.style.display = 'block';
            workspace.scrollIntoView({ behavior: 'smooth' });
        }

        function closeProblemWorkspace() {
            document.getElementById('problemWorkspace').style.display = 'none';
        }

        function checkProblemAnswer() {
            const input = document.getElementById('workspaceInput');
            const feedback = document.getElementById('problemFeedback');
            const userAnswer = input.value.trim();
            
            if (!userAnswer) {
                alert('Please enter your solution first!');
                return;
            }
            
            // This is a simplified check - in a real implementation, you'd have more sophisticated answer validation
            const isCorrect = userAnswer.toLowerCase().includes('1s') || userAnswer.toLowerCase().includes('2s') || userAnswer.toLowerCase().includes('2p');
            
            feedback.innerHTML = `
                <div style="background: ${isCorrect ? 'var(--success)' : 'var(--error)'}; color: var(--dark); padding: 15px; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0;">${isCorrect ? '✅ Good attempt!' : '❌ Try again'}</h4>
                    <p style="margin: 0;">${isCorrect ? 'Your answer shows understanding of electron configuration!' : 'Remember to include the orbital notation (1s, 2s, 2p, etc.)'}</p>
                </div>
            `;
            feedback.style.display = 'block';
        }

        function getProblemHint() {
            const workspace = document.getElementById('problemWorkspace');
            const title = document.getElementById('currentProblemTitle');
            
            // Find the current problem based on the title
            let currentProblem = null;
            Object.values(problemCategories).forEach(category => {
                category.forEach(problem => {
                    if (problem.title === title.textContent) {
                        currentProblem = problem;
                    }
                });
            });
            
            if (currentProblem) {
                alert(`Hint: ${currentProblem.hint}`);
            } else {
                alert('Remember the Aufbau principle: fill orbitals in order of increasing energy!');
            }
        }

        function showProblemSolution() {
            const workspace = document.getElementById('problemWorkspace');
            const title = document.getElementById('currentProblemTitle');
            
            // Find the current problem based on the title
            let currentProblem = null;
            Object.values(problemCategories).forEach(category => {
                category.forEach(problem => {
                    if (problem.title === title.textContent) {
                        currentProblem = problem;
                    }
                });
            });
            
            if (currentProblem) {
                alert(`Solution: ${currentProblem.solution}`);
            } else {
                alert('Solution not available for this problem.');
            }
        }

        function saveProblemProgress() {
            alert('Progress saved! (This is a placeholder - in a real implementation, this would save to localStorage or a database)');
        }
    </script>
</body>
</html>